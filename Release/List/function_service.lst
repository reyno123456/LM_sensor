###############################################################################
#                                                                             #
# IAR C/C++ Compiler V5.30.0.50166/W32 for Atmel AVR    11/Dec/2009  23:20:57 #
# Copyright 1996-2009 IAR Systems AB.                                         #
#                                                                             #
#    Source file  =  D:\avr\LM_Finial_Test\function_service.c                 #
#    Command line =  D:\avr\LM_Finial_Test\function_service.c --cpu=m644p     #
#                    -ms -o D:\avr\LM_Finial_Test\Release\Obj\ -D NDEBUG -D   #
#                    LM018 -D FINAL_VERSION2 -lCN                             #
#                    D:\avr\LM_Finial_Test\Release\List\ -lA                  #
#                    D:\avr\LM_Finial_Test\Release\List\ --diag_suppress      #
#                    Pa082,Pe167,Pe186 --initializers_in_flash -z6            #
#                    --no_inline --no_cross_call --no_tbaa                    #
#                    -DENABLE_BIT_DEFINITIONS -e -I "C:\Program Files\IAR     #
#                    Systems\Embedded Workbench 5.3\avr\INC\" -I "C:\Program  #
#                    Files\IAR Systems\Embedded Workbench 5.3\avr\INC\CLIB\"  #
#                    --eeprom_size 2048                                       #
#    List file    =  D:\avr\LM_Finial_Test\Release\List\function_service.lst  #
#    Object file  =  D:\avr\LM_Finial_Test\Release\Obj\function_service.r90   #
#                                                                             #
#                                                                             #
###############################################################################

D:\avr\LM_Finial_Test\function_service.c
      1          // Function_KO168.c
      2          
      3          #include <ioavr.h>
      4          #include <inavr.h>
      5          #include "IR.h"
      6          #include "PIR.h"
      7          #include "US.h"
      8          #include "usart.h"
      9          #include "board.h"
     10          #include "moudle_SCS.h"
     11          #include "application.h"
     12          #include "configuration.h"
     13          #include "decode_scs.h"
     14          #include "decode_scs_next.h"
     15          #include "global_variable.h"
     16          #include "function_service.h"
     17          
     18          //******************************************************************************
     19          // 	send frame presence
     20          //******************************************************************************
     21          //Mode_frame_GR(KO_conf.GR,nopre);
     22          //GS_presence_send();
     23          //frame_presence('1') pp mode
     24          

   \                                 In  segment CODE, align 2, keep-with-next
     25          void frame_presence(unsigned char arg)
   \                     frame_presence:
     26          {
   \   00000000   938A               ST      -Y, R24
   \   00000002   972B               SBIW    R29:R28, 11
   \   00000004   2F80               MOV     R24, R16
     27          		// B8 APL 1D 00
     28          		unsigned char TX_buffer[8];
     29              unsigned char buffer[3];
     30          		
     31          		TX_buffer[0] = 'B';
   \   00000006   E402               LDI     R16, 66
   \   00000008   830B               STD     Y+3, R16
     32          		TX_buffer[1] = '8';
   \   0000000A   E308               LDI     R16, 56
   \   0000000C   830C               STD     Y+4, R16
     33              //TX_buffer[2] = Configurators.A;
     34              //TX_buffer[3] = Configurators.PL;
     35          		CharToStr(KO_conf.DesAdd,buffer);  //reyno 0619
   \   0000000E   019E               MOVW    R19:R18, R29:R28
   \   00000010   9100....           LDS     R16, (KO_conf + 2)
   \   00000014   ........           CALL    CharToStr
     36          		TX_buffer[2] = buffer[0];
   \   00000018   8108               LD      R16, Y
   \   0000001A   830D               STD     Y+5, R16
     37          		TX_buffer[3] = buffer[1];
   \   0000001C   8109               LDD     R16, Y+1
   \   0000001E   830E               STD     Y+6, R16
     38          		TX_buffer[4] = '1';
   \   00000020   E301               LDI     R16, 49
   \   00000022   830F               STD     Y+7, R16
     39          		TX_buffer[5] = 'D';
   \   00000024   E404               LDI     R16, 68
   \   00000026   8708               STD     Y+8, R16
     40          		TX_buffer[6] = '0';
   \   00000028   E300               LDI     R16, 48
   \   0000002A   8709               STD     Y+9, R16
     41          		TX_buffer[7] = arg;
   \   0000002C   878A               STD     Y+10, R24
     42          		send_frame_pp_broad(TX_buffer, TRANS_DELAY);
   \   0000002E   E322               LDI     R18, 50
   \   00000030   E030               LDI     R19, 0
   \   00000032   018E               MOVW    R17:R16, R29:R28
   \   00000034   5F0D               SUBI    R16, 253
   \   00000036   4F1F               SBCI    R17, 255
   \   00000038   ........           CALL    send_frame_pp_broad
     43          
     44          }
   \   0000003C   962B               ADIW    R29:R28, 11
   \   0000003E   9189               LD      R24, Y+
   \   00000040   9508               RET
     45          
     46          //******************************************************************************
     47          // 	send frame no presence + OFF
     48          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
     49          void frame_pp_on_off( unsigned char command )
   \                     frame_pp_on_off:
     50          {
   \   00000000   ........           CALL    ?PROLOGUE4_L09
   \   00000004   972A               SBIW    R29:R28, 10
   \   00000006   2F80               MOV     R24, R16
     51          	if(KO_conf.en_load == 1)
   \   00000008   ....               LDI     R30, LOW(KO_conf)
   \   0000000A   ....               LDI     R31, (KO_conf) >> 8
   \   0000000C   8505               LDD     R16, Z+13
   \   0000000E   3001               CPI     R16, 1
   \   00000010   F5B9               BRNE    ??frame_pp_on_off_0
     52            {
     53          		// APL  LOC 12 00 "ON"
     54          		// APL  LOC 12 01 "OFF"
     55          		unsigned char buffer[2];
     56          		unsigned char TX_buffer[8];
     57          	
     58          		if(command == '0')
   \   00000012   3380               CPI     R24, 48
   \   00000014   F431               BRNE    ??frame_pp_on_off_1
     59          		{
     60          			Sensor_mode.power_on_flag =  1;
   \   00000016   ....               LDI     R26, LOW((Sensor_mode + 7))
   \   00000018   ....               LDI     R27, HIGH((Sensor_mode + 7))
   \   0000001A   910C               LD      R16, X
   \   0000001C   6200               ORI     R16, 0x20
   \   0000001E   930C               ST      X, R16
   \   00000020   C00D               RJMP    ??frame_pp_on_off_2
     61          			//KO_conf.status[1] = Status_ON; //reyno 0616
     62          			//DLL.lightness_load = T_5min5s;					// 5s
     63          			//DLL.calc_OK_flag = 0; //reyno 0616
     64          		}
     65          		else if(command == '1')
   \                     ??frame_pp_on_off_1:
   \   00000022   3381               CPI     R24, 49
   \   00000024   F459               BRNE    ??frame_pp_on_off_2
     66          		{
     67          			Sensor_mode.power_on_flag = 0; //reyno 0616
   \   00000026   ....               LDI     R26, LOW((Sensor_mode + 7))
   \   00000028   ....               LDI     R27, HIGH((Sensor_mode + 7))
   \   0000002A   910C               LD      R16, X
   \   0000002C   7D0F               ANDI    R16, 0xDF
   \   0000002E   930C               ST      X, R16
     68          			//KO_conf.status[1] = Status_OFF;
     69          			Time_delay.detect_waitting = OFF_delay_2s;	// 0527,after send "OFF",the new detect will be enable 2s later
   \   00000030   ED00               LDI     R16, 208
   \   00000032   E017               LDI     R17, 7
   \   00000034   9300....           STS     (Time_delay + 11), R16
   \   00000038   9310....           STS     (Time_delay + 12), R17
     70          		}
     71          		
     72          		if(KO_conf.AddressType == 0)	
   \                     ??frame_pp_on_off_2:
   \   0000003C   8101               LDD     R16, Z+1
   \   0000003E   2300               TST     R16
   \   00000040   F419               BRNE    ??frame_pp_on_off_3
     73          		{
     74          			CharToStr(KO_conf.DesAdd,buffer);
   \   00000042   019E               MOVW    R19:R18, R29:R28
   \   00000044   8102               LDD     R16, Z+2
   \   00000046   C005               RJMP    ??frame_pp_on_off_4
     75          			TX_buffer[0] = buffer[0];
     76          			TX_buffer[1] = buffer[1];
     77          		}
     78          		else if(KO_conf.AddressType == 2)							// 0526
   \                     ??frame_pp_on_off_3:
   \   00000048   8101               LDD     R16, Z+1
   \   0000004A   3002               CPI     R16, 2
   \   0000004C   F441               BRNE    ??frame_pp_on_off_5
     79          		{
     80          			CharToStr(KO_conf.Reference, buffer);						// KO_conf.DesAdd
   \   0000004E   019E               MOVW    R19:R18, R29:R28
   \   00000050   8105               LDD     R16, Z+5
   \                     ??frame_pp_on_off_4:
   \   00000052   ........           CALL    CharToStr
     81          			TX_buffer[0] = buffer[0];
   \   00000056   8108               LD      R16, Y
   \   00000058   830A               STD     Y+2, R16
     82          			TX_buffer[1] = buffer[1];
   \   0000005A   8109               LDD     R16, Y+1
   \   0000005C   830B               STD     Y+3, R16
     83          			//CharToStr(KO_conf.GR, buffer);						// KO_conf.DesAdd
     84          			//TX_buffer[2] = buffer[0];
     85          			//TX_buffer[3] = buffer[1];
     86          		}
     87          		TX_buffer[2] = '0';
   \                     ??frame_pp_on_off_5:
   \   0000005E   E300               LDI     R16, 48
   \   00000060   830C               STD     Y+4, R16
     88          		TX_buffer[3] = '0';		
   \   00000062   830D               STD     Y+5, R16
     89          		TX_buffer[4] = '1';
   \   00000064   E301               LDI     R16, 49
   \   00000066   830E               STD     Y+6, R16
     90          		TX_buffer[5] = '2';
   \   00000068   E302               LDI     R16, 50
   \   0000006A   830F               STD     Y+7, R16
     91          		TX_buffer[6] = '0';
   \   0000006C   E300               LDI     R16, 48
   \   0000006E   8708               STD     Y+8, R16
     92          		TX_buffer[7] = command;
   \   00000070   8789               STD     Y+9, R24
     93          		send_frame_pp_broad(TX_buffer, TRANS_DELAY);				// 0707
   \   00000072   E322               LDI     R18, 50
   \   00000074   E030               LDI     R19, 0
   \   00000076   018E               MOVW    R17:R16, R29:R28
   \   00000078   5F0E               SUBI    R16, 254
   \   0000007A   4F1F               SBCI    R17, 255
   \   0000007C   ........           CALL    send_frame_pp_broad
     94          	}	
     95          }
   \                     ??frame_pp_on_off_0:
   \   00000080   962A               ADIW    R29:R28, 10
   \   00000082   E0E4               LDI     R30, 4
   \   00000084   ........           JMP     ?EPILOGUE_B4_L09
     96          
     97          //******************************************************************************
     98          // 	start time delay for load
     99          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    100          void Start_Time_Delay(void)
   \                     Start_Time_Delay:
    101          {
   \   00000000   01AD               MOVW    R21:R20, R27:R26
    102          	Time_delay.Walk_Through_Timeout = 0;	
   \   00000002   ....               LDI     R30, LOW(Time_delay)
   \   00000004   ....               LDI     R31, (Time_delay) >> 8
   \   00000006   E000               LDI     R16, 0
   \   00000008   8301               STD     Z+1, R16
   \   0000000A   8302               STD     Z+2, R16
    103          	Time_delay.timer_delay_set.count = Delay_Time_set;	// start time count from Delay_Time_set--
   \   0000000C   ....               LDI     R26, LOW(Delay_Time_set)
   \   0000000E   ....               LDI     R27, (Delay_Time_set) >> 8
   \   00000010   910D               LD      R16, X+
   \   00000012   911D               LD      R17, X+
   \   00000014   912D               LD      R18, X+
   \   00000016   913C               LD      R19, X
   \   00000018   8F02               STD     Z+26, R16
   \   0000001A   8F13               STD     Z+27, R17
   \   0000001C   8F24               STD     Z+28, R18
   \   0000001E   8F35               STD     Z+29, R19
    104          	Time_delay.timer_delay_set.time_out = 0;
   \   00000020   E000               LDI     R16, 0
   \   00000022   A302               STD     Z+34, R16
    105          	Time_delay.timer_delay_set.enabled = 1;
   \   00000024   E001               LDI     R16, 1
   \   00000026   A303               STD     Z+35, R16
    106          	Time_delay.timer_delay_set.started = 1;
   \   00000028   A304               STD     Z+36, R16
    107          }
   \   0000002A   01DA               MOVW    R27:R26, R21:R20
   \   0000002C   9508               RET
    108          
    109          //******************************************************************************
    110          // 	stop time delay for load
    111          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    112          void Stop_allTimer(void)
   \                     Stop_allTimer:
    113          {
    114          	Time_delay.Re_Trigger_senconds = 0;
   \   00000000   ....               LDI     R30, LOW(Time_delay)
   \   00000002   ....               LDI     R31, (Time_delay) >> 8
   \   00000004   E000               LDI     R16, 0
   \   00000006   8300               ST      Z, R16
    115          	Time_delay.Walk_Through_Timeout = 0;
   \   00000008   8301               STD     Z+1, R16
   \   0000000A   8302               STD     Z+2, R16
    116          	Time_delay.timer_takeline.enabled = 0;
   \   0000000C   A706               STD     Z+46, R16
    117          	Time_delay.timer_delay_set.enabled = 0;
   \   0000000E   A303               STD     Z+35, R16
    118          	if(KO_conf.LightReg == 1)			// alan 0729
   \   00000010   9100....           LDS     R16, (KO_conf + 28)
   \   00000014   3001               CPI     R16, 1
   \   00000016   F451               BRNE    ??Stop_allTimer_0
    119          	{
    120          			DLL.start_regulation = 0;
   \   00000018   ....               LDI     R30, LOW(DLL)
   \   0000001A   ....               LDI     R31, (DLL) >> 8
   \   0000001C   A906               LDD     R16, Z+54
   \   0000001E   7F0E               ANDI    R16, 0xFE
   \   00000020   AB06               STD     Z+54, R16
    121          			ClrBit(KO_conf.status[0],Status_Regulationing);
   \   00000022   ....               LDI     R30, LOW(KO_conf)
   \   00000024   ....               LDI     R31, (KO_conf) >> 8
   \   00000026   A505               LDD     R16, Z+45
   \   00000028   7B0F               ANDI    R16, 0xBF
   \   0000002A   A705               STD     Z+45, R16
    122          	}
    123          }
   \                     ??Stop_allTimer_0:
   \   0000002C   9508               RET
    124          
    125          //******************************************************************************
    126          // 	update the time dalay base on Automatic or walkthrough
    127          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    128          void Call_detect_delay(void)
   \                     Call_detect_delay:
    129          {
    130            if(KO_conf.FuncMod == Auto_Walk_thru)		// 在Auto_Walk_thru模式时
   \   00000000   9100....           LDS     R16, (KO_conf + 29)
   \   00000004   3002               CPI     R16, 2
   \   00000006   F501               BRNE    ??Call_detect_delay_0
    131          	{
    132          		if(Delay_Time_set > Walkthru_delay)		
   \   00000008   ....               LDI     R30, LOW(Delay_Time_set)
   \   0000000A   ....               LDI     R31, (Delay_Time_set) >> 8
   \   0000000C   8100               LD      R16, Z
   \   0000000E   8111               LDD     R17, Z+1
   \   00000010   8122               LDD     R18, Z+2
   \   00000012   8133               LDD     R19, Z+3
   \   00000014   3B05               CPI     R16, 181
   \   00000016   E040               LDI     R20, 0
   \   00000018   0714               CPC     R17, R20
   \   0000001A   0724               CPC     R18, R20
   \   0000001C   0734               CPC     R19, R20
   \   0000001E   F030               BRCS    ??Call_detect_delay_1
    133          			Time_delay.Walk_Through_Timeout = Walkthru_delay;
   \   00000020   EB04               LDI     R16, 180
   \   00000022   9300....           STS     (Time_delay + 1), R16
   \   00000026   9340....           STS     (Time_delay + 2), R20
   \   0000002A   C008               RJMP    ??Call_detect_delay_2
    134          		else									
    135          			Time_delay.Walk_Through_Timeout = Delay_Time_set;
   \                     ??Call_detect_delay_1:
   \   0000002C   8100               LD      R16, Z
   \   0000002E   8111               LDD     R17, Z+1
   \   00000030   8122               LDD     R18, Z+2
   \   00000032   8133               LDD     R19, Z+3
   \   00000034   9300....           STS     (Time_delay + 1), R16
   \   00000038   9310....           STS     (Time_delay + 2), R17
    136          	  	
    137          		Walk_Through_flag = 1;
   \                     ??Call_detect_delay_2:
   \   0000003C   E001               LDI     R16, 1
   \   0000003E   9300....           STS     Walk_Through_flag, R16
    138          		First_detection_enable = 1;
   \   00000042   9300....           STS     First_detection_enable, R16
   \   00000046   9508               RET
    139          	}
    140          	else
    141          	{
    142          		Start_Time_Delay();	
   \                     ??Call_detect_delay_0:
   \   00000048   ....               RCALL   Start_Time_Delay
    143          		Walk_Through_flag = 0;
   \   0000004A   E000               LDI     R16, 0
   \   0000004C   9300....           STS     Walk_Through_flag, R16
    144          	}
    145          }
   \   00000050   9508               RET
    146          
    147          //*****************************************************************************************
    148          // 	to check the time delay between the detection and the first detection > 20s
    149          //*****************************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    150          void WT_20s_detect(void)               					// to judge if the time between the detection and the first detection is longer than 20s
   \                     WT_20s_detect:
    151          {
    152              if(Walk_Through_flag == 1)									// in walk_through mode
   \   00000000   9100....           LDS     R16, Walk_Through_flag
   \   00000004   3001               CPI     R16, 1
   \   00000006   F009               BREQ    $+2+2
   \   00000008   C052               RJMP    ??WT_20s_detect_0
    153          		{
    154          				if( ((Time_delay.Walk_Through_Timeout < 160)&&(Delay_Time_set >= Walkthru_delay))
    155          					 ||((Time_delay.Walk_Through_Timeout < Delay_Time_set-20)&&(Delay_Time_set < Walkthru_delay)))	
   \   0000000A   9100....           LDS     R16, (Time_delay + 1)
   \   0000000E   9110....           LDS     R17, (Time_delay + 2)
   \   00000012   3A00               CPI     R16, 160
   \   00000014   E020               LDI     R18, 0
   \   00000016   0712               CPC     R17, R18
   \   00000018   F460               BRCC    ??WT_20s_detect_1
   \   0000001A   ....               LDI     R30, LOW(Delay_Time_set)
   \   0000001C   ....               LDI     R31, (Delay_Time_set) >> 8
   \   0000001E   8100               LD      R16, Z
   \   00000020   8111               LDD     R17, Z+1
   \   00000022   8122               LDD     R18, Z+2
   \   00000024   8133               LDD     R19, Z+3
   \   00000026   3B04               CPI     R16, 180
   \   00000028   E040               LDI     R20, 0
   \   0000002A   0714               CPC     R17, R20
   \   0000002C   0724               CPC     R18, R20
   \   0000002E   0734               CPC     R19, R20
   \   00000030   F4F0               BRCC    ??WT_20s_detect_2
   \                     ??WT_20s_detect_1:
   \   00000032   9140....           LDS     R20, (Time_delay + 1)
   \   00000036   9150....           LDS     R21, (Time_delay + 2)
   \   0000003A   E060               LDI     R22, 0
   \   0000003C   E070               LDI     R23, 0
   \   0000003E   ....               LDI     R30, LOW(Delay_Time_set)
   \   00000040   ....               LDI     R31, (Delay_Time_set) >> 8
   \   00000042   8100               LD      R16, Z
   \   00000044   8111               LDD     R17, Z+1
   \   00000046   8122               LDD     R18, Z+2
   \   00000048   8133               LDD     R19, Z+3
   \   0000004A   5104               SUBI    R16, 20
   \   0000004C   4010               SBCI    R17, 0
   \   0000004E   4020               SBCI    R18, 0
   \   00000050   4030               SBCI    R19, 0
   \   00000052   1740               CP      R20, R16
   \   00000054   0751               CPC     R21, R17
   \   00000056   0762               CPC     R22, R18
   \   00000058   0773               CPC     R23, R19
   \   0000005A   F488               BRCC    ??WT_20s_detect_3
   \   0000005C   8100               LD      R16, Z
   \   0000005E   8111               LDD     R17, Z+1
   \   00000060   8122               LDD     R18, Z+2
   \   00000062   8133               LDD     R19, Z+3
   \   00000064   3B04               CPI     R16, 180
   \   00000066   0716               CPC     R17, R22
   \   00000068   0726               CPC     R18, R22
   \   0000006A   0736               CPC     R19, R22
   \   0000006C   F440               BRCC    ??WT_20s_detect_3
    156          				{																				//(Walkthru_delay C T_20s))
    157          					Walk_Through_flag = 0;
   \                     ??WT_20s_detect_2:
   \   0000006E   E000               LDI     R16, 0
   \   00000070   9300....           STS     Walk_Through_flag, R16
    158          					Time_delay.Walk_Through_Timeout = 0;	// detection is occur after 20s since first detection, use the set time delay
   \   00000074   9300....           STS     (Time_delay + 1), R16
   \   00000078   9300....           STS     (Time_delay + 2), R16
    159          					Start_Time_Delay();										// when detection is occur after 20s, use the set time delay instead of Walk_Through_Timeout
   \   0000007C   C018               RJMP    ??WT_20s_detect_0
    160          				}
    161          				else																		// update time delay
    162          				{
    163          					if(Delay_Time_set > Walkthru_delay)		
   \                     ??WT_20s_detect_3:
   \   0000007E   8100               LD      R16, Z
   \   00000080   8111               LDD     R17, Z+1
   \   00000082   8122               LDD     R18, Z+2
   \   00000084   8133               LDD     R19, Z+3
   \   00000086   3B05               CPI     R16, 181
   \   00000088   0716               CPC     R17, R22
   \   0000008A   0726               CPC     R18, R22
   \   0000008C   0736               CPC     R19, R22
   \   0000008E   F030               BRCS    ??WT_20s_detect_4
    164          			  		Time_delay.Walk_Through_Timeout = Walkthru_delay;
   \   00000090   EB04               LDI     R16, 180
   \   00000092   9300....           STS     (Time_delay + 1), R16
   \   00000096   9360....           STS     (Time_delay + 2), R22
   \   0000009A   9508               RET
    165          					else							
    166          			 	 		Time_delay.Walk_Through_Timeout = Delay_Time_set;
   \                     ??WT_20s_detect_4:
   \   0000009C   8100               LD      R16, Z
   \   0000009E   8111               LDD     R17, Z+1
   \   000000A0   8122               LDD     R18, Z+2
   \   000000A2   8133               LDD     R19, Z+3
   \   000000A4   9300....           STS     (Time_delay + 1), R16
   \   000000A8   9310....           STS     (Time_delay + 2), R17
   \   000000AC   9508               RET
    167          				}
    168          		}
    169          		else
    170          		{
    171          				Start_Time_Delay();											// update the delay time after received the GS presence
   \                     ??WT_20s_detect_0:
   \   000000AE   ....               RCALL   Start_Time_Delay
    172          		}
    173          }
   \   000000B0   9508               RET
    174          
    175          //******************************************************************************
    176          // 	send the frame presence for the GS
    177          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    178          void GS_presence_send(void)
   \                     GS_presence_send:
    179          {
   \   00000000   9100....           LDS     R16, (KO_conf + 14)
   \   00000004   3001               CPI     R16, 1
   \   00000006   F491               BRNE    ??GS_presence_send_0
    180                  if(KO_conf.en_GS_main_group ==1)
    181                  {
    182          	      //Mode_frame_GR(KO_conf.GR,pre);													// send GR frame presence;	B5 GG 1D 00
    183          	      if(KO_conf.GS1 != 0)	Mode_frame_GR(KO_conf.GS1, Gs1);		// send frame "presence detection" to the GS1;
   \   00000008   9100....           LDS     R16, (KO_conf + 7)
   \   0000000C   2300               TST     R16
   \   0000000E   F029               BREQ    ??GS_presence_send_1
   \   00000010   E015               LDI     R17, 5
   \   00000012   9100....           LDS     R16, (KO_conf + 7)
   \   00000016   ........           CALL    Mode_frame_GR
    184          	      if(KO_conf.GS2 != 0)	Mode_frame_GR(KO_conf.GS2, Gs2);		// send frame "presence detection" to the GS2;
   \                     ??GS_presence_send_1:
   \   0000001A   9100....           LDS     R16, (KO_conf + 8)
   \   0000001E   2300               TST     R16
   \   00000020   F029               BREQ    ??GS_presence_send_0
   \   00000022   E016               LDI     R17, 6
   \   00000024   9100....           LDS     R16, (KO_conf + 8)
   \   00000028   ........           CALL    Mode_frame_GR
    185                  }
    186          }
   \                     ??GS_presence_send_0:
   \   0000002C   9508               RET
    187          
    188          //******************************************************************************
    189          // 					send the frame ON
    190          //			in Partial_ON mode, 	APL LOC 12 00
    191          //			in other mode,				B5  GR  12 00
    192          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    193          void frame_ON_send(void)
   \                     frame_ON_send:
    194          {
   \   00000000   9100....           LDS     R16, (KO_conf + 13)
   \   00000004   3001               CPI     R16, 1
   \   00000006   F559               BRNE    ??frame_ON_send_0
    195               if(KO_conf.en_load == 1)				//0618
    196               {
    197          			 flags.dimmer_ON_sended = 0;
   \   00000008   ....               LDI     R30, LOW(flags)
   \   0000000A   ....               LDI     R31, (flags) >> 8
   \   0000000C   8504               LDD     R16, Z+12
   \   0000000E   8515               LDD     R17, Z+13
   \   00000010   7F07               ANDI    R16, 0xF7
   \   00000012   8715               STD     Z+13, R17
   \   00000014   8704               STD     Z+12, R16
    198                 	if( KO_conf.FuncMod == Partial_ON || KO_conf.AddressType ==0)   // Parital ON or P2P
   \   00000016   9100....           LDS     R16, (KO_conf + 29)
   \   0000001A   3005               CPI     R16, 5
   \   0000001C   F021               BREQ    ??frame_ON_send_1
   \   0000001E   9100....           LDS     R16, (KO_conf + 1)
   \   00000022   2300               TST     R16
   \   00000024   F419               BRNE    ??frame_ON_send_2
    199          				{
    200          						//if( KO_conf.Reference != 0 )	Mode_frame_P2P('1','2','0','0','0','0','0');		
    201          						frame_pp_on_off('0');             		// send frame ON	    0526    	
   \                     ??frame_ON_send_1:
   \   00000026   E300               LDI     R16, 48
   \   00000028   ....               RCALL   frame_pp_on_off
   \   0000002A   C009               RJMP    ??frame_ON_send_3
    202          				}
    203          				else																	// GR on
    204          				{
    205          						if(KO_conf.GR !=0)		Mode_frame_GR(KO_conf.GR,ON);		
   \                     ??frame_ON_send_2:
   \   0000002C   9100....           LDS     R16, (KO_conf + 6)
   \   00000030   2300               TST     R16
   \   00000032   F029               BREQ    ??frame_ON_send_3
   \   00000034   E011               LDI     R17, 1
   \   00000036   9100....           LDS     R16, (KO_conf + 6)
   \   0000003A   ........           CALL    Mode_frame_GR
    206          				}
    207          				//KO_conf.status[1] = Status_ON;				//0515
    208          				if(KO_conf.LightReg == 1)			// alan 0729
   \                     ??frame_ON_send_3:
   \   0000003E   9100....           LDS     R16, (KO_conf + 28)
   \   00000042   3001               CPI     R16, 1
   \   00000044   F461               BRNE    ??frame_ON_send_0
    209          				{
    210          						DLL.start_regulation = 1;
   \   00000046   ....               LDI     R30, LOW(DLL)
   \   00000048   ....               LDI     R31, (DLL) >> 8
   \   0000004A   A906               LDD     R16, Z+54
   \   0000004C   6001               ORI     R16, 0x01
   \   0000004E   AB06               STD     Z+54, R16
    211          						SetBit(KO_conf.status[0],Status_Regulationing);
   \   00000050   ....               LDI     R30, LOW(KO_conf)
   \   00000052   ....               LDI     R31, (KO_conf) >> 8
   \   00000054   A505               LDD     R16, Z+45
   \   00000056   6400               ORI     R16, 0x40
   \   00000058   A705               STD     Z+45, R16
    212          						regulation_timer_initial();
   \   0000005A   ........           CALL    regulation_timer_initial
    213          				}
    214               }
    215          }
   \                     ??frame_ON_send_0:
   \   0000005E   9508               RET
    216          
    217          //******************************************************************************
    218          // 				send the frame OFF
    219          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    220          void frame_OFF_send(void)
   \                     frame_OFF_send:
    221          {
   \   00000000   9100....           LDS     R16, (KO_conf + 13)
   \   00000004   3001               CPI     R16, 1
   \   00000006   F5C1               BRNE    ??frame_OFF_send_0
    222               if(KO_conf.en_load == 1)			//0618
    223               {
    224          			 if( KO_conf.LightReg == 1 && SCS_received.P2P_dimmer_flag == 1 && DLL.start_regulation == 1)
   \   00000008   9100....           LDS     R16, (KO_conf + 28)
   \   0000000C   3001               CPI     R16, 1
   \   0000000E   F479               BRNE    ??frame_OFF_send_1
   \   00000010   ....               LDI     R30, LOW(SCS_received)
   \   00000012   ....               LDI     R31, (SCS_received) >> 8
   \   00000014   8102               LDD     R16, Z+2
   \   00000016   FF01               SBRS    R16, 1
   \   00000018   C00A               RJMP    ??frame_OFF_send_1
   \   0000001A   ....               LDI     R30, LOW(DLL)
   \   0000001C   ....               LDI     R31, (DLL) >> 8
   \   0000001E   A906               LDD     R16, Z+54
   \   00000020   FF00               SBRS    R16, 0
   \   00000022   C005               RJMP    ??frame_OFF_send_1
    225          			 {
    226          				 dimmer_command(OFF,0);
   \   00000024   E010               LDI     R17, 0
   \   00000026   E002               LDI     R16, 2
   \   00000028   ........           CALL    dimmer_command
   \   0000002C   C01B               RJMP    ??frame_OFF_send_2
    227          			 }
    228          			 else
    229          			 {
    230                    if(KO_conf.AddressType == 2 && KO_conf.GR != 0)		//GR
   \                     ??frame_OFF_send_1:
   \   0000002E   9100....           LDS     R16, (KO_conf + 1)
   \   00000032   3002               CPI     R16, 2
   \   00000034   F479               BRNE    ??frame_OFF_send_3
   \   00000036   9100....           LDS     R16, (KO_conf + 6)
   \   0000003A   2300               TST     R16
   \   0000003C   F059               BREQ    ??frame_OFF_send_3
    231          					{
    232          			 				Mode_frame_GR(KO_conf.GR,nopre);		// send Group "no presence detection"	B5 GG 1D 01
   \   0000003E   E014               LDI     R17, 4
   \   00000040   9100....           LDS     R16, (KO_conf + 6)
   \   00000044   ........           CALL    Mode_frame_GR
    233                    		Mode_frame_GR(KO_conf.GR,OFF);			// send Group "OFF" frame	B5 GG 12 01
   \   00000048   E012               LDI     R17, 2
   \   0000004A   9100....           LDS     R16, (KO_conf + 6)
   \   0000004E   ........           CALL    Mode_frame_GR
   \   00000052   C008               RJMP    ??frame_OFF_send_2
    234          					}
    235          					else if(KO_conf.AddressType == 0)				//P2P
   \                     ??frame_OFF_send_3:
   \   00000054   9100....           LDS     R16, (KO_conf + 1)
   \   00000058   2300               TST     R16
   \   0000005A   F421               BRNE    ??frame_OFF_send_2
    236          					{
    237          						frame_presence('1'); //0709
   \   0000005C   E301               LDI     R16, 49
   \   0000005E   ....               RCALL   frame_presence
    238          						frame_pp_on_off('1');             		// send frame OFF    0618
   \   00000060   E301               LDI     R16, 49
   \   00000062   ....               RCALL   frame_pp_on_off
    239          					}
    240          			 }
    241          			
    242          			 DLL.start_regulation = 0;							// alan 0729 stop regulation when time delay over
   \                     ??frame_OFF_send_2:
   \   00000064   ....               LDI     R30, LOW(DLL)
   \   00000066   ....               LDI     R31, (DLL) >> 8
   \   00000068   A906               LDD     R16, Z+54
   \   0000006A   7F0E               ANDI    R16, 0xFE
   \   0000006C   AB06               STD     Z+54, R16
    243          			 ClrBit(KO_conf.status[0],Status_Regulationing);
   \   0000006E   ....               LDI     R30, LOW(KO_conf)
   \   00000070   ....               LDI     R31, (KO_conf) >> 8
   \   00000072   A505               LDD     R16, Z+45
   \   00000074   7B0F               ANDI    R16, 0xBF
   \   00000076   A705               STD     Z+45, R16
    244               }
    245          }
   \                     ??frame_OFF_send_0:
   \   00000078   9508               RET
    246          
    247          //*******************************************************************************
    248          // 			used for the Alert when the time dalay equal to 1min or 30s ir 10s
    249          //*******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    250          void Delay_Alert(void)
   \                     Delay_Alert:
    251          {
    252          	
    253            	if((Time_delay.Walk_Through_Timeout==60)||(Time_delay.Walk_Through_Timeout==30)
    254          	   ||(Time_delay.Walk_Through_Timeout==10)||(Time_delay.timer_delay_set.count==60)
    255          		 ||(Time_delay.timer_delay_set.count==30)||(Time_delay.timer_delay_set.count==10))
   \   00000000   ....               LDI     R30, LOW(Time_delay)
   \   00000002   ....               LDI     R31, (Time_delay) >> 8
   \   00000004   8101               LDD     R16, Z+1
   \   00000006   8112               LDD     R17, Z+2
   \   00000008   330C               CPI     R16, 60
   \   0000000A   E020               LDI     R18, 0
   \   0000000C   0712               CPC     R17, R18
   \   0000000E   F131               BREQ    ??Delay_Alert_0
   \   00000010   8101               LDD     R16, Z+1
   \   00000012   8112               LDD     R17, Z+2
   \   00000014   310E               CPI     R16, 30
   \   00000016   0712               CPC     R17, R18
   \   00000018   F109               BREQ    ??Delay_Alert_0
   \   0000001A   8101               LDD     R16, Z+1
   \   0000001C   8112               LDD     R17, Z+2
   \   0000001E   300A               CPI     R16, 10
   \   00000020   0712               CPC     R17, R18
   \   00000022   F0E1               BREQ    ??Delay_Alert_0
   \   00000024   8D02               LDD     R16, Z+26
   \   00000026   8D13               LDD     R17, Z+27
   \   00000028   8D24               LDD     R18, Z+28
   \   0000002A   8D35               LDD     R19, Z+29
   \   0000002C   330C               CPI     R16, 60
   \   0000002E   E040               LDI     R20, 0
   \   00000030   0714               CPC     R17, R20
   \   00000032   0724               CPC     R18, R20
   \   00000034   0734               CPC     R19, R20
   \   00000036   F091               BREQ    ??Delay_Alert_0
   \   00000038   8D02               LDD     R16, Z+26
   \   0000003A   8D13               LDD     R17, Z+27
   \   0000003C   8D24               LDD     R18, Z+28
   \   0000003E   8D35               LDD     R19, Z+29
   \   00000040   310E               CPI     R16, 30
   \   00000042   0714               CPC     R17, R20
   \   00000044   0724               CPC     R18, R20
   \   00000046   0734               CPC     R19, R20
   \   00000048   F049               BREQ    ??Delay_Alert_0
   \   0000004A   8D02               LDD     R16, Z+26
   \   0000004C   8D13               LDD     R17, Z+27
   \   0000004E   8D24               LDD     R18, Z+28
   \   00000050   8D35               LDD     R19, Z+29
   \   00000052   300A               CPI     R16, 10
   \   00000054   0714               CPC     R17, R20
   \   00000056   0724               CPC     R18, R20
   \   00000058   0734               CPC     R19, R20
   \   0000005A   F451               BRNE    ??Delay_Alert_1
    256          	  {		
    257          			switch(KO_conf.Alert)
   \                     ??Delay_Alert_0:
   \   0000005C   9100....           LDS     R16, (KO_conf + 34)
   \   00000060   5002               SUBI    R16, 2
   \   00000062   F011               BREQ    ??Delay_Alert_2
   \   00000064   950A               DEC     R16
   \   00000066   F421               BRNE    ??Delay_Alert_1
    258          			{
    259          				case Disabled:
    260          					// do nothing
    261          					break;
    262          				case Visual:
    263          	
    264          					break;
    265          				case Acustic:
    266          					buzzer_ms(500);
   \                     ??Delay_Alert_2:
   \   00000068   EF04               LDI     R16, 244
   \   0000006A   E011               LDI     R17, 1
   \   0000006C   ........           CALL    buzzer_ms
    267          		
    268          					break;
    269          				case Visual_Acustic:
    270          					buzzer_ms(500);
    271          					break;	
    272          			
    273          				default: break;			
    274          			}
    275          	  }	
    276          
    277          }
   \                     ??Delay_Alert_1:
   \   00000070   9508               RET
    278          	
    279          //*******************************************************************************
    280          // 	used for takeline when the sensor want to send the frame  presence + ON
    281          //*******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    282          void ON_takeline(void)
   \                     ON_takeline:
    283          {		
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
   \   00000004   9100....           LDS     R16, (Time_delay + 45)
   \   00000008   3001               CPI     R16, 1
   \   0000000A   F529               BRNE    ??ON_takeline_0
    284          	if(Time_delay.timer_takeline.time_out == 1)					// when time is out, send the frames
    285          	{													
    286          		Mode_frame_GR(KO_conf.GR,pre);										// send Group "presence detection"	B5 GG 1D 00
   \   0000000C   E013               LDI     R17, 3
   \   0000000E   9100....           LDS     R16, (KO_conf + 6)
   \   00000012   ........           CALL    Mode_frame_GR
    287          		frame_ON_send();
   \   00000016   ....               RCALL   frame_ON_send
    288          
    289          		Time_delay.timer_takeline.time_out = 0;
   \   00000018   E000               LDI     R16, 0
   \   0000001A   9300....           STS     (Time_delay + 45), R16
    290          		Time_delay.timer_takeline.started = 0;
   \   0000001E   9300....           STS     (Time_delay + 47), R16
    291          		Sensor_mode.ON_takeline_waitsend = 0;							// to indicate this frame had been sent
   \   00000022   ....               LDI     R26, LOW(Sensor_mode)
   \   00000024   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000026   9617               ADIW    R27:R26, 7
   \   00000028   910C               LD      R16, X
   \   0000002A   7F0E               ANDI    R16, 0xFE
   \   0000002C   930C               ST      X, R16
   \   0000002E   9717               SBIW    R27:R26, 7
    292          		Sensor_mode.flag_leader_group = 1;
   \   00000030   9615               ADIW    R27:R26, 5
   \   00000032   910C               LD      R16, X
   \   00000034   6002               ORI     R16, 0x02
   \   00000036   930C               ST      X, R16
   \   00000038   9715               SBIW    R27:R26, 5
    293          		Sensor_mode.mode_state = Maintain_state;
   \   0000003A   E002               LDI     R16, 2
   \   0000003C   9300....           STS     Sensor_mode, R16
    294          
    295          		Call_detect_delay();
   \   00000040   ....               RCALL   Call_detect_delay
    296          		Sensor_mode.maintain_pre = 1;											//0518
   \   00000042   9617               ADIW    R27:R26, 7
   \   00000044   910C               LD      R16, X
   \   00000046   6100               ORI     R16, 0x10
   \   00000048   930C               ST      X, R16
   \   0000004A   9717               SBIW    R27:R26, 7
    297          		Sensor_mode.presence_20sinterval = presence_20s;		//0518
   \   0000004C   E200               LDI     R16, 32
   \   0000004E   E41E               LDI     R17, 78
   \   00000050   9613               ADIW    R27:R26, 3
   \   00000052   930D               ST      X+, R16
   \   00000054   931C               ST      X, R17
    298          	}
    299          }
   \                     ??ON_takeline_0:
   \   00000056   91A9               LD      R26, Y+
   \   00000058   91B9               LD      R27, Y+
   \   0000005A   9508               RET
    300          
    301          //******************************************************************************
    302          // 	used for takeline when the sensor want to send the frame  no presence + OFF
    303          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    304          void OFF_takeline(void)
   \                     OFF_takeline:
    305          {					
    306          	if(Time_delay.timer_takeline.time_out == 1)
   \   00000000   9100....           LDS     R16, (Time_delay + 45)
   \   00000004   3001               CPI     R16, 1
   \   00000006   F479               BRNE    ??OFF_takeline_0
    307          	{		
    308          		frame_OFF_send();
   \   00000008   ....               RCALL   frame_OFF_send
    309          		Sensor_mode.no_prence_off_send = 1;								// to  indicate this frame had been sent
   \   0000000A   ....               LDI     R30, LOW(Sensor_mode)
   \   0000000C   ....               LDI     R31, (Sensor_mode) >> 8
   \   0000000E   8105               LDD     R16, Z+5
   \   00000010   6200               ORI     R16, 0x20
   \   00000012   8305               STD     Z+5, R16
    310          		Sensor_mode.OFF_takeline_waitsend = 0;
   \   00000014   8107               LDD     R16, Z+7
   \   00000016   7F0D               ANDI    R16, 0xFD
   \   00000018   8307               STD     Z+7, R16
    311          		Sensor_mode.flag_leader_group = 1;
   \   0000001A   8105               LDD     R16, Z+5
   \   0000001C   6002               ORI     R16, 0x02
   \   0000001E   8305               STD     Z+5, R16
    312          		Time_delay.timer_takeline.started = 0;
   \   00000020   E000               LDI     R16, 0
   \   00000022   9300....           STS     (Time_delay + 47), R16
    313          	}
    314          }
   \                     ??OFF_takeline_0:
   \   00000026   9508               RET
    315          
    316          //******************************************************************************
    317          // 	Check the frame received on SCS	when manual is enabled
    318          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    319          void function_check_status(void)
   \                     function_check_status:
    320          {	
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
    321          
    322          //******************************************************************************
    323          // 	if received update ON/OFF/LEVEL
    324          //******************************************************************************
    325            if((SCS_received.update_state_ON == 1)||(SCS_received.update_state_OFF == 1)||(SCS_received.update_state_LEVEL == 1))
   \   00000004   ....               LDI     R30, LOW(SCS_received)
   \   00000006   ....               LDI     R31, (SCS_received) >> 8
   \   00000008   8100               LD      R16, Z
   \   0000000A   FD07               SBRC    R16, 7
   \   0000000C   C004               RJMP    ??function_check_status_0
   \   0000000E   9100....           LDS     R16, (SCS_received + 1)
   \   00000012   7003               ANDI    R16, 0x03
   \   00000014   F199               BREQ    ??function_check_status_1
    326          	{
    327                if(SCS_received.update_state_ON == 1)				// 0519
   \                     ??function_check_status_0:
   \   00000016   8100               LD      R16, Z
   \   00000018   FF07               SBRS    R16, 7
   \   0000001A   C008               RJMP    ??function_check_status_2
    328          			{
    329          				SCS_received.update_state_ON = 0;
   \   0000001C   8100               LD      R16, Z
   \   0000001E   770F               ANDI    R16, 0x7F
   \   00000020   8300               ST      Z, R16
    330          				SCS_received.update_on_wait = 0;
   \   00000022   9100....           LDS     R16, (SCS_received + 1)
   \   00000026   7F03               ANDI    R16, 0xF3
   \   00000028   9300....           STS     (SCS_received + 1), R16
    331          			}
    332          	  		if(SCS_received.update_state_OFF == 1)  	// 0519
   \                     ??function_check_status_2:
   \   0000002C   8101               LDD     R16, Z+1
   \   0000002E   FF00               SBRS    R16, 0
   \   00000030   C005               RJMP    ??function_check_status_3
    333          			{
    334          				SCS_received.update_state_OFF = 0;
    335          				SCS_received.update_off_wait = 0;
   \   00000032   9100....           LDS     R16, (SCS_received + 1)
   \   00000036   7C0E               ANDI    R16, 0xCE
   \   00000038   9300....           STS     (SCS_received + 1), R16
    336          			}
    337          		  	
    338          			SCS_received.update_state_LEVEL = 0;
   \                     ??function_check_status_3:
   \   0000003C   8101               LDD     R16, Z+1
   \   0000003E   7F0D               ANDI    R16, 0xFD
   \   00000040   8301               STD     Z+1, R16
    339          			
    340          			if(Sensor_mode.mode_state == Initial_state)		//0520
   \   00000042   9100....           LDS     R16, Sensor_mode
   \   00000046   3001               CPI     R16, 1
   \   00000048   F409               BRNE    ??function_check_status_4
    341          			{
    342          				Stop_allTimer();
   \   0000004A   ....               RCALL   Stop_allTimer
    343          			}
    344          			if(Sensor_mode.mode_state == Re_Trigger_State)
   \                     ??function_check_status_4:
   \   0000004C   9100....           LDS     R16, Sensor_mode
   \   00000050   3003               CPI     R16, 3
   \   00000052   F4A1               BRNE    ??function_check_status_1
    345          			{
    346          				if ( (Time_delay.Re_Trigger_senconds <=4 && KO_conf.FuncMod != ManualON_Auto_OFF)
    347          				   ||(Time_delay.Re_Trigger_senconds <= Re_Trigger_30s - 1 && KO_conf.FuncMod == ManualON_Auto_OFF))
   \   00000054   9100....           LDS     R16, Time_delay
   \   00000058   3005               CPI     R16, 5
   \   0000005A   F420               BRCC    ??function_check_status_5
   \   0000005C   9100....           LDS     R16, (KO_conf + 29)
   \   00000060   3003               CPI     R16, 3
   \   00000062   F441               BRNE    ??function_check_status_6
   \                     ??function_check_status_5:
   \   00000064   9100....           LDS     R16, Time_delay
   \   00000068   310E               CPI     R16, 30
   \   0000006A   F440               BRCC    ??function_check_status_1
   \   0000006C   9100....           LDS     R16, (KO_conf + 29)
   \   00000070   3003               CPI     R16, 3
   \   00000072   F421               BRNE    ??function_check_status_1
    348          				{
    349          			  		Sensor_mode.mode_state = Maintain_state;
   \                     ??function_check_status_6:
   \   00000074   E002               LDI     R16, 2
   \   00000076   9300....           STS     Sensor_mode, R16
    350          						Call_detect_delay();
   \   0000007A   ....               RCALL   Call_detect_delay
   \                     ??function_check_status_1:
   \   0000007C   9100....           LDS     R16, (KO_conf + 29)
   \   00000080   3003               CPI     R16, 3
   \   00000082   F009               BREQ    $+2+2
   \   00000084   C054               RJMP    ??function_check_status_7
    351          				}
    352          			}
    353          	}
    354          	
    355          	if(KO_conf.FuncMod == ManualON_Auto_OFF)//((KO_conf.FuncMod == ManualON_Manual_OFF)||(KO_conf.FuncMod == ManualON_Auto_OFF))// 在manual mode，sensor不接收任何来自SCS总线上的帧
    356          	{
    357          		if(SCS_received.GS_presence == 1)
   \   00000086   ....               LDI     R26, LOW(SCS_received)
   \   00000088   ....               LDI     R27, (SCS_received) >> 8
   \   0000008A   910C               LD      R16, X
   \   0000008C   FF02               SBRS    R16, 2
   \   0000008E   C019               RJMP    ??function_check_status_8
    358          		{
    359          				SCS_received.GS_presence = 0;
   \   00000090   910C               LD      R16, X
   \   00000092   7F0B               ANDI    R16, 0xFB
   \   00000094   930C               ST      X, R16
    360          				Time_delay.GS_200ms.stack_top = 200;
   \   00000096   EC08               LDI     R16, 200
   \   00000098   E010               LDI     R17, 0
   \   0000009A   ....               LDI     R26, ((Time_delay + 25) & 0xff) & 0xFF
   \   0000009C   ....               LDI     R27, (((Time_delay + 281) >> 8) & 0xff) & 0xFF
   \   0000009E   9614               ADIW    R27:R26, 4
   \   000000A0   930D               ST      X+, R16
   \   000000A2   931D               ST      X+, R17
   \   000000A4   931D               ST      X+, R17
   \   000000A6   931C               ST      X, R17
    361          				Time_delay.GS_200ms.count = 0;
   \   000000A8   ....               LDI     R30, ((Time_delay + 25) & 0xff) & 0xFF
   \   000000AA   ....               LDI     R31, (((Time_delay + 281) >> 8) & 0xff) & 0xFF
   \   000000AC   8310               ST      Z, R17
   \   000000AE   8311               STD     Z+1, R17
   \   000000B0   8312               STD     Z+2, R17
   \   000000B2   8313               STD     Z+3, R17
    362          				Time_delay.GS_200ms.time_out = 0;
   \   000000B4   9310....           STS     (Time_delay + 289), R17
    363          				Time_delay.GS_200ms.started = 1;
   \   000000B8   E001               LDI     R16, 1
   \   000000BA   9300....           STS     (Time_delay + 291), R16
    364          				Time_delay.GS_200ms.enabled = 1;
   \   000000BE   9300....           STS     (Time_delay + 290), R16
    365          		}
    366          		
    367          		if(Time_delay.GS_200ms.time_out)
   \                     ??function_check_status_8:
   \   000000C2   9100....           LDS     R16, (Time_delay + 289)
   \   000000C6   2300               TST     R16
   \   000000C8   F049               BREQ    ??function_check_status_9
    368          		{
    369          			Time_delay.GS_200ms.time_out = 0;
   \   000000CA   E000               LDI     R16, 0
   \   000000CC   9300....           STS     (Time_delay + 289), R16
    370          		  Mode_frame_GR(KO_conf.GR,pre);	
   \   000000D0   E013               LDI     R17, 3
   \   000000D2   9100....           LDS     R16, (KO_conf + 6)
   \   000000D6   ........           CALL    Mode_frame_GR
    371          			Start_Time_Delay();	
   \   000000DA   ....               RCALL   Start_Time_Delay
    372          		}
    373          		//Sensor_mode.mode_state = Maintain_state; //0520
    374          		if(SCS_received.presence == 1)		//in manual, upadate timedelay more 20s,配合其他的auto mode的sensor
   \                     ??function_check_status_9:
   \   000000DC   ....               LDI     R30, LOW(SCS_received)
   \   000000DE   ....               LDI     R31, (SCS_received) >> 8
   \   000000E0   8100               LD      R16, Z
   \   000000E2   FF00               SBRS    R16, 0
   \   000000E4   C004               RJMP    ??function_check_status_10
    375          		{
    376          				SCS_received.presence = 0;
   \   000000E6   8100               LD      R16, Z
   \   000000E8   7F0E               ANDI    R16, 0xFE
   \   000000EA   8300               ST      Z, R16
    377          				Start_Time_Delay();
   \   000000EC   ....               RCALL   Start_Time_Delay
    378          				//Time_delay.timer_delay_set.count +=  presence_20s;
    379          		}
    380          		if(SCS_received.GR_ON == 1)
   \                     ??function_check_status_10:
   \   000000EE   ....               LDI     R30, LOW(SCS_received)
   \   000000F0   ....               LDI     R31, (SCS_received) >> 8
   \   000000F2   8100               LD      R16, Z
   \   000000F4   FF03               SBRS    R16, 3
   \   000000F6   C01C               RJMP    ??function_check_status_11
    381          		{
    382          				SCS_received.GR_ON = 0;
   \   000000F8   8100               LD      R16, Z
   \   000000FA   7F07               ANDI    R16, 0xF7
   \   000000FC   8300               ST      Z, R16
    383          				Sensor_mode.presen_timeout = 0;			// 0603
   \   000000FE   ....               LDI     R30, LOW(Sensor_mode)
   \   00000100   ....               LDI     R31, (Sensor_mode) >> 8
   \   00000102   8105               LDD     R16, Z+5
   \   00000104   7F07               ANDI    R16, 0xF7
   \   00000106   8305               STD     Z+5, R16
    384          				// STOP TIME DALAY 0601
    385          				Time_delay.timer_delay_set.enabled = 0;				// stop time set delay
   \   00000108   E000               LDI     R16, 0
   \   0000010A   9300....           STS     (Time_delay + 35), R16
    386          				Time_delay.timer_delay_set.time_out = 0;
   \   0000010E   9300....           STS     (Time_delay + 34), R16
    387          				if((KO_conf.FuncMod == ManualON_Auto_OFF)&&(Sensor_mode.flag_leader_group ==1))
   \   00000112   9100....           LDS     R16, (KO_conf + 29)
   \   00000116   3003               CPI     R16, 3
   \   00000118   F459               BRNE    ??function_check_status_11
   \   0000011A   8105               LDD     R16, Z+5
   \   0000011C   FF01               SBRS    R16, 1
   \   0000011E   C008               RJMP    ??function_check_status_11
    388          				{
    389          					Sensor_mode.mode_state = Maintain_state;			// 0601
   \   00000120   E002               LDI     R16, 2
   \   00000122   9300....           STS     Sensor_mode, R16
    390          					Walk_Through_flag = 0;			//reyno 0608
   \   00000126   E000               LDI     R16, 0
   \   00000128   9300....           STS     Walk_Through_flag, R16
   \   0000012C   C001               RJMP    ??function_check_status_11
    391          				}
    392          		}
    393          	}
    394          	else
    395          	{	
    396          		 	Check_SCS_received();
   \                     ??function_check_status_7:
   \   0000012E   ....               RCALL   Check_SCS_received
    397          	}
    398          }
   \                     ??function_check_status_11:
   \   00000130   91A9               LD      R26, Y+
   \   00000132   91B9               LD      R27, Y+
   \   00000134   9508               RET
    399          
    400          
    401          //******************************************************************************
    402          // 	Check the frame received on SCS	without manual mode
    403          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    404          void Check_SCS_received(void)					
   \                     Check_SCS_received:
    405          {
   \   00000000   ........           CALL    ?PROLOGUE4_L09
    406          		
    407          //******************************************************************************
    408          // 	if received GS "ON"
    409          //******************************************************************************	
    410          	if(SCS_received.GS_presence == 1)				// the frame sent by extern sensor of GS
   \   00000004   ....               LDI     R24, LOW(Time_delay)
   \   00000006   ....               LDI     R25, (Time_delay) >> 8
   \   00000008   ....               LDI     R30, LOW(SCS_received)
   \   0000000A   ....               LDI     R31, (SCS_received) >> 8
   \   0000000C   8100               LD      R16, Z
   \   0000000E   FF02               SBRS    R16, 2
   \   00000010   C016               RJMP    ??Check_SCS_received_0
    411          	{
    412          		SCS_received.GS_presence = 0;
   \   00000012   8100               LD      R16, Z
   \   00000014   7F0B               ANDI    R16, 0xFB
   \   00000016   8300               ST      Z, R16
    413          		Time_delay.GS_200ms.stack_top = 200;
   \   00000018   EC08               LDI     R16, 200
   \   0000001A   E010               LDI     R17, 0
   \   0000001C   ....               LDI     R30, ((Time_delay + 25) & 0xff) & 0xFF
   \   0000001E   ....               LDI     R31, (((Time_delay + 281) >> 8) & 0xff) & 0xFF
   \   00000020   8304               STD     Z+4, R16
   \   00000022   8315               STD     Z+5, R17
   \   00000024   8316               STD     Z+6, R17
   \   00000026   8317               STD     Z+7, R17
    414          		Time_delay.GS_200ms.count = 0;
   \   00000028   8310               ST      Z, R17
   \   0000002A   8311               STD     Z+1, R17
   \   0000002C   8312               STD     Z+2, R17
   \   0000002E   8313               STD     Z+3, R17
    415          		Time_delay.GS_200ms.time_out = 0;
   \   00000030   9310....           STS     (Time_delay + 289), R17
    416          		Time_delay.GS_200ms.started = 1;
   \   00000034   E001               LDI     R16, 1
   \   00000036   9300....           STS     (Time_delay + 291), R16
    417          		Time_delay.GS_200ms.enabled = 1;
   \   0000003A   9300....           STS     (Time_delay + 290), R16
    418          	}
    419          	
    420          	if(Time_delay.GS_200ms.time_out)
   \                     ??Check_SCS_received_0:
   \   0000003E   9100....           LDS     R16, (Time_delay + 289)
   \   00000042   2300               TST     R16
   \   00000044   F409               BRNE    $+2+2
   \   00000046   C04F               RJMP    ??Check_SCS_received_1
    421          	{
    422          		Time_delay.GS_200ms.time_out = 0;
   \   00000048   E000               LDI     R16, 0
   \   0000004A   9300....           STS     (Time_delay + 289), R16
    423          		if(Sensor_mode.presence_20sinterval == 0)		//0716
   \   0000004E   ....               LDI     R26, LOW(Sensor_mode)
   \   00000050   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000052   01FD               MOVW    R31:R30, R27:R26
   \   00000054   8103               LDD     R16, Z+3
   \   00000056   8114               LDD     R17, Z+4
   \   00000058   2B01               OR      R16, R17
   \   0000005A   F469               BRNE    ??Check_SCS_received_2
    424          		{
    425          			Mode_frame_GR(KO_conf.GR,pre);			// send GR frame presence;	// B5 GG 1D 00	for this frame, presence maybe doesn't needed
   \   0000005C   E013               LDI     R17, 3
   \   0000005E   9100....           LDS     R16, (KO_conf + 6)
   \   00000062   ........           CALL    Mode_frame_GR
    426          			Sensor_mode.presence_20sinterval = presence_20s;			// add 0605
   \   00000066   E200               LDI     R16, 32
   \   00000068   E41E               LDI     R17, 78
   \   0000006A   01FD               MOVW    R31:R30, R27:R26
   \   0000006C   8303               STD     Z+3, R16
   \   0000006E   8314               STD     Z+4, R17
    427          			Time_delay.GS_wait_22s = 22;			// TO Ingore the 20s presence sent by GS when end detection
   \   00000070   E106               LDI     R16, 22
   \   00000072   9300....           STS     (Time_delay + 10), R16
    428          		}
    429          		switch(Sensor_mode.mode_state)
   \                     ??Check_SCS_received_2:
   \   00000076   9100....           LDS     R16, Sensor_mode
   \   0000007A   5001               SUBI    R16, 1
   \   0000007C   F039               BREQ    ??Check_SCS_received_3
   \   0000007E   950A               DEC     R16
   \   00000080   F141               BREQ    ??Check_SCS_received_4
   \   00000082   950A               DEC     R16
   \   00000084   F141               BREQ    ??Check_SCS_received_5
   \   00000086   950A               DEC     R16
   \   00000088   F121               BREQ    ??Check_SCS_received_4
   \   0000008A   C02D               RJMP    ??Check_SCS_received_1
    430          		{
    431          			case Initial_state:		
    432          				if(DLL.current_level < set_point)			
   \                     ??Check_SCS_received_3:
   \   0000008C   9100....           LDS     R16, (DLL + 16)
   \   00000090   9110....           LDS     R17, (DLL + 17)
   \   00000094   9120....           LDS     R18, set_point
   \   00000098   9130....           LDS     R19, (set_point + 1)
   \   0000009C   1702               CP      R16, R18
   \   0000009E   0713               CPC     R17, R19
   \   000000A0   F508               BRCC    ??Check_SCS_received_6
    433          				{
    434          					//reyno 0622
    435          					if(KO_conf.LightReg == 1)
   \   000000A2   9120....           LDS     R18, (KO_conf + 28)
   \   000000A6   3021               CPI     R18, 1
   \   000000A8   F451               BRNE    ??Check_SCS_received_7
    436          					{
    437          						DLL.start_regulation = 1;
   \   000000AA   ....               LDI     R30, LOW(DLL)
   \   000000AC   ....               LDI     R31, (DLL) >> 8
   \   000000AE   A926               LDD     R18, Z+54
   \   000000B0   6021               ORI     R18, 0x01
   \   000000B2   AB26               STD     Z+54, R18
    438          						SetBit(KO_conf.status[0],Status_Regulationing);
   \   000000B4   ....               LDI     R30, LOW(KO_conf)
   \   000000B6   ....               LDI     R31, (KO_conf) >> 8
   \   000000B8   A505               LDD     R16, Z+45
   \   000000BA   6400               ORI     R16, 0x40
   \   000000BC   A705               STD     Z+45, R16
    439          					}
    440          					Sensor_mode.flag_leader_group = 1;
   \                     ??Check_SCS_received_7:
   \   000000BE   01FD               MOVW    R31:R30, R27:R26
   \   000000C0   8105               LDD     R16, Z+5
   \   000000C2   6002               ORI     R16, 0x02
   \   000000C4   8305               STD     Z+5, R16
    441          					Sensor_mode.mode_state = Maintain_state;					
   \   000000C6   E002               LDI     R16, 2
   \   000000C8   9300....           STS     Sensor_mode, R16
    442          					frame_ON_send();	
   \   000000CC   ....               RCALL   frame_ON_send
    443          					Call_detect_delay();
   \   000000CE   ....               RCALL   Call_detect_delay
   \   000000D0   C00A               RJMP    ??Check_SCS_received_1
    444          				}
    445          				else
    446          				{
    447          					Start_Time_Delay();					//if still in the initial state
    448          				}	
    449          				break;
    450          			
    451          			case Maintain_state:
    452                case Standby_state:
    453          			        WT_20s_detect();			
   \                     ??Check_SCS_received_4:
   \   000000D2   ....               RCALL   WT_20s_detect
   \   000000D4   C008               RJMP    ??Check_SCS_received_1
    454          				break;
    455          			
    456          			case Re_Trigger_State:	
    457          				Sensor_mode.mode_state = Maintain_state;
   \                     ??Check_SCS_received_5:
   \   000000D6   E002               LDI     R16, 2
   \   000000D8   9300....           STS     Sensor_mode, R16
    458          				Time_delay.Re_Trigger_senconds = 0;            // clear the retrigger time delay when leave the retrogger state		
   \   000000DC   E000               LDI     R16, 0
   \   000000DE   9300....           STS     Time_delay, R16
    459                                  frame_ON_send();	
   \   000000E2   ....               RCALL   frame_ON_send
    460          				Start_Time_Delay();														// in the walk_through won't go into the rerigger	
   \                     ??Check_SCS_received_6:
   \   000000E4   ....               RCALL   Start_Time_Delay
    461          				break;
    462          				
    463          			default:  break;				
    464          		}
    465          	}
    466          //******************************************************************************
    467          // 	if received GR "ON"
    468          //******************************************************************************
    469          	if(SCS_received.GR_ON == 1)
   \                     ??Check_SCS_received_1:
   \   000000E6   ....               LDI     R30, LOW(SCS_received)
   \   000000E8   ....               LDI     R31, (SCS_received) >> 8
   \   000000EA   8100               LD      R16, Z
   \   000000EC   FF03               SBRS    R16, 3
   \   000000EE   C069               RJMP    ??Check_SCS_received_8
    470          	{
    471          		//reyno 0622
    472          		if(KO_conf.LightReg == 1)
   \   000000F0   9120....           LDS     R18, (KO_conf + 28)
   \   000000F4   3021               CPI     R18, 1
   \   000000F6   F461               BRNE    ??Check_SCS_received_9
    473          		{	
    474          			DLL.start_regulation = 1;
   \   000000F8   ....               LDI     R30, LOW(DLL)
   \   000000FA   ....               LDI     R31, (DLL) >> 8
   \   000000FC   A926               LDD     R18, Z+54
   \   000000FE   6021               ORI     R18, 0x01
   \   00000100   AB26               STD     Z+54, R18
    475          			SetBit(KO_conf.status[0],Status_Regulationing);
   \   00000102   ....               LDI     R30, LOW(KO_conf)
   \   00000104   ....               LDI     R31, (KO_conf) >> 8
   \   00000106   A505               LDD     R16, Z+45
   \   00000108   6400               ORI     R16, 0x40
   \   0000010A   A705               STD     Z+45, R16
    476          			regulation_timer_initial();
   \   0000010C   ........           CALL    regulation_timer_initial
    477          		}		
    478          	       // SCS_received.presence_2_ON = 1;		// debug
    479          		SCS_received.GR_ON = 0;
   \                     ??Check_SCS_received_9:
   \   00000110   ....               LDI     R30, LOW(SCS_received)
   \   00000112   ....               LDI     R31, (SCS_received) >> 8
   \   00000114   8100               LD      R16, Z
   \   00000116   7F07               ANDI    R16, 0xF7
   \   00000118   8300               ST      Z, R16
    480          	        //Time_delay.frame_200ms.time_out = 0;  // 避免在误执行单独接收presence的程序
    481          		Time_delay.timer_takeline.enabled = 0;
   \   0000011A   E000               LDI     R16, 0
   \   0000011C   9300....           STS     (Time_delay + 46), R16
    482          		Time_delay.timer_takeline.started = 0;
   \   00000120   9300....           STS     (Time_delay + 47), R16
    483          		Time_delay.frame_200ms.enabled = 0;
   \   00000124   9300....           STS     (Time_delay + 57), R16
    484          		Time_delay.frame_200ms.started = 0;
   \   00000128   9300....           STS     (Time_delay + 58), R16
    485          		//Sensor_mode.flag_leader_group = 0;					// debug 20090423
    486          		
    487          		switch(Sensor_mode.mode_state)
   \   0000012C   9100....           LDS     R16, Sensor_mode
   \   00000130   5001               SUBI    R16, 1
   \   00000132   F069               BREQ    ??Check_SCS_received_10
   \   00000134   950A               DEC     R16
   \   00000136   F029               BREQ    ??Check_SCS_received_11
   \   00000138   950A               DEC     R16
   \   0000013A   F131               BREQ    ??Check_SCS_received_12
   \   0000013C   950A               DEC     R16
   \   0000013E   F159               BREQ    ??Check_SCS_received_13
   \   00000140   C040               RJMP    ??Check_SCS_received_8
    488          		{
    489          			/*case Initial_state:	
    490          				if(SCS_received.presence_2_ON == 1)		
    491          				{
    492          					SCS_received.presence_2_ON = 0;
    493          					Sensor_mode.mode_state = Standby_state;
    494          					Sensor_mode.flag_leader_group = 0;	
    495          					Call_detect_delay();
    496          				}
    497          			    break;
    498                 */
    499          			
    500          			case Maintain_state:
    501                     if(SCS_received.presence_2_ON != 1)
   \                     ??Check_SCS_received_11:
   \   00000142   8101               LDD     R16, Z+1
   \   00000144   FD06               SBRC    R16, 6
   \   00000146   C003               RJMP    ??Check_SCS_received_10
    502          							Walk_Through_flag = 0;    								//  received signal ON frame
   \   00000148   E000               LDI     R16, 0
   \   0000014A   9300....           STS     Walk_Through_flag, R16
    503                //break;
    504          			
    505                case Initial_state:
    506          				if(SCS_received.presence_2_ON == 1)							//received presence and ON frame
   \                     ??Check_SCS_received_10:
   \   0000014E   8101               LDD     R16, Z+1
   \   00000150   FF06               SBRS    R16, 6
   \   00000152   C014               RJMP    ??Check_SCS_received_14
    507          				{
    508          					SCS_received.presence_2_ON = 0;	
   \   00000154   8101               LDD     R16, Z+1
   \   00000156   7B0F               ANDI    R16, 0xBF
   \   00000158   8301               STD     Z+1, R16
    509                   	Sensor_mode.flag_leader_group = 0;
   \   0000015A   ....               LDI     R30, LOW(Sensor_mode)
   \   0000015C   ....               LDI     R31, (Sensor_mode) >> 8
   \   0000015E   8105               LDD     R16, Z+5
   \   00000160   7F0D               ANDI    R16, 0xFD
   \   00000162   8305               STD     Z+5, R16
    510          					Sensor_mode.mode_state = Standby_state;
   \   00000164   E004               LDI     R16, 4
   \   00000166   9300....           STS     Sensor_mode, R16
    511          					Sensor_mode.presence_send = 1; //Reyno 0623
   \   0000016A   8105               LDD     R16, Z+5
   \   0000016C   6004               ORI     R16, 0x04
   \   0000016E   8305               STD     Z+5, R16
    512          					Sensor_mode.presence_20sinterval = presence_20s;				// 0717
   \   00000170   E200               LDI     R16, 32
   \   00000172   E41E               LDI     R17, 78
   \   00000174   8303               STD     Z+3, R16
   \   00000176   8314               STD     Z+4, R17
    513          					Call_detect_delay();
   \   00000178   ....               RCALL   Call_detect_delay
   \   0000017A   C023               RJMP    ??Check_SCS_received_8
    514          				}
    515          				//else if((KO_conf.FuncMod == ManualON_Auto_OFF)&&(Sensor_mode.flag_leader_group ==1))
    516          				//{
    517          				//	Sensor_mode.mode_state = Maintain_state;			// 注释，放到前面去处理 0601
    518          					//Call_detect_delay();
    519          				//}
    520          				else
    521          				{
    522          					// STOP TIME DALAY 0601
    523          						Time_delay.timer_delay_set.enabled = 0;				// stop time set delay
   \                     ??Check_SCS_received_14:
   \   0000017C   E000               LDI     R16, 0
   \   0000017E   9300....           STS     (Time_delay + 35), R16
    524          						Time_delay.timer_delay_set.time_out = 0;
   \   00000182   9300....           STS     (Time_delay + 34), R16
   \   00000186   C01D               RJMP    ??Check_SCS_received_8
    525          				}
    526          			    break;
    527          			
    528          			case Re_Trigger_State:	
    529          
    530          				Sensor_mode.mode_state = Maintain_state;				//Standby_state;
   \                     ??Check_SCS_received_12:
   \   00000188   E002               LDI     R16, 2
   \   0000018A   9300....           STS     Sensor_mode, R16
    531          				Time_delay.Re_Trigger_senconds = 0;		
   \   0000018E   E000               LDI     R16, 0
   \   00000190   9300....           STS     Time_delay, R16
    532          				Start_Time_Delay();
   \   00000194   C015               RJMP    ??Check_SCS_received_15
    533          			    break;
    534          			
    535          			case Standby_state:
    536          			
    537          				if(SCS_received.presence_2_ON == 1)							//received presence and ON frame
   \                     ??Check_SCS_received_13:
   \   00000196   8101               LDD     R16, Z+1
   \   00000198   FF06               SBRS    R16, 6
   \   0000019A   C013               RJMP    ??Check_SCS_received_8
    538          				{
    539          					SCS_received.presence_2_ON = 0;
   \   0000019C   8101               LDD     R16, Z+1
   \   0000019E   7B0F               ANDI    R16, 0xBF
   \   000001A0   8301               STD     Z+1, R16
    540          					Time_delay.Re_Trigger_senconds = 0;
   \   000001A2   E000               LDI     R16, 0
   \   000001A4   9300....           STS     Time_delay, R16
    541          					Time_delay.Walk_Through_Timeout = 0;
   \   000001A8   E010               LDI     R17, 0
   \   000001AA   01FC               MOVW    R31:R30, R25:R24
   \   000001AC   8301               STD     Z+1, R16
   \   000001AE   8302               STD     Z+2, R16
    542          
    543          					if(Walk_Through_flag == 1)	
   \   000001B0   9100....           LDS     R16, Walk_Through_flag
   \   000001B4   3001               CPI     R16, 1
   \   000001B6   F421               BRNE    ??Check_SCS_received_15
    544          						Time_delay.Walk_Through_Timeout = Walkthru_delay;	
   \   000001B8   EB04               LDI     R16, 180
   \   000001BA   8301               STD     Z+1, R16
   \   000001BC   8312               STD     Z+2, R17
   \   000001BE   C001               RJMP    ??Check_SCS_received_8
    545          					else
    546          						Start_Time_Delay();
   \                     ??Check_SCS_received_15:
   \   000001C0   ....               RCALL   Start_Time_Delay
    547          				}
    548          				// start light regulation if received signal ON frame
    549          			    break;
    550          				
    551          			default:  break;				
    552          		}	
    553          	}
    554          	
    555          	
    556          //******************************************************************************
    557          // 	if received GR "presence" frame
    558          //******************************************************************************
    559          	if(SCS_received.presence == 1)					
   \                     ??Check_SCS_received_8:
   \   000001C2   ....               LDI     R30, LOW(SCS_received)
   \   000001C4   ....               LDI     R31, (SCS_received) >> 8
   \   000001C6   8100               LD      R16, Z
   \   000001C8   FF00               SBRS    R16, 0
   \   000001CA   C019               RJMP    ??Check_SCS_received_16
    560          	{
    561          		SCS_received.presence = 0;
   \   000001CC   8100               LD      R16, Z
   \   000001CE   7F0E               ANDI    R16, 0xFE
   \   000001D0   8300               ST      Z, R16
    562          		if(Time_delay.frame_200ms.started == 0) // delay 200ms start
   \   000001D2   9100....           LDS     R16, (Time_delay + 58)
   \   000001D6   2300               TST     R16
   \   000001D8   F491               BRNE    ??Check_SCS_received_16
    563          		{
    564          			Time_delay.frame_200ms.count = 0;
   \   000001DA   E000               LDI     R16, 0
   \   000001DC   01FC               MOVW    R31:R30, R25:R24
   \   000001DE   AB00               STD     Z+48, R16
   \   000001E0   AB01               STD     Z+49, R16
   \   000001E2   AB02               STD     Z+50, R16
   \   000001E4   AB03               STD     Z+51, R16
    565          			Time_delay.frame_200ms.time_out = 0;
   \   000001E6   9300....           STS     (Time_delay + 56), R16
    566          			Time_delay.frame_200ms.enabled = 1;
   \   000001EA   E001               LDI     R16, 1
   \   000001EC   9300....           STS     (Time_delay + 57), R16
    567          			Time_delay.frame_200ms.started = 1;
   \   000001F0   9300....           STS     (Time_delay + 58), R16
    568          			SCS_received.presence_2_ON = 1;		 // 在200ms内，标志位置一，收到ON帧时可以据此判断接收到的是ON,还是presence+ON
   \   000001F4   ....               LDI     R30, LOW(SCS_received)
   \   000001F6   ....               LDI     R31, (SCS_received) >> 8
   \   000001F8   8101               LDD     R16, Z+1
   \   000001FA   6400               ORI     R16, 0x40
   \   000001FC   8301               STD     Z+1, R16
    569          		}
    570          	}
    571          	if((Time_delay.frame_200ms.time_out == 1)&&(SCS_received.GR_ON == 0))	// 接收到presence200ms后，还没有接收到ON，就认为是单独的一个presence帧
   \                     ??Check_SCS_received_16:
   \   000001FE   9100....           LDS     R16, (Time_delay + 56)
   \   00000202   3001               CPI     R16, 1
   \   00000204   F009               BREQ    $+2+2
   \   00000206   C064               RJMP    ??Check_SCS_received_17
   \   00000208   8100               LD      R16, Z
   \   0000020A   FD03               SBRC    R16, 3
   \   0000020C   C061               RJMP    ??Check_SCS_received_17
    572          	{
    573          		// 做在200ms结束后第一次执行到此，并且恰在此时接收到SCS_received.GR_ON==1；就会出现多执行一次presence的bug（很少发生）
    574          		Time_delay.frame_200ms.time_out = 0;
   \   0000020E   E000               LDI     R16, 0
   \   00000210   9300....           STS     (Time_delay + 56), R16
    575          		switch(Sensor_mode.mode_state)
   \   00000214   ....               LDI     R26, LOW(Sensor_mode)
   \   00000216   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000218   9100....           LDS     R16, Sensor_mode
   \   0000021C   5001               SUBI    R16, 1
   \   0000021E   F041               BREQ    ??Check_SCS_received_18
   \   00000220   950A               DEC     R16
   \   00000222   F1E1               BREQ    ??Check_SCS_received_19
   \   00000224   950A               DEC     R16
   \   00000226   F409               BRNE    $+2+2
   \   00000228   C046               RJMP    ??Check_SCS_received_20
   \   0000022A   950A               DEC     R16
   \   0000022C   F1B9               BREQ    ??Check_SCS_received_19
   \   0000022E   C050               RJMP    ??Check_SCS_received_17
    576          		{
    577          			case Initial_state:	
    578          				if(DLL.current_level < set_point)
   \                     ??Check_SCS_received_18:
   \   00000230   9100....           LDS     R16, (DLL + 16)
   \   00000234   9110....           LDS     R17, (DLL + 17)
   \   00000238   9120....           LDS     R18, set_point
   \   0000023C   9130....           LDS     R19, (set_point + 1)
   \   00000240   1702               CP      R16, R18
   \   00000242   0713               CPC     R17, R19
   \   00000244   F548               BRCC    ??Check_SCS_received_21
    579          				{
    580                    if(KO_conf.LightReg == 1)
   \   00000246   9120....           LDS     R18, (KO_conf + 28)
   \   0000024A   3021               CPI     R18, 1
   \   0000024C   F451               BRNE    ??Check_SCS_received_22
    581          					{
    582          						DLL.start_regulation = 1;  //reyno 0622
   \   0000024E   ....               LDI     R30, LOW(DLL)
   \   00000250   ....               LDI     R31, (DLL) >> 8
   \   00000252   A926               LDD     R18, Z+54
   \   00000254   6021               ORI     R18, 0x01
   \   00000256   AB26               STD     Z+54, R18
    583          						SetBit(KO_conf.status[0],Status_Regulationing);
   \   00000258   ....               LDI     R30, LOW(KO_conf)
   \   0000025A   ....               LDI     R31, (KO_conf) >> 8
   \   0000025C   A505               LDD     R16, Z+45
   \   0000025E   6400               ORI     R16, 0x40
   \   00000260   A705               STD     Z+45, R16
    584          					}
    585          						Call_detect_delay();				
   \                     ??Check_SCS_received_22:
   \   00000262   ....               RCALL   Call_detect_delay
    586          						if(Sensor_mode.flag_leader_group == 1)
   \   00000264   01FD               MOVW    R31:R30, R27:R26
   \   00000266   8105               LDD     R16, Z+5
   \   00000268   FF01               SBRS    R16, 1
   \   0000026A   C00F               RJMP    ??Check_SCS_received_23
    587          						{
    588          								Sensor_mode.mode_state = Maintain_state;		
   \   0000026C   E002               LDI     R16, 2
   \   0000026E   9300....           STS     Sensor_mode, R16
    589          								if(Walk_Through_flag != 1)
   \   00000272   9100....           LDS     R16, Walk_Through_flag
   \   00000276   3001               CPI     R16, 1
   \   00000278   F129               BREQ    ??Check_SCS_received_24
    590          								{
    591          									Sensor_mode.maintain_pre = 1;											//0518
   \   0000027A   8107               LDD     R16, Z+7
   \   0000027C   6100               ORI     R16, 0x10
   \   0000027E   8307               STD     Z+7, R16
    592          									Sensor_mode.presence_20sinterval = presence_20s;		//0518
   \   00000280   E200               LDI     R16, 32
   \   00000282   E41E               LDI     R17, 78
   \   00000284   8303               STD     Z+3, R16
   \   00000286   8314               STD     Z+4, R17
    593          								}
    594          								Mode_frame_GR(KO_conf.GR,pre);											// send GR frame presence;	// B5 GG 1D 00
   \   00000288   C01D               RJMP    ??Check_SCS_received_24
    595          								frame_ON_send();
    596          						}
    597          						else
    598          						{
    599          								Sensor_mode.mode_state = Initial_state;
   \                     ??Check_SCS_received_23:
   \   0000028A   E001               LDI     R16, 1
   \   0000028C   9300....           STS     Sensor_mode, R16
    600          								Sensor_mode.ON_takeline_waitsend = 1;								//	ON_takeline();	//WITH Special TAKING LINE to send presence+ON							
   \   00000290   8107               LDD     R16, Z+7
   \   00000292   6001               ORI     R16, 0x01
   \   00000294   8307               STD     Z+7, R16
   \   00000296   C01C               RJMP    ??Check_SCS_received_17
    601          						}						
    602          				}
    603          				else
    604          				{
    605          						Start_Time_Delay();																			// start time dalay if still in initial state
   \                     ??Check_SCS_received_21:
   \   00000298   ....               RCALL   Start_Time_Delay
   \   0000029A   C01A               RJMP    ??Check_SCS_received_17
    606          				}
    607          				break;
    608          			
    609          			case Maintain_state:
    610          	        case Standby_state:
    611          				WT_20s_detect();
   \                     ??Check_SCS_received_19:
   \   0000029C   ....               RCALL   WT_20s_detect
    612                  Sensor_mode.presence_20sinterval = presence_20s;
   \   0000029E   E200               LDI     R16, 32
   \   000002A0   E41E               LDI     R17, 78
   \   000002A2   01FD               MOVW    R31:R30, R27:R26
   \   000002A4   8303               STD     Z+3, R16
   \   000002A6   8314               STD     Z+4, R17
    613          				Sensor_mode.maintain_pre = 1;
   \   000002A8   8107               LDD     R16, Z+7
   \   000002AA   6100               ORI     R16, 0x10
   \   000002AC   8307               STD     Z+7, R16
    614          				Sensor_mode.presence_send = 1; //Reyno 0623
   \   000002AE   8105               LDD     R16, Z+5
   \   000002B0   6004               ORI     R16, 0x04
   \   000002B2   8305               STD     Z+5, R16
   \   000002B4   C00D               RJMP    ??Check_SCS_received_17
    615          				//Mode_frame_GR(KO_conf.GR,pre);			// I don't think the sensor should resend the presence frame after it received a presence frame
    616          				// Mode_frame_GR('5','1','D','0','B');		// B5 GG 1D 00  for debug
    617          				break;
    618          				
    619          			case Re_Trigger_State:	
    620          			
    621          				Sensor_mode.mode_state = Maintain_state;
   \                     ??Check_SCS_received_20:
   \   000002B6   E002               LDI     R16, 2
   \   000002B8   9300....           STS     Sensor_mode, R16
    622          				Time_delay.Re_Trigger_senconds = 0; 		
   \   000002BC   E000               LDI     R16, 0
   \   000002BE   9300....           STS     Time_delay, R16
    623          				Start_Time_Delay();
   \   000002C2   ....               RCALL   Start_Time_Delay
    624          				Mode_frame_GR(KO_conf.GR,pre);				// send GR frame presence;
   \                     ??Check_SCS_received_24:
   \   000002C4   E013               LDI     R17, 3
   \   000002C6   9100....           LDS     R16, (KO_conf + 6)
   \   000002CA   ........           CALL    Mode_frame_GR
    625          				frame_ON_send();
   \   000002CE   ....               RCALL   frame_ON_send
    626          				break;
    627          			
    628          			default: break;				
    629          		}		
    630          		
    631          	}
    632          	
    633          //******************************************************************************
    634          // 	if received GR "NO presence" or "OFF"
    635          //******************************************************************************
    636          	if(SCS_received.no_presence == 1)
   \                     ??Check_SCS_received_17:
   \   000002D0   ....               LDI     R30, LOW(SCS_received)
   \   000002D2   ....               LDI     R31, (SCS_received) >> 8
   \   000002D4   8100               LD      R16, Z
   \   000002D6   FF01               SBRS    R16, 1
   \   000002D8   C006               RJMP    ??Check_SCS_received_25
    637          	{
    638          		SCS_received.no_presence = 0;
   \   000002DA   8100               LD      R16, Z
   \   000002DC   7F0D               ANDI    R16, 0xFD
   \   000002DE   8300               ST      Z, R16
    639          		SCS_received.nopresence_2_OFF = 1;				//  received no presence frame
   \   000002E0   8101               LDD     R16, Z+1
   \   000002E2   6800               ORI     R16, 0x80
   \   000002E4   8301               STD     Z+1, R16
    640          	}
    641          	
    642          	if(KO_conf.AddressType == PP)
   \                     ??Check_SCS_received_25:
   \   000002E6   9120....           LDS     R18, (KO_conf + 1)
   \   000002EA   2322               TST     R18
   \   000002EC   F501               BRNE    ??Check_SCS_received_26
    643          	{
    644          		switch(Sensor_mode.mode_state)
   \   000002EE   9100....           LDS     R16, Sensor_mode
   \   000002F2   3002               CPI     R16, 2
   \   000002F4   F4E1               BRNE    ??Check_SCS_received_26
    645          		{
    646          			case Initial_state:	
    647          			break;
    648          				
    649          			case Maintain_state:
    650          				if(SCS_received.nopresence_2_OFF == 1)
   \   000002F6   8101               LDD     R16, Z+1
   \   000002F8   FF07               SBRS    R16, 7
   \   000002FA   C019               RJMP    ??Check_SCS_received_26
    651          				{
    652          				  SCS_received.nopresence_2_OFF = 0;			
   \   000002FC   8101               LDD     R16, Z+1
   \   000002FE   770F               ANDI    R16, 0x7F
   \   00000300   8301               STD     Z+1, R16
    653          					Sensor_mode.flag_leader_group = 0;	
   \   00000302   ....               LDI     R30, LOW(Sensor_mode)
   \   00000304   ....               LDI     R31, (Sensor_mode) >> 8
   \   00000306   8105               LDD     R16, Z+5
   \   00000308   7F0D               ANDI    R16, 0xFD
   \   0000030A   8305               STD     Z+5, R16
    654          					Time_delay.timer_takeline.enabled = 0;		// after received the frame no presence and OFF, stop the taking line
   \   0000030C   E000               LDI     R16, 0
   \   0000030E   9300....           STS     (Time_delay + 46), R16
    655          					Time_delay.timer_takeline.time_out = 0;			
   \   00000312   9300....           STS     (Time_delay + 45), R16
    656          					Sensor_mode.mode_state = Standby_state;
   \   00000316   E004               LDI     R16, 4
   \   00000318   9300....           STS     Sensor_mode, R16
    657          
    658          					if(KO_conf.FuncMod != ManualON_Auto_OFF)	
   \   0000031C   9100....           LDS     R16, (KO_conf + 29)
   \   00000320   3003               CPI     R16, 3
   \   00000322   F011               BREQ    ??Check_SCS_received_27
    659          					  Time_delay.Re_Trigger_senconds = Re_Trigger_5s;
   \   00000324   E005               LDI     R16, 5
   \   00000326   C001               RJMP    ??Check_SCS_received_28
    660          					else						
    661          					  Time_delay.Re_Trigger_senconds = Re_Trigger_30s;
   \                     ??Check_SCS_received_27:
   \   00000328   E10E               LDI     R16, 30
   \                     ??Check_SCS_received_28:
   \   0000032A   9300....           STS     Time_delay, R16
    662          				}
    663          			break;
    664          			
    665          			case Re_Trigger_State:
    666          			break;
    667          			
    668          			case Standby_state:
    669          			break;
    670          			
    671          			default:break;
    672          		}
    673          	}
    674          	
    675          	if(SCS_received.GR_OFF == 1)
   \                     ??Check_SCS_received_26:
   \   0000032E   ....               LDI     R30, LOW(SCS_received)
   \   00000330   ....               LDI     R31, (SCS_received) >> 8
   \   00000332   8100               LD      R16, Z
   \   00000334   FF04               SBRS    R16, 4
   \   00000336   C0D4               RJMP    ??Check_SCS_received_29
    676          	{
    677          		SCS_received.GR_OFF = 0;
   \   00000338   8100               LD      R16, Z
   \   0000033A   7E0F               ANDI    R16, 0xEF
   \   0000033C   8300               ST      Z, R16
    678          
    679          		switch(Sensor_mode.mode_state)
   \   0000033E   ....               LDI     R26, LOW(Sensor_mode)
   \   00000340   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000342   9100....           LDS     R16, Sensor_mode
   \   00000346   5001               SUBI    R16, 1
   \   00000348   F049               BREQ    ??Check_SCS_received_30
   \   0000034A   950A               DEC     R16
   \   0000034C   F0C1               BREQ    ??Check_SCS_received_31
   \   0000034E   950A               DEC     R16
   \   00000350   F409               BRNE    $+2+2
   \   00000352   C058               RJMP    ??Check_SCS_received_32
   \   00000354   950A               DEC     R16
   \   00000356   F409               BRNE    $+2+2
   \   00000358   C076               RJMP    ??Check_SCS_received_33
   \   0000035A   C0C2               RJMP    ??Check_SCS_received_29
    680          		{
    681          			case Initial_state:	
    682          				if(SCS_received.nopresence_2_OFF == 1)			//received no presence and OFF frame
   \                     ??Check_SCS_received_30:
   \   0000035C   8101               LDD     R16, Z+1
   \   0000035E   FF07               SBRS    R16, 7
   \   00000360   C0BF               RJMP    ??Check_SCS_received_29
    683          				{
    684          					SCS_received.nopresence_2_OFF = 0;
   \   00000362   8101               LDD     R16, Z+1
   \   00000364   770F               ANDI    R16, 0x7F
   \   00000366   8301               STD     Z+1, R16
    685          					Sensor_mode.flag_leader_group = 0;	
   \   00000368   01FD               MOVW    R31:R30, R27:R26
   \   0000036A   8105               LDD     R16, Z+5
   \   0000036C   7F0D               ANDI    R16, 0xFD
   \   0000036E   8305               STD     Z+5, R16
    686          					Time_delay.timer_takeline.enabled = 0;		// after received the frame no presence and OFF, stop the taking line
   \   00000370   E000               LDI     R16, 0
   \   00000372   9300....           STS     (Time_delay + 46), R16
    687          					Time_delay.timer_takeline.time_out = 0;
   \   00000376   9300....           STS     (Time_delay + 45), R16
    688          					Stop_allTimer();		//0520
   \   0000037A   ....               RCALL   Stop_allTimer
   \   0000037C   C0B1               RJMP    ??Check_SCS_received_29
    689          				}
    690          				else		
    691          				{
    692                                                  // signal frame OFF
    693          				}
    694          			     break;
    695          				
    696          			 case Maintain_state:
    697          				
    698          				if(SCS_received.nopresence_2_OFF == 1)			//received no presence and OFF frame
   \                     ??Check_SCS_received_31:
   \   0000037E   8101               LDD     R16, Z+1
   \   00000380   FF07               SBRS    R16, 7
   \   00000382   C019               RJMP    ??Check_SCS_received_34
    699          				{
    700          					SCS_received.nopresence_2_OFF = 0;			
   \   00000384   8101               LDD     R16, Z+1
   \   00000386   770F               ANDI    R16, 0x7F
   \   00000388   8301               STD     Z+1, R16
    701          					Sensor_mode.flag_leader_group = 0;	
   \   0000038A   01FD               MOVW    R31:R30, R27:R26
   \   0000038C   8105               LDD     R16, Z+5
   \   0000038E   7F0D               ANDI    R16, 0xFD
   \   00000390   8305               STD     Z+5, R16
    702          					Time_delay.timer_takeline.enabled = 0;		// after received the frame no presence and OFF, stop the taking line
   \   00000392   E000               LDI     R16, 0
   \   00000394   9300....           STS     (Time_delay + 46), R16
    703          					Time_delay.timer_takeline.time_out = 0;			
   \   00000398   9300....           STS     (Time_delay + 45), R16
    704          					Sensor_mode.mode_state = Standby_state;
   \   0000039C   E004               LDI     R16, 4
   \   0000039E   9300....           STS     Sensor_mode, R16
    705          					if(KO_conf.FuncMod != ManualON_Auto_OFF)	
   \   000003A2   9100....           LDS     R16, (KO_conf + 29)
   \   000003A6   3003               CPI     R16, 3
   \   000003A8   F021               BREQ    ??Check_SCS_received_35
    706          					  Time_delay.Re_Trigger_senconds = Re_Trigger_5s;
   \   000003AA   E005               LDI     R16, 5
   \                     ??Check_SCS_received_36:
   \   000003AC   9300....           STS     Time_delay, R16
   \   000003B0   C097               RJMP    ??Check_SCS_received_29
    707          					else						
    708          					  Time_delay.Re_Trigger_senconds = Re_Trigger_30s;	
   \                     ??Check_SCS_received_35:
   \   000003B2   E10E               LDI     R16, 30
   \   000003B4   CFFB               RJMP    ??Check_SCS_received_36
    709          				}
    710          				else				// signal frame OFF
    711          				{
    712          					if(Delay_Time_set > Walkthru_delay)		
   \                     ??Check_SCS_received_34:
   \   000003B6   ....               LDI     R30, LOW(Delay_Time_set)
   \   000003B8   ....               LDI     R31, (Delay_Time_set) >> 8
   \   000003BA   8100               LD      R16, Z
   \   000003BC   8111               LDD     R17, Z+1
   \   000003BE   8122               LDD     R18, Z+2
   \   000003C0   8133               LDD     R19, Z+3
   \   000003C2   3B05               CPI     R16, 181
   \   000003C4   E040               LDI     R20, 0
   \   000003C6   0714               CPC     R17, R20
   \   000003C8   0724               CPC     R18, R20
   \   000003CA   0734               CPC     R19, R20
   \   000003CC   F028               BRCS    ??Check_SCS_received_37
    713          						Time_delay.Walk_Through_Timeout = Walkthru_delay;
   \   000003CE   EB04               LDI     R16, 180
   \   000003D0   01FC               MOVW    R31:R30, R25:R24
   \   000003D2   8301               STD     Z+1, R16
   \   000003D4   8342               STD     Z+2, R20
   \   000003D6   C007               RJMP    ??Check_SCS_received_38
    714          					else									
    715          						Time_delay.Walk_Through_Timeout = Delay_Time_set;
   \                     ??Check_SCS_received_37:
   \   000003D8   8100               LD      R16, Z
   \   000003DA   8111               LDD     R17, Z+1
   \   000003DC   8122               LDD     R18, Z+2
   \   000003DE   8133               LDD     R19, Z+3
   \   000003E0   01FC               MOVW    R31:R30, R25:R24
   \   000003E2   8301               STD     Z+1, R16
   \   000003E4   8312               STD     Z+2, R17
    716          					
    717          					Walk_Through_flag = 1;
   \                     ??Check_SCS_received_38:
   \   000003E6   E001               LDI     R16, 1
   \   000003E8   9300....           STS     Walk_Through_flag, R16
    718          					Time_delay.detect_waitting = 20000;		// 0601 detection is disabled 20s
   \   000003EC   E200               LDI     R16, 32
   \   000003EE   E41E               LDI     R17, 78
   \   000003F0   8703               STD     Z+11, R16
   \   000003F2   8714               STD     Z+12, R17
    719          					if(KO_conf.FuncMod == Auto_Walk_thru)
   \   000003F4   9100....           LDS     R16, (KO_conf + 29)
   \   000003F8   3002               CPI     R16, 2
   \   000003FA   F009               BREQ    $+2+2
   \   000003FC   C071               RJMP    ??Check_SCS_received_29
    720          						First_detection_enable = 0;
   \   000003FE   9340....           STS     First_detection_enable, R20
   \   00000402   C06E               RJMP    ??Check_SCS_received_29
    721          				}
    722          			      break;
    723          				
    724          			  case Re_Trigger_State:	
    725          					Walk_Through_flag = 1;
   \                     ??Check_SCS_received_32:
   \   00000404   E001               LDI     R16, 1
   \   00000406   9300....           STS     Walk_Through_flag, R16
    726          					if(Delay_Time_set > Walkthru_delay)		
   \   0000040A   ....               LDI     R30, LOW(Delay_Time_set)
   \   0000040C   ....               LDI     R31, (Delay_Time_set) >> 8
   \   0000040E   8100               LD      R16, Z
   \   00000410   8111               LDD     R17, Z+1
   \   00000412   8122               LDD     R18, Z+2
   \   00000414   8133               LDD     R19, Z+3
   \   00000416   3B05               CPI     R16, 181
   \   00000418   E040               LDI     R20, 0
   \   0000041A   0714               CPC     R17, R20
   \   0000041C   0724               CPC     R18, R20
   \   0000041E   0734               CPC     R19, R20
   \   00000420   F028               BRCS    ??Check_SCS_received_39
    727          						Time_delay.Walk_Through_Timeout = Walkthru_delay;
   \   00000422   EB04               LDI     R16, 180
   \   00000424   01FC               MOVW    R31:R30, R25:R24
   \   00000426   8301               STD     Z+1, R16
   \   00000428   8342               STD     Z+2, R20
   \   0000042A   C007               RJMP    ??Check_SCS_received_40
    728          					else									
    729          						Time_delay.Walk_Through_Timeout = Delay_Time_set;	
   \                     ??Check_SCS_received_39:
   \   0000042C   8100               LD      R16, Z
   \   0000042E   8111               LDD     R17, Z+1
   \   00000430   8122               LDD     R18, Z+2
   \   00000432   8133               LDD     R19, Z+3
   \   00000434   01FC               MOVW    R31:R30, R25:R24
   \   00000436   8301               STD     Z+1, R16
   \   00000438   8312               STD     Z+2, R17
    730          					
    731          					Sensor_mode.mode_state = Maintain_state;
   \                     ??Check_SCS_received_40:
   \   0000043A   E002               LDI     R16, 2
   \   0000043C   9300....           STS     Sensor_mode, R16
    732          					Time_delay.Re_Trigger_senconds = 0;
   \   00000440   9340....           STS     Time_delay, R20
    733          					Time_delay.detect_waitting = 20000;		// 0601 detection is disabled 20s
   \   00000444   C049               RJMP    ??Check_SCS_received_41
    734          			      break;
    735          				
    736          			  case Standby_state:
    737          				if(SCS_received.nopresence_2_OFF == 1)			// received no presence and OFF
   \                     ??Check_SCS_received_33:
   \   00000446   8101               LDD     R16, Z+1
   \   00000448   FF07               SBRS    R16, 7
   \   0000044A   C02B               RJMP    ??Check_SCS_received_42
    738          				{
    739          					SCS_received.nopresence_2_OFF = 0;
   \   0000044C   8101               LDD     R16, Z+1
   \   0000044E   770F               ANDI    R16, 0x7F
   \   00000450   8301               STD     Z+1, R16
    740          					Sensor_mode.flag_leader_group = 0;				// this is no need, because Sensor_mode.flag_leader_group = 0
   \   00000452   01FD               MOVW    R31:R30, R27:R26
   \   00000454   8105               LDD     R16, Z+5
   \   00000456   7F0D               ANDI    R16, 0xFD
   \   00000458   8305               STD     Z+5, R16
    741          
    742          					Time_delay.timer_takeline.enabled = 0;		// after received the frame no presence and OFF, stop the taking line
   \   0000045A   E000               LDI     R16, 0
   \   0000045C   9300....           STS     (Time_delay + 46), R16
    743          					Time_delay.timer_takeline.time_out = 0;
   \   00000460   9300....           STS     (Time_delay + 45), R16
    744          					Time_delay.timer_delay_set.enabled = 0;		// stop time set delay
   \   00000464   9300....           STS     (Time_delay + 35), R16
    745          					Time_delay.timer_delay_set.time_out = 0;
   \   00000468   9300....           STS     (Time_delay + 34), R16
    746          					Time_delay.Walk_Through_Timeout = 0;			// stop walk_through delay	
   \   0000046C   E010               LDI     R17, 0
   \   0000046E   01FC               MOVW    R31:R30, R25:R24
   \   00000470   8301               STD     Z+1, R16
   \   00000472   8302               STD     Z+2, R16
    747          						
    748          					if(Walk_Through_flag == 1)
   \   00000474   9100....           LDS     R16, Walk_Through_flag
   \   00000478   3001               CPI     R16, 1
   \   0000047A   F461               BRNE    ??Check_SCS_received_43
    749          					{
    750          						Sensor_mode.mode_state = Initial_state;	
   \   0000047C   E001               LDI     R16, 1
   \   0000047E   9300....           STS     Sensor_mode, R16
    751          						Time_delay.timer_delay_set.time_out = 0;
   \   00000482   9310....           STS     (Time_delay + 34), R17
    752          						Sensor_mode.no_prence_off_send = 0;			// allow to send no presence and OFF frame
   \   00000486   01FD               MOVW    R31:R30, R27:R26
   \   00000488   8105               LDD     R16, Z+5
   \   0000048A   7D0F               ANDI    R16, 0xDF
   \   0000048C   8305               STD     Z+5, R16
    753          						Time_delay.Re_Trigger_senconds = 0;
   \   0000048E   9310....           STS     Time_delay, R17
   \   00000492   C026               RJMP    ??Check_SCS_received_29
    754          					}
    755          					else
    756          					{
    757          						Time_delay.Re_Trigger_senconds = Re_Trigger_5s;	
   \                     ??Check_SCS_received_43:
   \   00000494   E005               LDI     R16, 5
   \   00000496   9300....           STS     Time_delay, R16
    758          						Sensor_mode.mode_state = Standby_state;		
   \   0000049A   E004               LDI     R16, 4
   \   0000049C   9300....           STS     Sensor_mode, R16
   \   000004A0   C01F               RJMP    ??Check_SCS_received_29
    759          					}
    760          				}
    761          				else										// single OFF frame
    762          				{
    763          					Walk_Through_flag = 1;
   \                     ??Check_SCS_received_42:
   \   000004A2   E001               LDI     R16, 1
   \   000004A4   9300....           STS     Walk_Through_flag, R16
    764          					if(Delay_Time_set > Walkthru_delay)		
   \   000004A8   ....               LDI     R30, LOW(Delay_Time_set)
   \   000004AA   ....               LDI     R31, (Delay_Time_set) >> 8
   \   000004AC   8100               LD      R16, Z
   \   000004AE   8111               LDD     R17, Z+1
   \   000004B0   8122               LDD     R18, Z+2
   \   000004B2   8133               LDD     R19, Z+3
   \   000004B4   3B05               CPI     R16, 181
   \   000004B6   E040               LDI     R20, 0
   \   000004B8   0714               CPC     R17, R20
   \   000004BA   0724               CPC     R18, R20
   \   000004BC   0734               CPC     R19, R20
   \   000004BE   F028               BRCS    ??Check_SCS_received_44
    765          						Time_delay.Walk_Through_Timeout = Walkthru_delay;
   \   000004C0   EB04               LDI     R16, 180
   \   000004C2   01FC               MOVW    R31:R30, R25:R24
   \   000004C4   8301               STD     Z+1, R16
   \   000004C6   8342               STD     Z+2, R20
   \   000004C8   C007               RJMP    ??Check_SCS_received_41
    766          					else									
    767          						Time_delay.Walk_Through_Timeout = Delay_Time_set;
   \                     ??Check_SCS_received_44:
   \   000004CA   8100               LD      R16, Z
   \   000004CC   8111               LDD     R17, Z+1
   \   000004CE   8122               LDD     R18, Z+2
   \   000004D0   8133               LDD     R19, Z+3
   \   000004D2   01FC               MOVW    R31:R30, R25:R24
   \   000004D4   8301               STD     Z+1, R16
   \   000004D6   8312               STD     Z+2, R17
    768          					
    769          					Time_delay.detect_waitting = 20000;		// 0601 detection is disabled 20s
   \                     ??Check_SCS_received_41:
   \   000004D8   E200               LDI     R16, 32
   \   000004DA   E41E               LDI     R17, 78
   \   000004DC   8703               STD     Z+11, R16
   \   000004DE   8714               STD     Z+12, R17
    770          				}
    771          			      break;
    772          			
    773          			  default:  break;				
    774          		}
    775          	}
    776          	
    777          //******************************************************************************
    778          // 	if received GR "lux" request
    779          //******************************************************************************	
    780          
    781          	if(SCS_received.modality_lux_request == 1)
   \                     ??Check_SCS_received_29:
   \   000004E0   ....               LDI     R30, LOW(SCS_received)
   \   000004E2   ....               LDI     R31, (SCS_received) >> 8
   \   000004E4   8103               LDD     R16, Z+3
   \   000004E6   FF01               SBRS    R16, 1
   \   000004E8   C006               RJMP    ??Check_SCS_received_45
    782          	{
    783          		SCS_received.modality_lux_request = 0;
   \   000004EA   8103               LDD     R16, Z+3
   \   000004EC   7F0D               ANDI    R16, 0xFD
   \   000004EE   8303               STD     Z+3, R16
    784          		frame_M2_answer('0');
   \   000004F0   E300               LDI     R16, 48
   \   000004F2   ........           CALL    frame_M2_answer
    785          		
    786          	}
    787          	if(SCS_received.setpoint_high ==1)
   \                     ??Check_SCS_received_45:
   \   000004F6   ....               LDI     R30, LOW(SCS_received)
   \   000004F8   ....               LDI     R31, (SCS_received) >> 8
   \   000004FA   8103               LDD     R16, Z+3
   \   000004FC   FF05               SBRS    R16, 5
   \   000004FE   C006               RJMP    ??Check_SCS_received_46
    788          	{
    789          	 	SCS_received.setpoint_high = 0;
   \   00000500   8103               LDD     R16, Z+3
   \   00000502   7D0F               ANDI    R16, 0xDF
   \   00000504   8303               STD     Z+3, R16
    790                          DLL_setpoint(3);//(High);
   \   00000506   E003               LDI     R16, 3
   \   00000508   ........           CALL    DLL_setpoint
    791          	}
    792              if(SCS_received.setpoint_medium ==1)
   \                     ??Check_SCS_received_46:
   \   0000050C   ....               LDI     R30, LOW(SCS_received)
   \   0000050E   ....               LDI     R31, (SCS_received) >> 8
   \   00000510   8103               LDD     R16, Z+3
   \   00000512   FF06               SBRS    R16, 6
   \   00000514   C006               RJMP    ??Check_SCS_received_47
    793          	{
    794          	 	SCS_received.setpoint_medium = 0;
   \   00000516   8103               LDD     R16, Z+3
   \   00000518   7B0F               ANDI    R16, 0xBF
   \   0000051A   8303               STD     Z+3, R16
    795                          DLL_setpoint(2);//(Medium);
   \   0000051C   E002               LDI     R16, 2
   \   0000051E   ........           CALL    DLL_setpoint
    796          	}
    797          	if(SCS_received.setpoint_low ==1)
   \                     ??Check_SCS_received_47:
   \   00000522   ....               LDI     R30, LOW(SCS_received)
   \   00000524   ....               LDI     R31, (SCS_received) >> 8
   \   00000526   8103               LDD     R16, Z+3
   \   00000528   FF04               SBRS    R16, 4
   \   0000052A   C006               RJMP    ??Check_SCS_received_48
    798          	{
    799          		 SCS_received.setpoint_low = 0;
   \   0000052C   8103               LDD     R16, Z+3
   \   0000052E   7E0F               ANDI    R16, 0xEF
   \   00000530   8303               STD     Z+3, R16
    800          		 DLL_setpoint(1);//(Low);
   \   00000532   E001               LDI     R16, 1
   \   00000534   ........           CALL    DLL_setpoint
    801          	}
    802          }
   \                     ??Check_SCS_received_48:
   \   00000538   E0E4               LDI     R30, 4
   \   0000053A   ........           JMP     ?EPILOGUE_B4_L09
    803          
    804          
    805          //******************************************************************************
    806          // check the detection of Pir or US
    807          // Pir warmup time should be at least 30s
    808          // 6ms every cycle for Pir, 200us every cycle for US
    809          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    810          void occupancy_detect(void)
   \                     occupancy_detect:
    811          {
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
    812              //if((++Time_delay.timer0_compa_cnt >= 2)&&(Time_delay.pir_warmup_ok == 1))			// every 6ms
    813          		if(Time_delay.pir_warmup_ok == 1)
   \   00000004   ....               LDI     R26, LOW(Time_delay)
   \   00000006   ....               LDI     R27, (Time_delay) >> 8
   \   00000008   01FD               MOVW    R31:R30, R27:R26
   \   0000000A   8107               LDD     R16, Z+7
   \   0000000C   FF00               SBRS    R16, 0
   \   0000000E   C059               RJMP    ??occupancy_detect_0
    814          		{
    815          			Time_delay.timer0_compa_cnt = 0;
   \   00000010   E000               LDI     R16, 0
   \   00000012   8F00               STD     Z+24, R16
   \   00000014   8F01               STD     Z+25, R16
    816          			motion_resutl = 0;
   \   00000016   9300....           STS     motion_resutl, R16
    817          			if(product_information.cen_system)
   \   0000001A   9100....           LDS     R16, (product_information + 4)
   \   0000001E   2300               TST     R16
   \   00000020   F021               BREQ    ??occupancy_detect_1
    818          			{
    819          				Sensor_mode.detect_scheme = KO_conf.DF;
   \   00000022   9100....           LDS     R16, (KO_conf + 22)
   \   00000026   9300....           STS     (Sensor_mode + 2), R16
    820          			}
    821          			motion_resutl = motion_detect(Sensor_mode.detect_scheme);   							// set in the files function mode.c
   \                     ??occupancy_detect_1:
   \   0000002A   9100....           LDS     R16, (Sensor_mode + 2)
   \   0000002E   ........           CALL    motion_detect
   \   00000032   9300....           STS     motion_resutl, R16
    822          			motion_total = motion_total + motion_resutl;
   \   00000036   9100....           LDS     R16, motion_resutl
   \   0000003A   E010               LDI     R17, 0
   \   0000003C   ....               LDI     R30, LOW(motion_total)
   \   0000003E   ....               LDI     R31, (motion_total) >> 8
   \   00000040   8120               LD      R18, Z
   \   00000042   8131               LDD     R19, Z+1
   \   00000044   0F20               ADD     R18, R16
   \   00000046   1F31               ADC     R19, R17
   \   00000048   8320               ST      Z, R18
   \   0000004A   8331               STD     Z+1, R19
    823          			if(motion_total)
   \   0000004C   9100....           LDS     R16, motion_total
   \   00000050   9110....           LDS     R17, (motion_total + 1)
   \   00000054   2B01               OR      R16, R17
   \   00000056   F009               BREQ    ??occupancy_detect_2
    824          				asm("nop");
   \   00000058   0000               nop
    825          			if((motion_total)&&(SCS_received.calib_wait != 1)&&(Time_delay.pir_warmup_ok == 1)&&(Time_delay.detect_waitting ==0))			// in the calibration waitting mode, motion detection is disabled
   \                     ??occupancy_detect_2:
   \   0000005A   9100....           LDS     R16, motion_total
   \   0000005E   9110....           LDS     R17, (motion_total + 1)
   \   00000062   2B01               OR      R16, R17
   \   00000064   F171               BREQ    ??occupancy_detect_0
   \   00000066   ....               LDI     R30, LOW(SCS_received)
   \   00000068   ....               LDI     R31, (SCS_received) >> 8
   \   0000006A   8104               LDD     R16, Z+4
   \   0000006C   FD00               SBRC    R16, 0
   \   0000006E   C029               RJMP    ??occupancy_detect_0
   \   00000070   01FD               MOVW    R31:R30, R27:R26
   \   00000072   8107               LDD     R16, Z+7
   \   00000074   FF00               SBRS    R16, 0
   \   00000076   C025               RJMP    ??occupancy_detect_0
   \   00000078   8503               LDD     R16, Z+11
   \   0000007A   8514               LDD     R17, Z+12
   \   0000007C   2B01               OR      R16, R17
   \   0000007E   F509               BRNE    ??occupancy_detect_0
    826          			{
    827          				//DLED_ON;
    828          				motion_total = 0;
   \   00000080   E000               LDI     R16, 0
   \   00000082   9300....           STS     motion_total, R16
   \   00000086   9300....           STS     (motion_total + 1), R16
    829          				Dled_light_on_ms(1000);
   \   0000008A   EE08               LDI     R16, 232
   \   0000008C   E013               LDI     R17, 3
   \   0000008E   E020               LDI     R18, 0
   \   00000090   E030               LDI     R19, 0
   \   00000092   ........           CALL    Dled_light_on_ms
    830          				//Time_delay.timer_1s.count = 0;							//start count 1 second	
    831          				US_detection_en = 0;
   \   00000096   E000               LDI     R16, 0
   \   00000098   9300....           STS     US_detection_en, R16
    832          				PIR_detection_en = 0;
   \   0000009C   9300....           STS     PIR_detection_en, R16
    833          				SCS_received.motion_detect = 1;
   \   000000A0   ....               LDI     R30, LOW(SCS_received)
   \   000000A2   ....               LDI     R31, (SCS_received) >> 8
   \   000000A4   8102               LDD     R16, Z+2
   \   000000A6   6400               ORI     R16, 0x40
   \   000000A8   8302               STD     Z+2, R16
    834          				flags.motion_detected = 1;
   \   000000AA   ....               LDI     R30, LOW(flags)
   \   000000AC   ....               LDI     R31, (flags) >> 8
   \   000000AE   8500               LDD     R16, Z+8
   \   000000B0   8511               LDD     R17, Z+9
   \   000000B2   6002               ORI     R16, 0x02
   \   000000B4   8711               STD     Z+9, R17
   \   000000B6   8700               STD     Z+8, R16
    835          				SetBit(KO_conf.status[0],Status_Detection);				//0515
   \   000000B8   ....               LDI     R30, LOW(KO_conf)
   \   000000BA   ....               LDI     R31, (KO_conf) >> 8
   \   000000BC   A505               LDD     R16, Z+45
   \   000000BE   6008               ORI     R16, 0x08
   \   000000C0   A705               STD     Z+45, R16
    836          			}
    837          		}
    838          }
   \                     ??occupancy_detect_0:
   \   000000C2   91A9               LD      R26, Y+
   \   000000C4   91B9               LD      R27, Y+
   \   000000C6   9508               RET
    839          
    840          
    841          //******************************************************************************
    842          // function LM GR  machine states	begin	
    843          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
    844          void _Initial_state(void)
   \                     _Initial_state:
    845          {			
   \   00000000   ........           CALL    ?PROLOGUE4_L09
    846          	
    847          	if(SCS_received.motion_detect == 1 && Sensor_mode.presence_20sinterval == 0)				// 0520	
   \   00000004   ....               LDI     R26, LOW(Sensor_mode)
   \   00000006   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000008   ....               LDI     R30, LOW(SCS_received)
   \   0000000A   ....               LDI     R31, (SCS_received) >> 8
   \   0000000C   8102               LDD     R16, Z+2
   \   0000000E   FF06               SBRS    R16, 6
   \   00000010   C050               RJMP    ??_Initial_state_0
   \   00000012   01FD               MOVW    R31:R30, R27:R26
   \   00000014   8103               LDD     R16, Z+3
   \   00000016   8114               LDD     R17, Z+4
   \   00000018   2B01               OR      R16, R17
   \   0000001A   F009               BREQ    $+2+2
   \   0000001C   C04A               RJMP    ??_Initial_state_0
    848          	{
    849                Mode_frame_GR(KO_conf.GR,pre);			                 // send frame GR presence  B5 GG 1D 00
   \   0000001E   ....               LDI     R24, LOW(KO_conf)
   \   00000020   ....               LDI     R25, (KO_conf) >> 8
   \   00000022   E013               LDI     R17, 3
   \   00000024   9100....           LDS     R16, (KO_conf + 6)
   \   00000028   ........           CALL    Mode_frame_GR
    850          			Sensor_mode.presence_send = 1;
   \   0000002C   01FD               MOVW    R31:R30, R27:R26
   \   0000002E   8105               LDD     R16, Z+5
   \   00000030   6004               ORI     R16, 0x04
   \   00000032   8305               STD     Z+5, R16
    851          			
    852          			if((KO_conf.KO_number == 119)||(KO_conf.KO_number == 168)&&(DLL.loadoff_level < set_point)&&(KO_conf.FuncMod != ManualON_Auto_OFF))
   \   00000034   01FC               MOVW    R31:R30, R25:R24
   \   00000036   A507               LDD     R16, Z+47
   \   00000038   A910               LDD     R17, Z+48
   \   0000003A   3707               CPI     R16, 119
   \   0000003C   E020               LDI     R18, 0
   \   0000003E   0712               CPC     R17, R18
   \   00000040   F0A1               BREQ    ??_Initial_state_1
   \   00000042   A507               LDD     R16, Z+47
   \   00000044   A910               LDD     R17, Z+48
   \   00000046   3A08               CPI     R16, 168
   \   00000048   0712               CPC     R17, R18
   \   0000004A   F561               BRNE    ??_Initial_state_2
   \   0000004C   9100....           LDS     R16, (DLL + 10)
   \   00000050   9110....           LDS     R17, (DLL + 11)
   \   00000054   9120....           LDS     R18, set_point
   \   00000058   9130....           LDS     R19, (set_point + 1)
   \   0000005C   1702               CP      R16, R18
   \   0000005E   0713               CPC     R17, R19
   \   00000060   F508               BRCC    ??_Initial_state_2
   \   00000062   9100....           LDS     R16, (KO_conf + 29)
   \   00000066   3003               CPI     R16, 3
   \   00000068   F0E9               BREQ    ??_Initial_state_2
    853          			{
    854          				//reyno 0622
    855          				if(KO_conf.LightReg == 1)
   \                     ??_Initial_state_1:
   \   0000006A   9100....           LDS     R16, (KO_conf + 28)
   \   0000006E   3001               CPI     R16, 1
   \   00000070   F449               BRNE    ??_Initial_state_3
    856          				{
    857          					DLL.start_regulation = 1;
   \   00000072   ....               LDI     R30, LOW(DLL)
   \   00000074   ....               LDI     R31, (DLL) >> 8
   \   00000076   A906               LDD     R16, Z+54
   \   00000078   6001               ORI     R16, 0x01
   \   0000007A   AB06               STD     Z+54, R16
    858          					SetBit(KO_conf.status[0],Status_Regulationing);
   \   0000007C   01FC               MOVW    R31:R30, R25:R24
   \   0000007E   A505               LDD     R16, Z+45
   \   00000080   6400               ORI     R16, 0x40
   \   00000082   A705               STD     Z+45, R16
    859          				}
    860          				
    861          				Sensor_mode.mode_state = Maintain_state;
   \                     ??_Initial_state_3:
   \   00000084   E002               LDI     R16, 2
   \   00000086   9300....           STS     Sensor_mode, R16
    862          				Sensor_mode.motion_initial_detect = 1;			//保证第一次动initial进入到maintain时程序能正常的设定延迟时间		
   \   0000008A   9100....           LDS     R16, (Sensor_mode + 7)
   \   0000008E   7F03               ANDI    R16, 0xF3
   \   00000090   6004               ORI     R16, 0x04
   \   00000092   9300....           STS     (Sensor_mode + 7), R16
    863          				//SCS_received.motion_detect = 1;						//debug 0520
    864          				Sensor_mode.flag_leader_group = 1;				
   \   00000096   01FD               MOVW    R31:R30, R27:R26
   \   00000098   8105               LDD     R16, Z+5
   \   0000009A   6002               ORI     R16, 0x02
   \   0000009C   8305               STD     Z+5, R16
    865          				frame_ON_send();
   \   0000009E   ....               RCALL   frame_ON_send
    866               	 	Call_detect_delay();
   \   000000A0   ....               RCALL   Call_detect_delay
   \   000000A2   C001               RJMP    ??_Initial_state_4
    867          			}
    868          			else
    869          			{				
    870          				Start_Time_Delay();
   \                     ??_Initial_state_2:
   \   000000A4   ....               RCALL   Start_Time_Delay
    871          			}	
    872          			GS_presence_send();	
   \                     ??_Initial_state_4:
   \   000000A6   ....               RCALL   GS_presence_send
    873          		
    874          			//	if(KO_conf.FuncMod == Auto_Walk_thru)			//0521
    875          			//		Sensor_mode.motion_initial_detect = 2;	
    876          			//	else
    877          			Sensor_mode.presence_20sinterval = presence_20s;
   \   000000A8   E200               LDI     R16, 32
   \   000000AA   E41E               LDI     R17, 78
   \   000000AC   01FD               MOVW    R31:R30, R27:R26
   \   000000AE   8303               STD     Z+3, R16
   \   000000B0   8314               STD     Z+4, R17
    878          		
    879          	}
    880          
    881          	SCS_received.motion_detect = 0;
   \                     ??_Initial_state_0:
   \   000000B2   ....               LDI     R30, LOW(SCS_received)
   \   000000B4   ....               LDI     R31, (SCS_received) >> 8
   \   000000B6   8102               LDD     R16, Z+2
   \   000000B8   7B0F               ANDI    R16, 0xBF
   \   000000BA   8302               STD     Z+2, R16
    882          		
    883          	if(Time_delay.timer_delay_set.time_out == 1)//&&(Sensor_mode.no_prence_off_send == 0))	//make sure send one no presence and OFF frame in initial state
   \   000000BC   9100....           LDS     R16, (Time_delay + 34)
   \   000000C0   3001               CPI     R16, 1
   \   000000C2   F491               BRNE    ??_Initial_state_5
    884          	{
    885          		Time_delay.timer_delay_set.started = 0;
   \   000000C4   E000               LDI     R16, 0
   \   000000C6   9300....           STS     (Time_delay + 36), R16
    886          		Time_delay.timer_delay_set.time_out = 0;
   \   000000CA   9300....           STS     (Time_delay + 34), R16
    887          		
    888          		//if(KO_conf.AddressType == PP)         //reyno 0709
    889          			//Mode_frame_GR(KO_conf.GR,nopre);
    890          		
    891          		if(Sensor_mode.flag_leader_group == 1)
   \   000000CE   01FD               MOVW    R31:R30, R27:R26
   \   000000D0   8105               LDD     R16, Z+5
   \   000000D2   FF01               SBRS    R16, 1
   \   000000D4   C006               RJMP    ??_Initial_state_6
    892          		{						
    893          				//	Mode_frame_GR(KO_conf.GR,pre);
    894          				frame_OFF_send();
   \   000000D6   ....               RCALL   frame_OFF_send
    895          				Sensor_mode.no_prence_off_send = 1;					
   \   000000D8   01FD               MOVW    R31:R30, R27:R26
   \   000000DA   8105               LDD     R16, Z+5
   \   000000DC   6200               ORI     R16, 0x20
   \   000000DE   8305               STD     Z+5, R16
   \   000000E0   C003               RJMP    ??_Initial_state_5
    896          		}
    897          		else		//  WITH Special TAKING LINE : after send no presence+OFF帧后不再进入到这一步程序
    898          		{
    899          			Sensor_mode.OFF_takeline_waitsend = 1;						//	OFF_takeline();									
   \                     ??_Initial_state_6:
   \   000000E2   8107               LDD     R16, Z+7
   \   000000E4   6002               ORI     R16, 0x02
   \   000000E6   8307               STD     Z+7, R16
    900          		}		
    901          	}
    902          	
    903          	if ((Sensor_mode.ON_takeline_waitsend == 1)||(Sensor_mode.OFF_takeline_waitsend == 1))
   \                     ??_Initial_state_5:
   \   000000E8   9100....           LDS     R16, (Sensor_mode + 7)
   \   000000EC   7003               ANDI    R16, 0x03
   \   000000EE   F109               BREQ    ??_Initial_state_7
    904          	{
    905          		if(Time_delay.timer_takeline.started == 0)						// start the timer_takeline
   \   000000F0   9100....           LDS     R16, (Time_delay + 47)
   \   000000F4   2300               TST     R16
   \   000000F6   F4A9               BRNE    ??_Initial_state_8
    906          		{
    907          			Time_delay.timer_takeline.count = 0;
   \   000000F8   E000               LDI     R16, 0
   \   000000FA   ....               LDI     R30, LOW(Time_delay)
   \   000000FC   ....               LDI     R31, (Time_delay) >> 8
   \   000000FE   A305               STD     Z+37, R16
   \   00000100   A306               STD     Z+38, R16
   \   00000102   A307               STD     Z+39, R16
   \   00000104   A700               STD     Z+40, R16
    908          		//	Time_delay.timer_takeline.time_out = 0;
    909          			Time_delay.timer_takeline.enabled = 1;
   \   00000106   E001               LDI     R16, 1
   \   00000108   9300....           STS     (Time_delay + 46), R16
    910          			Time_delay.timer_takeline.started = 1;
   \   0000010C   9300....           STS     (Time_delay + 47), R16
    911          			Time_delay.random_time	= Sensor_mode.random_takeline*400;	// random time delay for the frame send	
   \   00000110   9140....           LDS     R20, (Sensor_mode + 6)
   \   00000114   E050               LDI     R21, 0
   \   00000116   E900               LDI     R16, 144
   \   00000118   E011               LDI     R17, 1
   \   0000011A   ........           CALL    ?S_EC_MUL_L02
   \   0000011E   8304               STD     Z+4, R16
   \   00000120   8315               STD     Z+5, R17
    912          		}
    913          		if(Sensor_mode.ON_takeline_waitsend == 1) 		ON_takeline();
   \                     ??_Initial_state_8:
   \   00000122   01FD               MOVW    R31:R30, R27:R26
   \   00000124   8107               LDD     R16, Z+7
   \   00000126   FD00               SBRC    R16, 0
   \   00000128   ....               RCALL   ON_takeline
    914          		if(Sensor_mode.OFF_takeline_waitsend == 1)		OFF_takeline();		
   \                     ??_Initial_state_9:
   \   0000012A   01FD               MOVW    R31:R30, R27:R26
   \   0000012C   8107               LDD     R16, Z+7
   \   0000012E   FD01               SBRC    R16, 1
   \   00000130   ....               RCALL   OFF_takeline
    915          	}	
    916          }
   \                     ??_Initial_state_7:
   \   00000132   E0E4               LDI     R30, 4
   \   00000134   ........           JMP     ?EPILOGUE_B4_L09
    917          
    918          
    919          

   \                                 In  segment CODE, align 2, keep-with-next
    920          void _Maintain_state(void)
   \                     _Maintain_state:
    921          {			
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
    922          	if(Sensor_mode.presence_20sinterval == 0)
   \   00000004   ....               LDI     R26, LOW(Sensor_mode)
   \   00000006   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000008   01FD               MOVW    R31:R30, R27:R26
   \   0000000A   8103               LDD     R16, Z+3
   \   0000000C   8114               LDD     R17, Z+4
   \   0000000E   2B01               OR      R16, R17
   \   00000010   F009               BREQ    $+2+2
   \   00000012   C047               RJMP    ??_Maintain_state_0
    923          	{
    924          		if(Sensor_mode.presen_timeout ==1)			// end detection
   \   00000014   8105               LDD     R16, Z+5
   \   00000016   FF03               SBRS    R16, 3
   \   00000018   C012               RJMP    ??_Maintain_state_1
    925          		{
    926          				Sensor_mode.presen_timeout = 0;
   \   0000001A   8105               LDD     R16, Z+5
   \   0000001C   7F07               ANDI    R16, 0xF7
   \   0000001E   8305               STD     Z+5, R16
    927          				SCS_received.motion_detect = 0;			//Ignore detection
   \   00000020   ....               LDI     R30, LOW(SCS_received)
   \   00000022   ....               LDI     R31, (SCS_received) >> 8
   \   00000024   8102               LDD     R16, Z+2
   \   00000026   7B0F               ANDI    R16, 0xBF
   \   00000028   8302               STD     Z+2, R16
    928          				if(Walk_Through_flag != 1)
   \   0000002A   9100....           LDS     R16, Walk_Through_flag
   \   0000002E   3001               CPI     R16, 1
   \   00000030   F031               BREQ    ??_Maintain_state_1
    929          				{
    930          						Mode_frame_GR(KO_conf.GR,pre);
   \   00000032   E013               LDI     R17, 3
   \   00000034   9100....           LDS     R16, (KO_conf + 6)
   \   00000038   ........           CALL    Mode_frame_GR
    931          						Start_Time_Delay();
   \   0000003C   ....               RCALL   Start_Time_Delay
    932          				}
    933          		}
    934          		
    935          		if((SCS_received.motion_detect == 1)||(Sensor_mode.motion_initial_detect != 0)||(Sensor_mode.maintain_pre == 1))		
   \                     ??_Maintain_state_1:
   \   0000003E   ....               LDI     R30, LOW(SCS_received)
   \   00000040   ....               LDI     R31, (SCS_received) >> 8
   \   00000042   8102               LDD     R16, Z+2
   \   00000044   FD06               SBRC    R16, 6
   \   00000046   C004               RJMP    ??_Maintain_state_2
   \   00000048   9100....           LDS     R16, (Sensor_mode + 7)
   \   0000004C   710C               ANDI    R16, 0x1C
   \   0000004E   F149               BREQ    ??_Maintain_state_0
    936          		{
    937          			Sensor_mode.maintain_pre = 0;
   \                     ??_Maintain_state_2:
   \   00000050   01FD               MOVW    R31:R30, R27:R26
   \   00000052   8107               LDD     R16, Z+7
   \   00000054   7E0F               ANDI    R16, 0xEF
   \   00000056   8307               STD     Z+7, R16
    938          			if(Sensor_mode.motion_initial_detect ==0 && SCS_received.motion_detect != 1)					// detection in the maintain state
   \   00000058   9100....           LDS     R16, (Sensor_mode + 7)
   \   0000005C   700C               ANDI    R16, 0x0C
   \   0000005E   F459               BRNE    ??_Maintain_state_3
   \   00000060   ....               LDI     R30, LOW(SCS_received)
   \   00000062   ....               LDI     R31, (SCS_received) >> 8
   \   00000064   8102               LDD     R16, Z+2
   \   00000066   FD06               SBRC    R16, 6
   \   00000068   C006               RJMP    ??_Maintain_state_3
    939          			{
    940          				WT_20s_detect();
   \   0000006A   ....               RCALL   WT_20s_detect
    941          				Mode_frame_GR(KO_conf.GR,pre);
   \   0000006C   E013               LDI     R17, 3
   \   0000006E   9100....           LDS     R16, (KO_conf + 6)
   \   00000072   ........           CALL    Mode_frame_GR
    942          			}
    943          			else if(Sensor_mode.motion_initial_detect == 1)			// automatic just from initial to maintain
    944          			{
    945          			//	Sensor_mode.motion_initial_detect = 0;
    946          			//	SCS_received.motion_detect =0;
    947          			//	Mode_frame_GR(KO_conf.GR,pre);	
    948          			}
    949          			else if(Sensor_mode.motion_initial_detect == 2)			// W_T just from initial to maintain
    950          			{
    951          				//Sensor_mode.motion_initial_detect =0;
    952          				//SCS_received.motion_detect =0;
    953          			}
    954          			
    955          			if(SCS_received.motion_detect == 1)
   \                     ??_Maintain_state_3:
   \   00000076   ....               LDI     R30, LOW(SCS_received)
   \   00000078   ....               LDI     R31, (SCS_received) >> 8
   \   0000007A   8102               LDD     R16, Z+2
   \   0000007C   FF06               SBRS    R16, 6
   \   0000007E   C011               RJMP    ??_Maintain_state_0
    956          			{
    957          				Sensor_mode.presence_20sinterval = presence_20s; 	
   \   00000080   E200               LDI     R16, 32
   \   00000082   E41E               LDI     R17, 78
   \   00000084   01FD               MOVW    R31:R30, R27:R26
   \   00000086   8303               STD     Z+3, R16
   \   00000088   8314               STD     Z+4, R17
    958          				SCS_received.motion_detect = 0;	
   \   0000008A   ....               LDI     R30, LOW(SCS_received)
   \   0000008C   ....               LDI     R31, (SCS_received) >> 8
   \   0000008E   8102               LDD     R16, Z+2
   \   00000090   7B0F               ANDI    R16, 0xBF
   \   00000092   8302               STD     Z+2, R16
    959          				Mode_frame_GR(KO_conf.GR,pre);
   \   00000094   E013               LDI     R17, 3
   \   00000096   9100....           LDS     R16, (KO_conf + 6)
   \   0000009A   ........           CALL    Mode_frame_GR
    960          				GS_presence_send();	
   \   0000009E   ....               RCALL   GS_presence_send
    961          				WT_20s_detect();
   \   000000A0   ....               RCALL   WT_20s_detect
   \                     ??_Maintain_state_0:
   \   000000A2   9100....           LDS     R16, (Time_delay + 34)
   \   000000A6   3001               CPI     R16, 1
   \   000000A8   F4D1               BRNE    ??_Maintain_state_4
   \   000000AA   9100....           LDS     R16, Walk_Through_flag
   \   000000AE   3001               CPI     R16, 1
   \   000000B0   F0B1               BREQ    ??_Maintain_state_4
    962          			}
    963          		}
    964          	}
    965          	// end of load Time_dalay_count
    966          	if((Time_delay.timer_delay_set.time_out == 1)&&(Walk_Through_flag != 1))	//sensor will then go into Re_Trigger_State
    967          	{	
    968          		Sensor_mode.end_dection = 0;						
   \   000000B2   01FD               MOVW    R31:R30, R27:R26
   \   000000B4   8105               LDD     R16, Z+5
   \   000000B6   7E0F               ANDI    R16, 0xEF
   \   000000B8   8305               STD     Z+5, R16
    969          		Sensor_mode.mode_state = Re_Trigger_State;
   \   000000BA   E003               LDI     R16, 3
   \   000000BC   9300....           STS     Sensor_mode, R16
    970          		Time_delay.Re_Trigger_senconds = Re_Trigger_5s;
   \   000000C0   E005               LDI     R16, 5
   \   000000C2   9300....           STS     Time_delay, R16
    971          
    972          		if(KO_conf.FuncMod == ManualON_Auto_OFF)//((KO_conf.FuncMod == ManualON_Auto_OFF)||(KO_conf.FuncMod == ManualON_Manual_OFF))
   \   000000C6   9100....           LDS     R16, (KO_conf + 29)
   \   000000CA   3003               CPI     R16, 3
   \   000000CC   F419               BRNE    ??_Maintain_state_5
    973          		{
    974          			Time_delay.Re_Trigger_senconds = Re_Trigger_30s;
   \   000000CE   E10E               LDI     R16, 30
   \   000000D0   9300....           STS     Time_delay, R16
    975          		}
    976          		frame_OFF_send();
   \                     ??_Maintain_state_5:
   \   000000D4   ....               RCALL   frame_OFF_send
    977          		Sensor_mode.no_prence_off_send = 1;		//reyno 0619
   \   000000D6   01FD               MOVW    R31:R30, R27:R26
   \   000000D8   8105               LDD     R16, Z+5
   \   000000DA   6200               ORI     R16, 0x20
   \   000000DC   8305               STD     Z+5, R16
    978          	}
    979          	
    980          	// end of Walk_Through_Timeout_count
    981          	if((Time_delay.Walk_Through_Timeout ==0)&&(Walk_Through_flag == 1))	        // 处于	Walk_Through mode
   \                     ??_Maintain_state_4:
   \   000000DE   9100....           LDS     R16, (Time_delay + 1)
   \   000000E2   9110....           LDS     R17, (Time_delay + 2)
   \   000000E6   2B01               OR      R16, R17
   \   000000E8   F4F1               BRNE    ??_Maintain_state_6
   \   000000EA   9100....           LDS     R16, Walk_Through_flag
   \   000000EE   3001               CPI     R16, 1
   \   000000F0   F4D1               BRNE    ??_Maintain_state_6
    982          	{
    983          		Sensor_mode.end_dection = 0;						
   \   000000F2   01FD               MOVW    R31:R30, R27:R26
   \   000000F4   8105               LDD     R16, Z+5
   \   000000F6   7E0F               ANDI    R16, 0xEF
   \   000000F8   8305               STD     Z+5, R16
    984          		Sensor_mode.mode_state = Initial_state;				// if in Walk_Through mode, the sensor won't go to Retrigger state
   \   000000FA   E001               LDI     R16, 1
   \   000000FC   9300....           STS     Sensor_mode, R16
    985          		Time_delay.timer_delay_set.time_out = 0;
   \   00000100   E000               LDI     R16, 0
   \   00000102   9300....           STS     (Time_delay + 34), R16
    986          		Sensor_mode.no_prence_off_send = 0;					// allow to send no presence and OFF frame again in initial state
   \   00000106   8105               LDD     R16, Z+5
   \   00000108   7D0F               ANDI    R16, 0xDF
   \   0000010A   8305               STD     Z+5, R16
    987          		Stop_allTimer();
   \   0000010C   ....               RCALL   Stop_allTimer
    988          		if(First_detection_enable == 1)
   \   0000010E   9100....           LDS     R16, First_detection_enable
   \   00000112   3001               CPI     R16, 1
   \   00000114   F441               BRNE    ??_Maintain_state_6
    989          		{
    990          			First_detection_enable = 0;	
   \   00000116   E000               LDI     R16, 0
   \   00000118   9300....           STS     First_detection_enable, R16
    991          			frame_OFF_send();
   \   0000011C   ....               RCALL   frame_OFF_send
    992          			Sensor_mode.no_prence_off_send = 1;		//reyno 0619
   \   0000011E   01FD               MOVW    R31:R30, R27:R26
   \   00000120   8105               LDD     R16, Z+5
   \   00000122   6200               ORI     R16, 0x20
   \   00000124   8305               STD     Z+5, R16
    993              }
    994          	}
    995          	
    996          	Delay_Alert();										
   \                     ??_Maintain_state_6:
   \   00000126   ....               RCALL   Delay_Alert
    997          }
   \   00000128   91A9               LD      R26, Y+
   \   0000012A   91B9               LD      R27, Y+
   \   0000012C   9508               RET
    998          
    999          

   \                                 In  segment CODE, align 2, keep-with-next
   1000          void _ReTrigger_State(void)
   \                     _ReTrigger_State:
   1001          {
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
   \   00000004   9100....           LDS     R16, Time_delay
   \   00000008   2300               TST     R16
   \   0000000A   F0F1               BREQ    ??_ReTrigger_State_0
   1002          	//reyno 0609
   1003          	//if(Time_delay.Re_Trigger_senconds >0 && Sensor_mode.detect_scheme != 0)					// Re_Trigger_time out is not over        0714
   1004          	if(Time_delay.Re_Trigger_senconds >0 )					// Re_Trigger_time out is not over
   1005          	{	
   1006          		if(SCS_received.motion_detect == 1)
   \   0000000C   ....               LDI     R30, LOW(SCS_received)
   \   0000000E   ....               LDI     R31, (SCS_received) >> 8
   \   00000010   8102               LDD     R16, Z+2
   \   00000012   FF06               SBRS    R16, 6
   \   00000014   C02F               RJMP    ??_ReTrigger_State_1
   1007          		{
   1008          			SCS_received.motion_detect = 0;			
   \   00000016   8102               LDD     R16, Z+2
   \   00000018   7B0F               ANDI    R16, 0xBF
   \   0000001A   8302               STD     Z+2, R16
   1009          			Sensor_mode.mode_state = Maintain_state;
   \   0000001C   ....               LDI     R26, LOW(Sensor_mode)
   \   0000001E   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000020   E002               LDI     R16, 2
   \   00000022   9300....           STS     Sensor_mode, R16
   1010          			Time_delay.Re_Trigger_senconds = 0;				
   \   00000026   E000               LDI     R16, 0
   \   00000028   9300....           STS     Time_delay, R16
   1011          			Start_Time_Delay();													// 回到maintain前，要重新开始计时延迟			
   \   0000002C   ....               RCALL   Start_Time_Delay
   1012          			Mode_frame_GR(KO_conf.GR,pre);	        		// send GR frame presence;			
   \   0000002E   E013               LDI     R17, 3
   \   00000030   9100....           LDS     R16, (KO_conf + 6)
   \   00000034   ........           CALL    Mode_frame_GR
   1013          			frame_ON_send();			
   \   00000038   ....               RCALL   frame_ON_send
   1014          			GS_presence_send();		
   \   0000003A   ....               RCALL   GS_presence_send
   1015          			Sensor_mode.presence_20sinterval = presence_20s; 	 //  0514
   \   0000003C   E200               LDI     R16, 32
   \   0000003E   E41E               LDI     R17, 78
   \   00000040   9613               ADIW    R27:R26, 3
   \   00000042   930D               ST      X+, R16
   \   00000044   931C               ST      X, R17
   \   00000046   C016               RJMP    ??_ReTrigger_State_1
   1016          		}	
   1017          	}
   1018          	else			// retrigger timeout
   1019          	{	
   1020          		Sensor_mode.mode_state = Initial_state;
   \                     ??_ReTrigger_State_0:
   \   00000048   ....               LDI     R26, LOW(Sensor_mode)
   \   0000004A   ....               LDI     R27, (Sensor_mode) >> 8
   \   0000004C   E001               LDI     R16, 1
   \   0000004E   9300....           STS     Sensor_mode, R16
   1021          		Sensor_mode.no_prence_off_send = 0;					// allow to send no presence and OFF frame again in initial state
   \   00000052   9615               ADIW    R27:R26, 5
   \   00000054   910C               LD      R16, X
   \   00000056   7D0F               ANDI    R16, 0xDF
   \   00000058   930C               ST      X, R16
   \   0000005A   9715               SBIW    R27:R26, 5
   1022          		Time_delay.timer_delay_set.time_out = 0;
   \   0000005C   E000               LDI     R16, 0
   \   0000005E   9300....           STS     (Time_delay + 34), R16
   1023          		if(KO_conf.FuncMod == ManualON_Auto_OFF)	Sensor_mode.manual_on_need = 1;	//在manual mode,retriggertimeout后，必需手动才能打开负载	
   \   00000062   9100....           LDS     R16, (KO_conf + 29)
   \   00000066   3003               CPI     R16, 3
   \   00000068   F421               BRNE    ??_ReTrigger_State_2
   \   0000006A   9615               ADIW    R27:R26, 5
   \   0000006C   910C               LD      R16, X
   \   0000006E   6400               ORI     R16, 0x40
   \   00000070   930C               ST      X, R16
   1024          		Stop_allTimer();
   \                     ??_ReTrigger_State_2:
   \   00000072   ....               RCALL   Stop_allTimer
   1025          	}
   1026          }
   \                     ??_ReTrigger_State_1:
   \   00000074   91A9               LD      R26, Y+
   \   00000076   91B9               LD      R27, Y+
   \   00000078   9508               RET
   1027          
   1028          

   \                                 In  segment CODE, align 2, keep-with-next
   1029          void _Standby_state(void)
   \                     _Standby_state:
   1030          {			
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
   1031          	
   1032          	if(Sensor_mode.presen_timeout ==1)			// end detection
   \   00000004   ....               LDI     R26, LOW(Sensor_mode)
   \   00000006   ....               LDI     R27, (Sensor_mode) >> 8
   \   00000008   01FD               MOVW    R31:R30, R27:R26
   \   0000000A   8105               LDD     R16, Z+5
   \   0000000C   FF03               SBRS    R16, 3
   \   0000000E   C009               RJMP    ??_Standby_state_0
   1033          		{
   1034          				Sensor_mode.presen_timeout = 0;
   \   00000010   8105               LDD     R16, Z+5
   \   00000012   7F07               ANDI    R16, 0xF7
   \   00000014   8305               STD     Z+5, R16
   1035          				//Mode_frame_GR(KO_conf.GR,pre);
   1036          				SCS_received.motion_detect = 0;			//Ignore detection
   \   00000016   ....               LDI     R30, LOW(SCS_received)
   \   00000018   ....               LDI     R31, (SCS_received) >> 8
   \   0000001A   8102               LDD     R16, Z+2
   \   0000001C   7B0F               ANDI    R16, 0xBF
   \   0000001E   8302               STD     Z+2, R16
   1037          				Start_Time_Delay();
   \   00000020   ....               RCALL   Start_Time_Delay
   1038          		}
   1039          	
   1040          	if(Sensor_mode.presence_20sinterval == 0)					
   \                     ??_Standby_state_0:
   \   00000022   01FD               MOVW    R31:R30, R27:R26
   \   00000024   8103               LDD     R16, Z+3
   \   00000026   8114               LDD     R17, Z+4
   \   00000028   2B01               OR      R16, R17
   \   0000002A   F4A1               BRNE    ??_Standby_state_1
   1041          	{		
   1042          		if(SCS_received.motion_detect == 1)				
   \   0000002C   ....               LDI     R30, LOW(SCS_received)
   \   0000002E   ....               LDI     R31, (SCS_received) >> 8
   \   00000030   8102               LDD     R16, Z+2
   \   00000032   FF06               SBRS    R16, 6
   \   00000034   C00F               RJMP    ??_Standby_state_1
   1043          		{
   1044          			SCS_received.motion_detect = 0;
   \   00000036   8102               LDD     R16, Z+2
   \   00000038   7B0F               ANDI    R16, 0xBF
   \   0000003A   8302               STD     Z+2, R16
   1045               	Sensor_mode.presence_20sinterval = presence_20s; 		
   \   0000003C   E200               LDI     R16, 32
   \   0000003E   E41E               LDI     R17, 78
   \   00000040   01FD               MOVW    R31:R30, R27:R26
   \   00000042   8303               STD     Z+3, R16
   \   00000044   8314               STD     Z+4, R17
   1046          			WT_20s_detect();
   \   00000046   ....               RCALL   WT_20s_detect
   1047          			Mode_frame_GR(KO_conf.GR,pre);						// send GR frame presence;
   \   00000048   E013               LDI     R17, 3
   \   0000004A   9100....           LDS     R16, (KO_conf + 6)
   \   0000004E   ........           CALL    Mode_frame_GR
   1048          			GS_presence_send();	
   \   00000052   ....               RCALL   GS_presence_send
   1049          		}
   1050          	}
   1051          	
   1052          	if((Time_delay.timer_delay_set.time_out ==1)||(Time_delay.Re_Trigger_senconds ==1)||(Time_delay.Walk_Through_Timeout ==1))	
   \                     ??_Standby_state_1:
   \   00000054   ....               LDI     R30, LOW(Time_delay)
   \   00000056   ....               LDI     R31, (Time_delay) >> 8
   \   00000058   A102               LDD     R16, Z+34
   \   0000005A   3001               CPI     R16, 1
   \   0000005C   F049               BREQ    ??_Standby_state_2
   \   0000005E   8100               LD      R16, Z
   \   00000060   3001               CPI     R16, 1
   \   00000062   F031               BREQ    ??_Standby_state_2
   \   00000064   8101               LDD     R16, Z+1
   \   00000066   8112               LDD     R17, Z+2
   \   00000068   3001               CPI     R16, 1
   \   0000006A   E020               LDI     R18, 0
   \   0000006C   0712               CPC     R17, R18
   \   0000006E   F451               BRNE    ??_Standby_state_3
   1053          	{		
   1054          		Sensor_mode.mode_state = Initial_state;
   \                     ??_Standby_state_2:
   \   00000070   E001               LDI     R16, 1
   \   00000072   9300....           STS     Sensor_mode, R16
   1055          		Time_delay.timer_delay_set.time_out = 0;
   \   00000076   E000               LDI     R16, 0
   \   00000078   A302               STD     Z+34, R16
   1056          		Sensor_mode.no_prence_off_send = 0;			        	// allow to send no presence and OFF frame again in initial state
   \   0000007A   01FD               MOVW    R31:R30, R27:R26
   \   0000007C   8105               LDD     R16, Z+5
   \   0000007E   7D0F               ANDI    R16, 0xDF
   \   00000080   8305               STD     Z+5, R16
   1057          		Stop_allTimer();																	// stop all timer
   \   00000082   ....               RCALL   Stop_allTimer
   1058          	}
   1059          	// end of Regulation_Timeout_count
   1060          }
   \                     ??_Standby_state_3:
   \   00000084   91A9               LD      R26, Y+
   \   00000086   91B9               LD      R27, Y+
   \   00000088   9508               RET
   1061          
   1062          
   1063          //******************************************************************************
   1064          // function for LM GR with addressed type==2
   1065          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
   1066          void Function_LM_GR(void)
   \                     Function_LM_GR:
   1067          {
   1068          		function_check_status();             					//respond the frames according to its own state
   \   00000000   ....               RCALL   function_check_status
   \   00000002   9100....           LDS     R16, (Sensor_mode + 6)
   \   00000006   9503               INC     R16
   \   00000008   9300....           STS     (Sensor_mode + 6), R16
   \   0000000C   9100....           LDS     R16, (Sensor_mode + 6)
   \   00000010   300B               CPI     R16, 11
   \   00000012   F018               BRCS    ??Function_LM_GR_0
   1069          
   1070          		if(1)//(Sensor_mode.manual_on_need !=1)					//((Sensor_mode.manual_on_need !=1)&&(KO_conf.FuncMod != ManualON_Manual_OFF))	
   1071          		{														// 在manual mode,retrigger timeout后，必需手动才能打开负载
   1072          			if(++Sensor_mode.random_takeline > 10)	
   1073          			  	Sensor_mode.random_takeline = 1;				// used for random taking line
   \   00000014   E001               LDI     R16, 1
   \   00000016   9300....           STS     (Sensor_mode + 6), R16
   1074          			if(Walk_Through_flag == 1)	
   \                     ??Function_LM_GR_0:
   \   0000001A   9100....           LDS     R16, Walk_Through_flag
   \   0000001E   3001               CPI     R16, 1
   \   00000020   F429               BRNE    ??Function_LM_GR_1
   1075          			  	SetBit(KO_conf.status[0],Status_Walk_through);
   \   00000022   ....               LDI     R30, LOW(KO_conf)
   \   00000024   ....               LDI     R31, (KO_conf) >> 8
   \   00000026   A505               LDD     R16, Z+45
   \   00000028   6002               ORI     R16, 0x02
   \   0000002A   A705               STD     Z+45, R16
   1076                switch(Sensor_mode.mode_state)
   \                     ??Function_LM_GR_1:
   \   0000002C   9100....           LDS     R16, Sensor_mode
   \   00000030   5001               SUBI    R16, 1
   \   00000032   F039               BREQ    ??Function_LM_GR_2
   \   00000034   950A               DEC     R16
   \   00000036   F079               BREQ    ??Function_LM_GR_3
   \   00000038   950A               DEC     R16
   \   0000003A   F0D1               BREQ    ??Function_LM_GR_4
   \   0000003C   950A               DEC     R16
   \   0000003E   F129               BREQ    ??Function_LM_GR_5
   \   00000040   9508               RET
   1077          			{	
   1078          				case Initial_state:	
   1079                    Sensor_mode.detect_scheme = KO_conf.InitOccu;
   \                     ??Function_LM_GR_2:
   \   00000042   ....               LDI     R30, LOW(KO_conf)
   \   00000044   ....               LDI     R31, (KO_conf) >> 8
   \   00000046   8D06               LDD     R16, Z+30
   \   00000048   9300....           STS     (Sensor_mode + 2), R16
   1080          					KO_conf.status[0] &= 0xF8;
   \   0000004C   A505               LDD     R16, Z+45
   \   0000004E   7F08               ANDI    R16, 0xF8
   \   00000050   A705               STD     Z+45, R16
   1081          					_Initial_state();
   \   00000052   ....               RCALL   _Initial_state
   \   00000054   9508               RET
   1082          					break;
   1083          				case Maintain_state:
   1084                    Sensor_mode.detect_scheme = KO_conf.MaintainOccu;
   \                     ??Function_LM_GR_3:
   \   00000056   ....               LDI     R30, LOW(KO_conf)
   \   00000058   ....               LDI     R31, (KO_conf) >> 8
   \   0000005A   8D07               LDD     R16, Z+31
   \   0000005C   9300....           STS     (Sensor_mode + 2), R16
   1085          					SetBit(KO_conf.status[0],Status_Maintain);
   \   00000060   A505               LDD     R16, Z+45
   \   00000062   6004               ORI     R16, 0x04
   \   00000064   A705               STD     Z+45, R16
   1086          					ClrBit(KO_conf.status[0],Status_Retrigger);
   \   00000066   A505               LDD     R16, Z+45
   \   00000068   7F0E               ANDI    R16, 0xFE
   \   0000006A   A705               STD     Z+45, R16
   1087          					_Maintain_state();
   \   0000006C   ....               RCALL   _Maintain_state
   \   0000006E   9508               RET
   1088          					break;
   1089          				case Re_Trigger_State:
   1090                    Sensor_mode.detect_scheme = KO_conf.Retrigger;
   \                     ??Function_LM_GR_4:
   \   00000070   ....               LDI     R30, LOW(KO_conf)
   \   00000072   ....               LDI     R31, (KO_conf) >> 8
   \   00000074   A100               LDD     R16, Z+32
   \   00000076   9300....           STS     (Sensor_mode + 2), R16
   1091          					ClrBit(KO_conf.status[0],Status_Maintain);
   \   0000007A   A505               LDD     R16, Z+45
   \   0000007C   7F0B               ANDI    R16, 0xFB
   \   0000007E   A705               STD     Z+45, R16
   1092          					SetBit(KO_conf.status[0],Status_Retrigger);
   \   00000080   A505               LDD     R16, Z+45
   \   00000082   6001               ORI     R16, 0x01
   \   00000084   A705               STD     Z+45, R16
   1093          					_ReTrigger_State();
   \   00000086   ....               RCALL   _ReTrigger_State
   \   00000088   9508               RET
   1094          					break;
   1095          				case Standby_state:
   1096          					_Standby_state();
   \                     ??Function_LM_GR_5:
   \   0000008A   ....               RCALL   _Standby_state
   1097          					break;
   1098          				default: break;				
   1099          			}
   1100          		}
   1101          		//if(Sensor_mode.flag_leader_group == 1)		
   1102          		//LLED_ON ;
   1103          		//else							
   1104          		//LLED_OFF ;
   1105          }
   \   0000008C   9508               RET
   1106          
   1107          /////////////////////////////////////////////////////////////////////////////////////////////////////////
   1108          //////////////////		LM GR  machine states	end		/////////////////////////////////////////////////
   1109          /////////////////////////////////////////////////////////////////////////////////////////////////////////
   1110          
   1111          //******************************************************************************
   1112          // function for KO119
   1113          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
   1114          void Function_KO119(void)	// Stand-alone motion sensor
   \                     Function_KO119:
   1115          {
   1116          	set_point = 0xFFFF;
   \   00000000   EF0F               LDI     R16, 255
   \   00000002   9300....           STS     set_point, R16
   \   00000006   9300....           STS     (set_point + 1), R16
   1117          	DLL.current_level = 0;
   \   0000000A   ....               LDI     R30, LOW(DLL)
   \   0000000C   ....               LDI     R31, (DLL) >> 8
   \   0000000E   E000               LDI     R16, 0
   \   00000010   8B00               STD     Z+16, R16
   \   00000012   8B01               STD     Z+17, R16
   1118          	DLL.calc_level = 0;
   \   00000014   8B02               STD     Z+18, R16
   \   00000016   8B03               STD     Z+19, R16
   1119          	
   1120          	occupancy_detect();
   \   00000018   ....               RCALL   occupancy_detect
   1121          	Function_LM_GR();	// Function_LM_GR(168);
   \   0000001A   ....               RCALL   Function_LM_GR
   1122          	Light_regulation();
   \   0000001C   ........           CALL    Light_regulation
   1123          }
   \   00000020   9508               RET
   1124          
   1125          //******************************************************************************
   1126          // function for KO128
   1127          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
   1128          void Function_KO128(void)								// Daylight and motion sensor for centralized LM system
   \                     Function_KO128:
   1129          {
   \   00000000   ........           CALL    ?PROLOGUE12_L09
   \   00000004                      REQUIRE ?Register_R4_is_cg_reg
   \   00000004                      REQUIRE ?Register_R5_is_cg_reg
   \   00000004                      REQUIRE ?Register_R8_is_cg_reg
   \   00000004                      REQUIRE ?Register_R9_is_cg_reg
   \   00000004                      REQUIRE ?Register_R10_is_cg_reg
   \   00000004                      REQUIRE ?Register_R11_is_cg_reg
   1130          	//daylight_service();
   1131          	//get_dl_level();
   1132          	unsigned long int temp_lux = 0;
   \   00000004   E080               LDI     R24, 0
   \   00000006   E090               LDI     R25, 0
   \   00000008   E0A0               LDI     R26, 0
   \   0000000A   E0B0               LDI     R27, 0
   1133          	unsigned char i;
   1134          	
   1135          	if( Time_delay.sample_interval.time_out )
   \   0000000C   9100....           LDS     R16, (Time_delay + 311)
   \   00000010   2300               TST     R16
   \   00000012   F409               BRNE    $+2+2
   \   00000014   C0B0               RJMP    ??Function_KO128_0
   1136          	{
   1137          		timer_interval_initial(1000);
   \   00000016   EE08               LDI     R16, 232
   \   00000018   E013               LDI     R17, 3
   \   0000001A   E020               LDI     R18, 0
   \   0000001C   E030               LDI     R19, 0
   \   0000001E   ....               RCALL   timer_interval_initial
   1138          		DLL.day_level = read_adc10bit ( daylight_channel );		// ADC value
   \   00000020   ....               LDI     R16, LOW(DLL)
   \   00000022   2E40               MOV     R4, R16
   \   00000024   ....               LDI     R16, (DLL) >> 8
   \   00000026   2E50               MOV     R5, R16
   \   00000028   E003               LDI     R16, 3
   \   0000002A   ........           CALL    read_adc10bit
   \   0000002E   01F2               MOVW    R31:R30, R5:R4
   \   00000030   8306               STD     Z+6, R16
   \   00000032   8317               STD     Z+7, R17
   1139          #ifdef SMT
   1140          	DLL.read_lux = exp10(5 * (double)(DLL.day_level)/1024 * 100000 / RES_VALUE);
   1141          	DLL.calc_level = (unsigned int)DLL.read_lux ;
   1142          #else
   1143          	//DLL.calc_level = (CONST_DAYLIGHT * (unsigned long)DLL.day_level)/100;									// calculate the daylight level (LUX)around the sensor
   1144          	DLL.calc_level = (unsigned int)(g_slope * (double)DLL.day_level);
   \   00000034   8106               LDD     R16, Z+6
   \   00000036   8117               LDD     R17, Z+7
   \   00000038   E020               LDI     R18, 0
   \   0000003A   E030               LDI     R19, 0
   \   0000003C   ........           CALL    ?UL2F_L04
   \   00000040   ....               LDI     R30, LOW(g_slope)
   \   00000042   ....               LDI     R31, (g_slope) >> 8
   \   00000044   8140               LD      R20, Z
   \   00000046   8151               LDD     R21, Z+1
   \   00000048   8162               LDD     R22, Z+2
   \   0000004A   8173               LDD     R23, Z+3
   \   0000004C   ........           CALL    ?F_MUL_L04
   \   00000050   ........           CALL    ?F2SL_L04
   \   00000054   01F2               MOVW    R31:R30, R5:R4
   \   00000056   8B02               STD     Z+18, R16
   \   00000058   8B13               STD     Z+19, R17
   1145          #endif
   1146          		DLL.lux_array[DLL.daylight_SampleCount++] = DLL.calc_level;
   \   0000005A   9100....           LDS     R16, (DLL + 1)
   \   0000005E   2F10               MOV     R17, R16
   \   00000060   9513               INC     R17
   \   00000062   9310....           STS     (DLL + 1), R17
   \   00000066   8922               LDD     R18, Z+18
   \   00000068   8933               LDD     R19, Z+19
   \   0000006A   E012               LDI     R17, 2
   \   0000006C   9F01               MUL     R16, R17
   \   0000006E   0DE0               ADD     R30, R0
   \   00000070   1DF1               ADC     R31, R1
   \   00000072   AB27               STD     Z+55, R18
   \   00000074   AF30               STD     Z+56, R19
   1147          		
   1148          		if(DLL.daylight_SampleCount >= SAMPLE_COUNT)
   \   00000076   9100....           LDS     R16, (DLL + 1)
   \   0000007A   3500               CPI     R16, 80
   \   0000007C   F048               BRCS    ??Function_KO128_1
   1149          		{
   1150          			DLL.daylight_SampleCount = 0;
   \   0000007E   9380....           STS     (DLL + 1), R24
   1151          			flags.KO_128_first_sampel_ready = 1;
   \   00000082   ....               LDI     R30, LOW(flags)
   \   00000084   ....               LDI     R31, (flags) >> 8
   \   00000086   8504               LDD     R16, Z+12
   \   00000088   8515               LDD     R17, Z+13
   \   0000008A   6100               ORI     R16, 0x10
   \   0000008C   8715               STD     Z+13, R17
   \   0000008E   8704               STD     Z+12, R16
   1152          		}
   1153          		
   1154          		if(flags.KO_128_first_sampel_ready)
   \                     ??Function_KO128_1:
   \   00000090   ....               LDI     R30, LOW(flags)
   \   00000092   ....               LDI     R31, (flags) >> 8
   \   00000094   8504               LDD     R16, Z+12
   \   00000096   8515               LDD     R17, Z+13
   \   00000098   FF04               SBRS    R16, 4
   \   0000009A   C061               RJMP    ??Function_KO128_2
   1155          		{
   1156          			#ifdef DEMOBOARD
   1157          					ClrBit(PORTB,0);
   1158          			#endif
   1159          					
   1160          			for(i=0;i<SAMPLE_COUNT;i++)
   \   0000009C   E000               LDI     R16, 0
   \   0000009E   C00D               RJMP    ??Function_KO128_3
   1161          			{
   1162          				temp_lux += DLL.lux_array[i];
   \                     ??Function_KO128_4:
   \   000000A0   E012               LDI     R17, 2
   \   000000A2   9F01               MUL     R16, R17
   \   000000A4   01F2               MOVW    R31:R30, R5:R4
   \   000000A6   0DE0               ADD     R30, R0
   \   000000A8   1DF1               ADC     R31, R1
   \   000000AA   A947               LDD     R20, Z+55
   \   000000AC   AD50               LDD     R21, Z+56
   \   000000AE   E060               LDI     R22, 0
   \   000000B0   0F84               ADD     R24, R20
   \   000000B2   1F95               ADC     R25, R21
   \   000000B4   1FA6               ADC     R26, R22
   \   000000B6   1FB6               ADC     R27, R22
   1163          			}
   \   000000B8   9503               INC     R16
   \                     ??Function_KO128_3:
   \   000000BA   3500               CPI     R16, 80
   \   000000BC   F388               BRCS    ??Function_KO128_4
   1164          			temp_lux /= SAMPLE_COUNT;
   \   000000BE   E540               LDI     R20, 80
   \   000000C0   E050               LDI     R21, 0
   \   000000C2   E060               LDI     R22, 0
   \   000000C4   E070               LDI     R23, 0
   \   000000C6   018C               MOVW    R17:R16, R25:R24
   \   000000C8   019D               MOVW    R19:R18, R27:R26
   \   000000CA   ........           CALL    ?UL_DIVMOD_L03
   1165          			if(DLL.calc_level > temp_lux * 1.03 || DLL.calc_level < temp_lux * 0.97)
   \   000000CE   ........           CALL    ?UL2F_L04
   \   000000D2   01C8               MOVW    R25:R24, R17:R16
   \   000000D4   01D9               MOVW    R27:R26, R19:R18
   \   000000D6   E04A               LDI     R20, 10
   \   000000D8   ED57               LDI     R21, 215
   \   000000DA   E863               LDI     R22, 131
   \   000000DC   E37F               LDI     R23, 63
   \   000000DE   ........           CALL    ?F_MUL_L04
   \   000000E2   0148               MOVW    R9:R8, R17:R16
   \   000000E4   0159               MOVW    R11:R10, R19:R18
   \   000000E6   01F2               MOVW    R31:R30, R5:R4
   \   000000E8   8902               LDD     R16, Z+18
   \   000000EA   8913               LDD     R17, Z+19
   \   000000EC   E020               LDI     R18, 0
   \   000000EE   E030               LDI     R19, 0
   \   000000F0   ........           CALL    ?UL2F_L04
   \   000000F4   01A8               MOVW    R21:R20, R17:R16
   \   000000F6   01B9               MOVW    R23:R22, R19:R18
   \   000000F8   0184               MOVW    R17:R16, R9:R8
   \   000000FA   0195               MOVW    R19:R18, R11:R10
   \   000000FC   ........           CALL    ?F_CMP_LT_L04
   \   00000100   F0C0               BRCS    ??Function_KO128_5
   \   00000102   01F2               MOVW    R31:R30, R5:R4
   \   00000104   8902               LDD     R16, Z+18
   \   00000106   8913               LDD     R17, Z+19
   \   00000108   E020               LDI     R18, 0
   \   0000010A   E030               LDI     R19, 0
   \   0000010C   ........           CALL    ?UL2F_L04
   \   00000110   0148               MOVW    R9:R8, R17:R16
   \   00000112   0159               MOVW    R11:R10, R19:R18
   \   00000114   EE4C               LDI     R20, 236
   \   00000116   E551               LDI     R21, 81
   \   00000118   E768               LDI     R22, 120
   \   0000011A   E37F               LDI     R23, 63
   \   0000011C   018C               MOVW    R17:R16, R25:R24
   \   0000011E   019D               MOVW    R19:R18, R27:R26
   \   00000120   ........           CALL    ?F_MUL_L04
   \   00000124   01A8               MOVW    R21:R20, R17:R16
   \   00000126   01B9               MOVW    R23:R22, R19:R18
   \   00000128   0184               MOVW    R17:R16, R9:R8
   \   0000012A   0195               MOVW    R19:R18, R11:R10
   \   0000012C   ........           CALL    ?F_CMP_LT_L04
   \   00000130   F4B0               BRCC    ??Function_KO128_2
   1166          			{
   1167          				configuration_answer_frame(0x10);
   \                     ??Function_KO128_5:
   \   00000132   E100               LDI     R16, 16
   \   00000134   ........           CALL    configuration_answer_frame
   1168          				for(i=0;i<SAMPLE_COUNT;i++)
   \   00000138   E000               LDI     R16, 0
   \   0000013A   C00A               RJMP    ??Function_KO128_6
   1169          				{
   1170          					DLL.lux_array[i] = DLL.calc_level;
   \                     ??Function_KO128_7:
   \   0000013C   01F2               MOVW    R31:R30, R5:R4
   \   0000013E   8922               LDD     R18, Z+18
   \   00000140   8933               LDD     R19, Z+19
   \   00000142   E012               LDI     R17, 2
   \   00000144   9F01               MUL     R16, R17
   \   00000146   0DE0               ADD     R30, R0
   \   00000148   1DF1               ADC     R31, R1
   \   0000014A   AB27               STD     Z+55, R18
   \   0000014C   AF30               STD     Z+56, R19
   1171          				}
   \   0000014E   9503               INC     R16
   \                     ??Function_KO128_6:
   \   00000150   3500               CPI     R16, 80
   \   00000152   F3A0               BRCS    ??Function_KO128_7
   1172          				timer_5m_initial(MIN_5);
   \   00000154   EE00               LDI     R16, 224
   \   00000156   E913               LDI     R17, 147
   \   00000158   E024               LDI     R18, 4
   \   0000015A   E030               LDI     R19, 0
   \   0000015C   ....               RCALL   timer_5m_initial
   1173          			}
   1174          			temp_lux = 0;
   1175          			
   1176          			#ifdef DEMOBOARD
   1177          				SetBit(PORTB,0);
   1178          			#endif
   1179          		}
   1180          		
   1181          		if( Time_delay.timer_5m.time_out )
   \                     ??Function_KO128_2:
   \   0000015E   9100....           LDS     R16, (Time_delay + 80)
   \   00000162   2300               TST     R16
   \   00000164   F041               BREQ    ??Function_KO128_0
   1182          		{
   1183          			timer_5m_initial(MIN_5);
   \   00000166   EE00               LDI     R16, 224
   \   00000168   E913               LDI     R17, 147
   \   0000016A   E024               LDI     R18, 4
   \   0000016C   E030               LDI     R19, 0
   \   0000016E   ....               RCALL   timer_5m_initial
   1184          		  configuration_answer_frame(0x10);
   \   00000170   E100               LDI     R16, 16
   \   00000172   ........           CALL    configuration_answer_frame
   1185          		}
   1186          	}
   1187          
   1188          	if(Time_delay.relay.time_out)
   \                     ??Function_KO128_0:
   \   00000176   9100....           LDS     R16, (Time_delay + 300)
   \   0000017A   2300               TST     R16
   \   0000017C   F009               BREQ    ??Function_KO128_8
   1189            	occupancy_detect();
   \   0000017E   ....               RCALL   occupancy_detect
   1190          	
   1191          	if(flags.motion_detected && (flags.timer_started == 0 || Time_delay.timer_delay_set.time_out))
   \                     ??Function_KO128_8:
   \   00000180   ....               LDI     R30, LOW(flags)
   \   00000182   ....               LDI     R31, (flags) >> 8
   \   00000184   8500               LDD     R16, Z+8
   \   00000186   8511               LDD     R17, Z+9
   \   00000188   FF01               SBRS    R16, 1
   \   0000018A   C01F               RJMP    ??Function_KO128_9
   \   0000018C   8500               LDD     R16, Z+8
   \   0000018E   8511               LDD     R17, Z+9
   \   00000190   FF02               SBRS    R16, 2
   \   00000192   C004               RJMP    ??Function_KO128_10
   \   00000194   9100....           LDS     R16, (Time_delay + 34)
   \   00000198   2300               TST     R16
   \   0000019A   F0B9               BREQ    ??Function_KO128_9
   1192          	{
   1193          		flags.motion_detected = 0;
   \                     ??Function_KO128_10:
   \   0000019C   8500               LDD     R16, Z+8
   \   0000019E   8511               LDD     R17, Z+9
   \   000001A0   7F0D               ANDI    R16, 0xFD
   \   000001A2   8711               STD     Z+9, R17
   \   000001A4   8700               STD     Z+8, R16
   1194          		frame_presence('0');
   \   000001A6   E300               LDI     R16, 48
   \   000001A8   ........           CALL    frame_presence
   1195          		relay_timer_initial(2000);
   \   000001AC   ED00               LDI     R16, 208
   \   000001AE   E017               LDI     R17, 7
   \   000001B0   E020               LDI     R18, 0
   \   000001B2   E030               LDI     R19, 0
   \   000001B4   ........           CALL    relay_timer_initial
   1196          		Start_Time_Delay();
   \   000001B8   ........           CALL    Start_Time_Delay
   1197          		flags.timer_started = 1;
   \   000001BC   ....               LDI     R30, LOW(flags)
   \   000001BE   ....               LDI     R31, (flags) >> 8
   \   000001C0   8500               LDD     R16, Z+8
   \   000001C2   8511               LDD     R17, Z+9
   \   000001C4   6004               ORI     R16, 0x04
   \   000001C6   8711               STD     Z+9, R17
   \   000001C8   8700               STD     Z+8, R16
   1198          	}
   1199          	
   1200          	if(Time_delay.timer_delay_set.time_out && flags.M2_step2_started == 0)
   \                     ??Function_KO128_9:
   \   000001CA   9100....           LDS     R16, (Time_delay + 34)
   \   000001CE   2300               TST     R16
   \   000001D0   F0C1               BREQ    ??Function_KO128_11
   \   000001D2   8504               LDD     R16, Z+12
   \   000001D4   8515               LDD     R17, Z+13
   \   000001D6   FD01               SBRC    R16, 1
   \   000001D8   C014               RJMP    ??Function_KO128_11
   1201          	{
   1202          		//Time_delay.timer_delay_set.time_out = 0;
   1203          		//flags.timer_started = 0;
   1204          		flags.M2_step2_started = 1;
   \   000001DA   8504               LDD     R16, Z+12
   \   000001DC   8515               LDD     R17, Z+13
   \   000001DE   6002               ORI     R16, 0x02
   \   000001E0   8715               STD     Z+13, R17
   \   000001E2   8704               STD     Z+12, R16
   1205          		if(flags.motion_detected)
   \   000001E4   8500               LDD     R16, Z+8
   \   000001E6   8511               LDD     R17, Z+9
   \   000001E8   FF01               SBRS    R16, 1
   \   000001EA   C00B               RJMP    ??Function_KO128_11
   1206          		{
   1207          			frame_presence('0');
   \   000001EC   E300               LDI     R16, 48
   \   000001EE   ........           CALL    frame_presence
   1208          			relay_timer_initial(2000);
   \   000001F2   ED00               LDI     R16, 208
   \   000001F4   E017               LDI     R17, 7
   \   000001F6   E020               LDI     R18, 0
   \   000001F8   E030               LDI     R19, 0
   \   000001FA   ........           CALL    relay_timer_initial
   1209          			Start_Time_Delay();
   \   000001FE   ........           CALL    Start_Time_Delay
   1210          		}
   1211          	}
   1212          }
   \                     ??Function_KO128_11:
   \   00000202   E0EC               LDI     R30, 12
   \   00000204   ........           JMP     ?EPILOGUE_B12_L09
   1213          
   1214          //******************************************************************************
   1215          // function for KO166
   1216          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
   1217          void Function_KO166(char addrestype, char detectype, char LightReg)
   \                     Function_KO166:
   1218          {
   1219          	
   1220          }
   \   00000000   9508               RET
   1221          

   \                                 In  segment CODE, align 2, keep-with-next
   1222          void Function_KO164(void)
   \                     Function_KO164:
   1223          {
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
   1224          	get_dl_level();
   \   00000004   ........           CALL    get_dl_level
   1225          #ifdef SMT
   1226          	DLL.read_lux = exp10(5 * (double)(DLL.day_level)/1024 * 100000 / RES_VALUE);
   1227          	DLL.calc_level = (unsigned int)DLL.read_lux ;
   1228          #else
   1229          	//DLL.calc_level = (CONST_DAYLIGHT * (unsigned long)DLL.day_level)/100;									// calculate the daylight level (LUX)around the sensor
   1230          	DLL.calc_level = (unsigned int)(g_slope * (double)DLL.day_level);
   \   00000008   ....               LDI     R26, LOW(DLL)
   \   0000000A   ....               LDI     R27, (DLL) >> 8
   \   0000000C   01FD               MOVW    R31:R30, R27:R26
   \   0000000E   8106               LDD     R16, Z+6
   \   00000010   8117               LDD     R17, Z+7
   \   00000012   E020               LDI     R18, 0
   \   00000014   E030               LDI     R19, 0
   \   00000016   ........           CALL    ?UL2F_L04
   \   0000001A   01A8               MOVW    R21:R20, R17:R16
   \   0000001C   01B9               MOVW    R23:R22, R19:R18
   \   0000001E   ....               LDI     R30, LOW(g_slope)
   \   00000020   ....               LDI     R31, (g_slope) >> 8
   \   00000022   8100               LD      R16, Z
   \   00000024   8111               LDD     R17, Z+1
   \   00000026   8122               LDD     R18, Z+2
   \   00000028   8133               LDD     R19, Z+3
   \   0000002A   ........           CALL    ?F_MUL_L04
   \   0000002E   ........           CALL    ?F2SL_L04
   \   00000032   01FD               MOVW    R31:R30, R27:R26
   \   00000034   8B02               STD     Z+18, R16
   \   00000036   8B13               STD     Z+19, R17
   1231          #endif
   1232          }
   \   00000038   91A9               LD      R26, Y+
   \   0000003A   91B9               LD      R27, Y+
   \   0000003C   9508               RET
   1233          

   \                                 In  segment CODE, align 2, keep-with-next
   1234          void Function_KO165(void)
   \                     Function_KO165:
   1235          {
   1236            	occupancy_detect();
   \   00000000   ....               RCALL   occupancy_detect
   1237          		
   1238          		if(flags.motion_detected && flags.timer_started == 0)
   \   00000002   ....               LDI     R30, LOW(flags)
   \   00000004   ....               LDI     R31, (flags) >> 8
   \   00000006   8500               LDD     R16, Z+8
   \   00000008   8511               LDD     R17, Z+9
   \   0000000A   FF01               SBRS    R16, 1
   \   0000000C   C015               RJMP    ??Function_KO165_0
   \   0000000E   8500               LDD     R16, Z+8
   \   00000010   8511               LDD     R17, Z+9
   \   00000012   FD02               SBRC    R16, 2
   \   00000014   C011               RJMP    ??Function_KO165_0
   1239          		{
   1240          			flags.motion_detected = 0;
   \   00000016   8500               LDD     R16, Z+8
   \   00000018   8511               LDD     R17, Z+9
   \   0000001A   7F0D               ANDI    R16, 0xFD
   \   0000001C   8711               STD     Z+9, R17
   \   0000001E   8700               STD     Z+8, R16
   1241          			frame_presence('0');
   \   00000020   E300               LDI     R16, 48
   \   00000022   ........           CALL    frame_presence
   1242          			Start_Time_Delay();
   \   00000026   ........           CALL    Start_Time_Delay
   1243          			flags.timer_started = 1;
   \   0000002A   ....               LDI     R30, LOW(flags)
   \   0000002C   ....               LDI     R31, (flags) >> 8
   \   0000002E   8500               LDD     R16, Z+8
   \   00000030   8511               LDD     R17, Z+9
   \   00000032   6004               ORI     R16, 0x04
   \   00000034   8711               STD     Z+9, R17
   \   00000036   8700               STD     Z+8, R16
   1244          		}
   1245          		
   1246          		if(Time_delay.timer_delay_set.time_out)
   \                     ??Function_KO165_0:
   \   00000038   9100....           LDS     R16, (Time_delay + 34)
   \   0000003C   2300               TST     R16
   \   0000003E   F039               BREQ    ??Function_KO165_1
   1247          		{
   1248          			if(flags.motion_detected)
   \   00000040   8500               LDD     R16, Z+8
   \   00000042   8511               LDD     R17, Z+9
   \   00000044   FF01               SBRS    R16, 1
   \   00000046   C003               RJMP    ??Function_KO165_1
   1249          			{
   1250          				frame_presence('0');
   \   00000048   E300               LDI     R16, 48
   \   0000004A   ........           CALL    frame_presence
   1251          			}
   1252          		}
   1253          }
   \                     ??Function_KO165_1:
   \   0000004E   9508               RET
   1254          //******************************************************************************
   1255          // function for KO168
   1256          //******************************************************************************

   \                                 In  segment CODE, align 2, keep-with-next
   1257          void Function_KO168(char addrestype, char FuncMod, char LightReg)
   \                     Function_KO168:
   1258          {
   1259            	daylight_service();
   \   00000000   ........           CALL    daylight_service
   1260            	occupancy_detect();
   \   00000004   ....               RCALL   occupancy_detect
   1261          		Function_LM_GR();	// Function_LM_GR(168);		
   \   00000006   ....               RCALL   Function_LM_GR
   1262          		Light_regulation();
   \   00000008   ........           CALL    Light_regulation
   1263          }
   \   0000000C   9508               RET
   1264          //******************************************************************************
   1265          // function mode for LM group end
   1266          //******************************************************************************
   1267          
   1268          
   1269          

   \                                 In  segment CODE, align 2, keep-with-next
   1270          void function_service_init(void)
   \                     function_service_init:
   1271          {
   \   00000000   ........           CALL    ?PROLOGUE8_L09
   \   00000004                      REQUIRE ?Register_R4_is_cg_reg
   \   00000004                      REQUIRE ?Register_R5_is_cg_reg
   \   00000004                      REQUIRE ?Register_R6_is_cg_reg
   \   00000004                      REQUIRE ?Register_R7_is_cg_reg
   1272          		timer0_enable();                      			// enable timer for sensor detection add 20090408 by alan
   \   00000004   ........           CALL    timer0_enable
   1273          		ultWarmUpEvents();                    			// init the US detector
   \   00000008   ........           CALL    ultWarmUpEvents
   1274          		daylight_set_init();
   \   0000000C   ........           CALL    daylight_set_init
   1275          		Sensor_mode.detect_scheme = KO_conf.InitOccu;
   \   00000010   ....               LDI     R26, LOW(KO_conf)
   \   00000012   ....               LDI     R27, (KO_conf) >> 8
   \   00000014   9100....           LDS     R16, (KO_conf + 30)
   \   00000018   9300....           STS     (Sensor_mode + 2), R16
   1276          		Time_delay.motion.count = 0;
   \   0000001C   E010               LDI     R17, 0
   \   0000001E   E020               LDI     R18, 0
   \   00000020   E030               LDI     R19, 0
   \   00000022   ....               LDI     R30, LOW((Time_delay + 61))
   \   00000024   ....               LDI     R31, HIGH((Time_delay + 61))
   \   00000026   8310               ST      Z, R17
   \   00000028   8311               STD     Z+1, R17
   \   0000002A   8312               STD     Z+2, R17
   \   0000002C   8313               STD     Z+3, R17
   1277          		Time_delay.motion.time_out = 0;
   \   0000002E   9310....           STS     (Time_delay + 69), R17
   1278          		Time_delay.motion.enabled = 1;
   \   00000032   E001               LDI     R16, 1
   \   00000034   9300....           STS     (Time_delay + 70), R16
   1279          		Time_delay.motion.started = 1;
   \   00000038   9300....           STS     (Time_delay + 71), R16
   1280          		Delay_Time_set =  KO_conf.Seconds + (unsigned long int)KO_conf.Minutes*60 + (unsigned long int) KO_conf.Hours*3600;		//calculate the time set by user
   \   0000003C   9040....           LDS     R4, (KO_conf + 12)
   \   00000040   2455               CLR     R5
   \   00000042   2466               CLR     R6
   \   00000044   2477               CLR     R7
   \   00000046   9100....           LDS     R16, (KO_conf + 11)
   \   0000004A   E34C               LDI     R20, 60
   \   0000004C   E050               LDI     R21, 0
   \   0000004E   E060               LDI     R22, 0
   \   00000050   E070               LDI     R23, 0
   \   00000052   ........           CALL    ?L_EC_MUL_L03
   \   00000056   0E40               ADD     R4, R16
   \   00000058   1E51               ADC     R5, R17
   \   0000005A   1E62               ADC     R6, R18
   \   0000005C   1E73               ADC     R7, R19
   \   0000005E   9100....           LDS     R16, (KO_conf + 10)
   \   00000062   E010               LDI     R17, 0
   \   00000064   E020               LDI     R18, 0
   \   00000066   E030               LDI     R19, 0
   \   00000068   E140               LDI     R20, 16
   \   0000006A   E05E               LDI     R21, 14
   \   0000006C   ........           CALL    ?L_EC_MUL_L03
   \   00000070   0E40               ADD     R4, R16
   \   00000072   1E51               ADC     R5, R17
   \   00000074   1E62               ADC     R6, R18
   \   00000076   1E73               ADC     R7, R19
   \   00000078   ....               LDI     R30, LOW(Delay_Time_set)
   \   0000007A   ....               LDI     R31, (Delay_Time_set) >> 8
   \   0000007C   8240               ST      Z, R4
   \   0000007E   8251               STD     Z+1, R5
   \   00000080   8262               STD     Z+2, R6
   \   00000082   8273               STD     Z+3, R7
   1281          	
   1282            	set_point = KO_conf.DaylightSetp*5;   	
   \   00000084   9140....           LDS     R20, (KO_conf + 25)
   \   00000088   E050               LDI     R21, 0
   \   0000008A   E005               LDI     R16, 5
   \   0000008C   E010               LDI     R17, 0
   \   0000008E   ........           CALL    ?S_EC_MUL_L02
   \   00000092   9300....           STS     set_point, R16
   \   00000096   9310....           STS     (set_point + 1), R17
   1283          		if(set_point == 0)	
   \   0000009A   9100....           LDS     R16, set_point
   \   0000009E   9110....           LDS     R17, (set_point + 1)
   \   000000A2   2B01               OR      R16, R17
   \   000000A4   F431               BRNE    ??function_service_init_0
   1284          			set_point = 1500;		// for debug alan
   \   000000A6   ED0C               LDI     R16, 220
   \   000000A8   E015               LDI     R17, 5
   \   000000AA   9300....           STS     set_point, R16
   \   000000AE   9310....           STS     (set_point + 1), R17
   1285          	
   1286          		if(KO_conf.KO_number == 128)
   \                     ??function_service_init_0:
   \   000000B2   01FD               MOVW    R31:R30, R27:R26
   \   000000B4   A507               LDD     R16, Z+47
   \   000000B6   A910               LDD     R17, Z+48
   \   000000B8   3800               CPI     R16, 128
   \   000000BA   0716               CPC     R17, R22
   \   000000BC   F5C9               BRNE    ??function_service_init_1
   1287              {
   1288               		M2_timer = (eep_M2_hour*3600 + eep_M2_min*60 + eep_M2_sec);			
   \   000000BE   ....               LDI     R20, LOW(eep_M2_hour)
   \   000000C0   ....               LDI     R21, (eep_M2_hour) >> 8
   \   000000C2   ........           CALL    __eeget8_16
   \   000000C6   2F40               MOV     R20, R16
   \   000000C8   E050               LDI     R21, 0
   \   000000CA   E100               LDI     R16, 16
   \   000000CC   E01E               LDI     R17, 14
   \   000000CE   ........           CALL    ?S_EC_MUL_L02
   \   000000D2   01C8               MOVW    R25:R24, R17:R16
   \   000000D4   ....               LDI     R20, LOW(eep_M2_min)
   \   000000D6   ....               LDI     R21, (eep_M2_min) >> 8
   \   000000D8   ........           CALL    __eeget8_16
   \   000000DC   2F40               MOV     R20, R16
   \   000000DE   E050               LDI     R21, 0
   \   000000E0   E30C               LDI     R16, 60
   \   000000E2   E010               LDI     R17, 0
   \   000000E4   ........           CALL    ?S_EC_MUL_L02
   \   000000E8   0F80               ADD     R24, R16
   \   000000EA   1F91               ADC     R25, R17
   \   000000EC   ....               LDI     R20, LOW(eep_M2_sec)
   \   000000EE   ....               LDI     R21, (eep_M2_sec) >> 8
   \   000000F0   ........           CALL    __eeget8_16
   \   000000F4   0F80               ADD     R24, R16
   \   000000F6   1F96               ADC     R25, R22
   \   000000F8   018C               MOVW    R17:R16, R25:R24
   \   000000FA   2F21               MOV     R18, R17
   \   000000FC   0F22               LSL     R18
   \   000000FE   0B22               SBC     R18, R18
   \   00000100   ....               LDI     R30, LOW(M2_timer)
   \   00000102   ....               LDI     R31, (M2_timer) >> 8
   \   00000104   8380               ST      Z, R24
   \   00000106   8391               STD     Z+1, R25
   \   00000108   8322               STD     Z+2, R18
   \   0000010A   8323               STD     Z+3, R18
   1289          				Start_Time_Delay();											//call Start_Time_Delay() to send the dll frame every 5min
   \   0000010C   ........           CALL    Start_Time_Delay
   1290                	if(M2_timer == 0)		M2_timer = 5;   		// for debug //default presence frame interval time
   \   00000110   ....               LDI     R30, LOW(M2_timer)
   \   00000112   ....               LDI     R31, (M2_timer) >> 8
   \   00000114   8100               LD      R16, Z
   \   00000116   8111               LDD     R17, Z+1
   \   00000118   8122               LDD     R18, Z+2
   \   0000011A   8133               LDD     R19, Z+3
   \   0000011C   2B01               OR      R16, R17
   \   0000011E   2B02               OR      R16, R18
   \   00000120   2B03               OR      R16, R19
   \   00000122   F431               BRNE    ??function_service_init_1
   \   00000124   E005               LDI     R16, 5
   \   00000126   E010               LDI     R17, 0
   \   00000128   8300               ST      Z, R16
   \   0000012A   8311               STD     Z+1, R17
   \   0000012C   8312               STD     Z+2, R17
   \   0000012E   8313               STD     Z+3, R17
   1291              }
   1292          		
   1293          		
   1294          		 switch(KO_conf.KO_number)
   \                     ??function_service_init_1:
   \   00000130   969F               ADIW    R27:R26, 47
   \   00000132   91ED               LD      R30, X+
   \   00000134   91FC               LD      R31, X
   \   00000136   57E7               SUBI    R30, 119
   \   00000138   40F0               SBCI    R31, 0
   \   0000013A   F021               BREQ    ??function_service_init_2
   \   0000013C   9739               SBIW    R31:R30, 9
   \   0000013E   F0C1               BREQ    ??function_service_init_3
   \   00000140   97B8               SBIW    R31:R30, 40
   \   00000142   F551               BRNE    ??function_service_init_4
   1295          		{
   1296          			case 119:
   1297          			case 168:
   1298          				// sensitivity of the sensor is set in the files PIR.c and US.c
   1299          				Sensor_mode.mode_state = 1;	
   \                     ??function_service_init_2:
   \   00000144   E001               LDI     R16, 1
   \   00000146   9300....           STS     Sensor_mode, R16
   1300          				if(KO_conf.FuncMod == ManualON_Auto_OFF)	
   \   0000014A   9100....           LDS     R16, (KO_conf + 29)
   \   0000014E   3003               CPI     R16, 3
   \   00000150   F429               BRNE    ??function_service_init_5
   1301          					Sensor_mode.manual_on_need = 1;     // in manualon mode
   \   00000152   ....               LDI     R30, LOW(Sensor_mode)
   \   00000154   ....               LDI     R31, (Sensor_mode) >> 8
   \   00000156   8105               LDD     R16, Z+5
   \   00000158   6400               ORI     R16, 0x40
   \   0000015A   8305               STD     Z+5, R16
   1302          				if (KO_conf.LightReg)
   \                     ??function_service_init_5:
   \   0000015C   9100....           LDS     R16, (KO_conf + 28)
   \   00000160   2300               TST     R16
   \   00000162   F0D1               BREQ    ??function_service_init_4
   1303          					Sensor_mode.flag_leader_group = 1;
   \   00000164   ....               LDI     R30, LOW(Sensor_mode)
   \   00000166   ....               LDI     R31, (Sensor_mode) >> 8
   \   00000168   8105               LDD     R16, Z+5
   \   0000016A   6002               ORI     R16, 0x02
   \   0000016C   8305               STD     Z+5, R16
   \   0000016E   C014               RJMP    ??function_service_init_4
   1304          			break;
   1305          			
   1306          			case 128:
   1307          				timer_interval_initial(1000);
   \                     ??function_service_init_3:
   \   00000170   EE08               LDI     R16, 232
   \   00000172   E013               LDI     R17, 3
   \   00000174   E020               LDI     R18, 0
   \   00000176   E030               LDI     R19, 0
   \   00000178   ....               RCALL   timer_interval_initial
   1308          				timer_5m_initial(MIN_5);
   \   0000017A   EE00               LDI     R16, 224
   \   0000017C   E913               LDI     R17, 147
   \   0000017E   E024               LDI     R18, 4
   \   00000180   E030               LDI     R19, 0
   \   00000182   ....               RCALL   timer_5m_initial
   1309          				DLL.daylight_SampleCount = 0;
   \   00000184   E000               LDI     R16, 0
   \   00000186   9300....           STS     (DLL + 1), R16
   1310          				flags.KO_128_first_sampel_ready = 0;
   \   0000018A   ....               LDI     R30, LOW(flags)
   \   0000018C   ....               LDI     R31, (flags) >> 8
   \   0000018E   8504               LDD     R16, Z+12
   \   00000190   8515               LDD     R17, Z+13
   \   00000192   7E0F               ANDI    R16, 0xEF
   \   00000194   8715               STD     Z+13, R17
   \   00000196   8704               STD     Z+12, R16
   1311          			break;
   1312          			
   1313          			case 165:
   1314          			break;
   1315          			
   1316          			default:break;	
   1317          		}
   1318          	/*
   1319          		KO_conf.KO_number = 168;	//debug
   1320          		KO_conf.en_load = 1;
   1321          		KO_conf.GR = 2;	
   1322          		KO_conf.Reference = 2;
   1323          		KO_conf.AddressType = 2;
   1324          		Delay_Time_set =  30;
   1325          		KO_conf.FuncMod = ManualON_Auto_OFF;
   1326          	*/
   1327          
   1328          }
   \                     ??function_service_init_4:
   \   00000198   E0E8               LDI     R30, 8
   \   0000019A   ........           JMP     ?EPILOGUE_B8_L09
   1329          
   1330          //#pragma optimize=none

   \                                 In  segment CODE, align 2, keep-with-next
   1331          void function_service(void)
   \                     function_service:
   1332          {
   \   00000000   93BA               ST      -Y, R27
   \   00000002   93AA               ST      -Y, R26
   1333          
   1334            if(Sensor_mode.init_OK == 0)			// if not initialed
   \   00000004   ....               LDI     R26, LOW(KO_conf)
   \   00000006   ....               LDI     R27, (KO_conf) >> 8
   \   00000008   ....               LDI     R30, LOW(Sensor_mode)
   \   0000000A   ....               LDI     R31, (Sensor_mode) >> 8
   \   0000000C   8107               LDD     R16, Z+7
   \   0000000E   FD07               SBRC    R16, 7
   \   00000010   C026               RJMP    ??function_service_0
   1335          	{
   1336          			Sensor_mode.init_OK = 1;
   \   00000012   8107               LDD     R16, Z+7
   \   00000014   6800               ORI     R16, 0x80
   \   00000016   8307               STD     Z+7, R16
   1337          			KO_conf.KO_number = StrToChar(KO);				
   \   00000018   ....               LDI     R16, LOW(KO)
   \   0000001A   ....               LDI     R17, (KO) >> 8
   \   0000001C   ........           CALL    StrToChar
   \   00000020   E010               LDI     R17, 0
   \   00000022   01FD               MOVW    R31:R30, R27:R26
   \   00000024   A707               STD     Z+47, R16
   \   00000026   AB10               STD     Z+48, R17
   1338          			KO_conf.KO_number = KO_conf.KO_number<<8;
   \   00000028   A507               LDD     R16, Z+47
   \   0000002A   A910               LDD     R17, Z+48
   \   0000002C   2F10               MOV     R17, R16
   \   0000002E   E000               LDI     R16, 0
   \   00000030   A707               STD     Z+47, R16
   \   00000032   AB10               STD     Z+48, R17
   1339          			KO_conf.KO_number += StrToChar(&KO[2]);
   \   00000034   ....               LDI     R16, LOW((KO + 2))
   \   00000036   ....               LDI     R17, HIGH((KO + 2))
   \   00000038   ........           CALL    StrToChar
   \   0000003C   E010               LDI     R17, 0
   \   0000003E   01FD               MOVW    R31:R30, R27:R26
   \   00000040   A527               LDD     R18, Z+47
   \   00000042   A930               LDD     R19, Z+48
   \   00000044   0F20               ADD     R18, R16
   \   00000046   1F31               ADC     R19, R17
   \   00000048   A727               STD     Z+47, R18
   \   0000004A   AB30               STD     Z+48, R19
   1340          	  	function_service_init();
   \   0000004C   ....               RCALL   function_service_init
   1341          			SCS_received.P2P_actuator_flag = 1;
   \   0000004E   ....               LDI     R30, LOW(SCS_received)
   \   00000050   ....               LDI     R31, (SCS_received) >> 8
   \   00000052   8102               LDD     R16, Z+2
   \   00000054   6001               ORI     R16, 0x01
   \   00000056   8302               STD     Z+2, R16
   1342          			SCS_received.P2P_dimmer_flag = 0;
   \   00000058   8102               LDD     R16, Z+2
   \   0000005A   7F0D               ANDI    R16, 0xFD
   \   0000005C   8302               STD     Z+2, R16
   1343          	}
   1344          
   1345          	//set_point = KO_conf.DaylightSetp*5;
   1346          	
   1347            switch(KO_conf.KO_number)
   \                     ??function_service_0:
   \   0000005E   01FD               MOVW    R31:R30, R27:R26
   \   00000060   A507               LDD     R16, Z+47
   \   00000062   A910               LDD     R17, Z+48
   \   00000064   ....               LDI     R30, LOW(`?<Jumptable for function_service>_0`)
   \   00000066   ....               LDI     R31, (`?<Jumptable for function_service>_0`) >> 8
   \   00000068   ........           JMP     ?SV_SWITCH_L06
   1348          	{
   1349          		case 112:
   1350          		
   1351          		  	break;
   1352          		case 119:
   1353          		  	Function_KO119();
   \                     ??function_service_1:
   \   0000006C   ....               RCALL   Function_KO119
   \   0000006E   C013               RJMP    ??function_service_2
   1354          		 	break;
   1355          		case 128:
   1356          		  	Function_KO128();  				//_modality_2();
   \                     ??function_service_3:
   \   00000070   ....               RCALL   Function_KO128
   \   00000072   C011               RJMP    ??function_service_2
   1357          		  	break;
   1358          		case 164:
   1359          		
   1360          		  	break;
   1361          		case 165:
   1362          		  	Function_KO165();
   \                     ??function_service_4:
   \   00000074   ....               RCALL   Function_KO165
   \   00000076   C00F               RJMP    ??function_service_2
   1363          		  	break;
   1364          		case 166:
   1365          		  	// Function_KO166(2,x,x); 		// Group
   1366          		  	// Function_KO166(0,1,0);  		//_modality_1();
   1367          		  	// Function_KO166(0,3,1);  		//_modality_4();
   1368          		  	// void Function_KO166(char addrestype, char detectype, char LightReg);
   1369          				Function_KO166(KO_conf.AddressType, KO_conf.FuncMod, KO_conf.LightReg);
   \                     ??function_service_5:
   \   00000078   9120....           LDS     R18, (KO_conf + 28)
   \   0000007C   9110....           LDS     R17, (KO_conf + 29)
   \   00000080   9100....           LDS     R16, (KO_conf + 1)
   \   00000084   ....               RCALL   Function_KO166
   \   00000086   C007               RJMP    ??function_service_2
   1370          		  	break;
   1371          		case 168:
   1372          		  	// Function_KO168(2,x,x);  		// Group
   1373          		  	// Function_KO168(0,1,0);  		//_modality_0();	
   1374          		  	// Function_KO168(0,1,1);  		//_modality_3();	
   1375          		  	// void Function_KO168(char addrestype, char FuncMod, char LightReg);
   1376          		  	Function_KO168(KO_conf.AddressType, KO_conf.FuncMod, KO_conf.LightReg); 	
   \                     ??function_service_6:
   \   00000088   9120....           LDS     R18, (KO_conf + 28)
   \   0000008C   9110....           LDS     R17, (KO_conf + 29)
   \   00000090   9100....           LDS     R16, (KO_conf + 1)
   \   00000094   ....               RCALL   Function_KO168
   1377          				//Function_KO168(2,1,1);
   1378          		  	break;
   1379          		case 0x203:
   1380          			/*
   1381          		  if(Configurators.M == '0')		
   1382          				Function_KO168(0,1,0);  	//_modality_0();	
   1383          			else if(Configurators.M == '2')	
   1384          				Function_KO128(); 			//_modality_2();
   1385          			else if(Configurators.M == '3')	    Function_KO168(0,1,1);  	//_modality_3();	
   1386          			*/
   1387          		  	break;
   1388          		case 0x204:
   1389          		  /*
   1390          		  if(Configurators.M == '1')			
   1391          				Function_KO166(0,1,0);  									//_modality_1();
   1392          			else if(Configurators.M == '4')		Function_KO166(0,3,1);  	//_modality_4();
   1393          		  */
   1394          		  	break;
   1395          		case 0x1FF:
   1396          		
   1397          		  	break;
   1398          		default:
   1399          		  	break;	
   1400          	}
   1401          }
   \                     ??function_service_2:
   \   00000096   91A9               LD      R26, Y+
   \   00000098   91B9               LD      R27, Y+
   \   0000009A   9508               RET
   1402          

   \                                 In  segment CODE, align 2, keep-with-next
   1403          void check_frame_received_maintain(void)
   \                     check_frame_received_maintain:
   1404          {
   1405          	
   1406          }
   \   00000000   9508               RET
   1407          

   \                                 In  segment CODE, align 2, keep-with-next
   1408          void timer_interval_initial(unsigned long int ms)
   \                     timer_interval_initial:
   1409          {
   1410          	Time_delay.sample_interval.stack_top = ms;
   \   00000000   ....               LDI     R30, LOW((Time_delay + 307))
   \   00000002   ....               LDI     R31, HIGH((Time_delay + 307))
   \   00000004   8300               ST      Z, R16
   \   00000006   8311               STD     Z+1, R17
   \   00000008   8322               STD     Z+2, R18
   \   0000000A   8333               STD     Z+3, R19
   1411          	Time_delay.sample_interval.count = 0;
   \   0000000C   E000               LDI     R16, 0
   \   0000000E   ....               LDI     R30, LOW((Time_delay + 303))
   \   00000010   ....               LDI     R31, HIGH((Time_delay + 303))
   \   00000012   8300               ST      Z, R16
   \   00000014   8301               STD     Z+1, R16
   \   00000016   8302               STD     Z+2, R16
   \   00000018   8303               STD     Z+3, R16
   1412          	Time_delay.sample_interval.time_out = 0;
   \   0000001A   9300....           STS     (Time_delay + 311), R16
   1413          	Time_delay.sample_interval.enabled = 1;
   \   0000001E   E001               LDI     R16, 1
   \   00000020   9300....           STS     (Time_delay + 312), R16
   1414          	Time_delay.sample_interval.started = 1;
   \   00000024   9300....           STS     (Time_delay + 313), R16
   1415          }
   \   00000028   9508               RET
   1416          

   \                                 In  segment CODE, align 2, keep-with-next
   1417          void timer_5m_initial(unsigned long int ms)
   \                     timer_5m_initial:
   1418          {
   1419          	Time_delay.timer_5m.stack_top = ms;
   \   00000000   ....               LDI     R30, LOW((Time_delay + 76))
   \   00000002   ....               LDI     R31, HIGH((Time_delay + 76))
   \   00000004   8300               ST      Z, R16
   \   00000006   8311               STD     Z+1, R17
   \   00000008   8322               STD     Z+2, R18
   \   0000000A   8333               STD     Z+3, R19
   1420          	Time_delay.timer_5m.count = 0;
   \   0000000C   E000               LDI     R16, 0
   \   0000000E   ....               LDI     R30, LOW((Time_delay + 72))
   \   00000010   ....               LDI     R31, HIGH((Time_delay + 72))
   \   00000012   8300               ST      Z, R16
   \   00000014   8301               STD     Z+1, R16
   \   00000016   8302               STD     Z+2, R16
   \   00000018   8303               STD     Z+3, R16
   1421          	Time_delay.timer_5m.time_out = 0;
   \   0000001A   9300....           STS     (Time_delay + 80), R16
   1422          	Time_delay.timer_5m.enabled = 1;
   \   0000001E   E001               LDI     R16, 1
   \   00000020   9300....           STS     (Time_delay + 81), R16
   1423          	Time_delay.timer_5m.started = 1;
   \   00000024   9300....           STS     (Time_delay + 82), R16
   1424          }
   \   00000028   9508               RET

   \                                 In  segment SWITCH, align 2, keep-with-next
   \                     `?<Jumptable for function_service>_0`:
   \   00000000   7700               DW      30464
   \   00000002   01                 DB      1
   \   00000003   ....               DW      (??function_service_2) /2
   \   00000005   ....               DW      (??function_service_1) /2
   \   00000007   09                 DB      0x9
   \   00000008   ....               DW      (??function_service_3) /2
   \   0000000A   25                 DB      0x25
   \   0000000B   ....               DW      (??function_service_4) /2
   \   0000000D   01                 DB      0x1
   \   0000000E   ....               DW      (??function_service_5) /2
   \   00000010   02                 DB      0x2
   \   00000011   ....               DW      (??function_service_6) /2
   \   00000013   FB                 DB      251

   Maximum stack usage in bytes:

     Function                       CSTACK RSTACK
     --------                       ------ ------
     Call_detect_delay                  0      2
       -> Start_Time_Delay              0      2
     Check_SCS_received                 4      2
       -> Mode_frame_GR                 4      2
       -> frame_ON_send                 4      2
       -> Call_detect_delay             4      2
       -> Start_Time_Delay              4      2
       -> WT_20s_detect                 4      2
       -> frame_ON_send                 4      2
       -> Start_Time_Delay              4      2
       -> regulation_timer_initial      4      2
       -> Call_detect_delay             4      2
       -> Start_Time_Delay              4      2
       -> Start_Time_Delay              4      2
       -> Call_detect_delay             4      2
       -> Mode_frame_GR                 4      2
       -> frame_ON_send                 4      2
       -> Start_Time_Delay              4      2
       -> WT_20s_detect                 4      2
       -> Start_Time_Delay              4      2
       -> Mode_frame_GR                 4      2
       -> frame_ON_send                 4      2
       -> Stop_allTimer                 4      2
       -> frame_M2_answer               4      2
       -> DLL_setpoint                  4      2
       -> DLL_setpoint                  4      2
       -> DLL_setpoint                  4      2
     Delay_Alert                        0      2
       -> buzzer_ms                     0      2
     Function_KO119                     0      2
       -> occupancy_detect              0      2
       -> Function_LM_GR                0      2
       -> Light_regulation              0      2
     Function_KO128                    12      4
       -> timer_interval_initial       12      2
       -> read_adc10bit                12      2
       -> configuration_answer_frame
                                       12      2
       -> timer_5m_initial             12      2
       -> timer_5m_initial             12      2
       -> configuration_answer_frame
                                       12      2
       -> occupancy_detect             12      2
       -> frame_presence               12      2
       -> relay_timer_initial          12      2
       -> Start_Time_Delay             12      2
       -> frame_presence               12      2
       -> relay_timer_initial          12      2
       -> Start_Time_Delay             12      2
     Function_KO164                     2      4
       -> get_dl_level                  2      2
     Function_KO165                     0      2
       -> occupancy_detect              0      2
       -> frame_presence                0      2
       -> Start_Time_Delay              0      2
       -> frame_presence                0      2
     Function_KO166                     0      2
     Function_KO168                     0      2
       -> daylight_service              0      2
       -> occupancy_detect              0      2
       -> Function_LM_GR                0      2
       -> Light_regulation              0      2
     Function_LM_GR                     0      2
       -> function_check_status         0      2
       -> _Initial_state                0      2
       -> _Maintain_state               0      2
       -> _ReTrigger_State              0      2
       -> _Standby_state                0      2
     GS_presence_send                   0      2
       -> Mode_frame_GR                 0      2
       -> Mode_frame_GR                 0      2
     OFF_takeline                       0      2
       -> frame_OFF_send                0      2
     ON_takeline                        2      2
       -> Mode_frame_GR                 2      2
       -> frame_ON_send                 2      2
       -> Call_detect_delay             2      2
     Start_Time_Delay                   0      2
     Stop_allTimer                      0      2
     WT_20s_detect                      0      2
       -> Start_Time_Delay              0      2
       -> Start_Time_Delay              0      2
     _Initial_state                     4      4
       -> Mode_frame_GR                 4      2
       -> frame_ON_send                 4      2
       -> Call_detect_delay             4      2
       -> Start_Time_Delay              4      2
       -> GS_presence_send              4      2
       -> frame_OFF_send                4      2
       -> ON_takeline                   4      2
       -> OFF_takeline                  4      2
     _Maintain_state                    2      2
       -> Mode_frame_GR                 2      2
       -> Start_Time_Delay              2      2
       -> WT_20s_detect                 2      2
       -> Mode_frame_GR                 2      2
       -> Mode_frame_GR                 2      2
       -> GS_presence_send              2      2
       -> WT_20s_detect                 2      2
       -> frame_OFF_send                2      2
       -> Stop_allTimer                 2      2
       -> frame_OFF_send                2      2
       -> Delay_Alert                   2      2
     _ReTrigger_State                   2      2
       -> Start_Time_Delay              2      2
       -> Mode_frame_GR                 2      2
       -> frame_ON_send                 2      2
       -> GS_presence_send              2      2
       -> Stop_allTimer                 2      2
     _Standby_state                     2      2
       -> Start_Time_Delay              2      2
       -> WT_20s_detect                 2      2
       -> Mode_frame_GR                 2      2
       -> GS_presence_send              2      2
       -> Stop_allTimer                 2      2
     check_frame_received_maintain      0      2
     frame_OFF_send                     0      2
       -> dimmer_command                0      2
       -> Mode_frame_GR                 0      2
       -> Mode_frame_GR                 0      2
       -> frame_presence                0      2
       -> frame_pp_on_off               0      2
     frame_ON_send                      0      2
       -> frame_pp_on_off               0      2
       -> Mode_frame_GR                 0      2
       -> regulation_timer_initial      0      2
     frame_pp_on_off                   14      2
       -> CharToStr                    14      2
       -> CharToStr                    14      2
       -> send_frame_pp_broad          14      2
     frame_presence                    12      2
       -> CharToStr                    12      2
       -> send_frame_pp_broad          12      2
     function_check_status              2      2
       -> Stop_allTimer                 2      2
       -> Call_detect_delay             2      2
       -> Mode_frame_GR                 2      2
       -> Start_Time_Delay              2      2
       -> Start_Time_Delay              2      2
       -> Check_SCS_received            2      2
     function_service                   2      2
       -> StrToChar                     2      2
       -> StrToChar                     2      2
       -> function_service_init         2      2
       -> Function_KO119                2      2
       -> Function_KO128                2      2
       -> Function_KO165                2      2
       -> Function_KO166                2      2
       -> Function_KO168                2      2
     function_service_init              8      4
       -> timer0_enable                 8      2
       -> ultWarmUpEvents               8      2
       -> daylight_set_init             8      2
       -> Start_Time_Delay              8      2
       -> timer_interval_initial        8      2
       -> timer_5m_initial              8      2
     occupancy_detect                   2      2
       -> motion_detect                 2      2
       -> Dled_light_on_ms              2      2
     timer_5m_initial                   0      2
     timer_interval_initial             0      2


   Segment part sizes:

     Function/Label                      Bytes
     --------------                      -----
     frame_presence                        66
     frame_pp_on_off                      136
     Start_Time_Delay                      46
     Stop_allTimer                         46
     Call_detect_delay                     82
     WT_20s_detect                        178
     GS_presence_send                      46
     frame_ON_send                         96
     frame_OFF_send                       122
     Delay_Alert                          114
     ON_takeline                           92
     OFF_takeline                          40
     function_check_status                310
     Check_SCS_received                  1342
     occupancy_detect                     200
     _Initial_state                       312
     _Maintain_state                      302
     _ReTrigger_State                     122
     _Standby_state                       138
     Function_LM_GR                       142
     Function_KO119                        34
     Function_KO128                       520
     Function_KO166                         2
     Function_KO164                        62
     Function_KO165                        80
     Function_KO168                        14
     function_service_init                414
     function_service                     156
     check_frame_received_maintain          2
     timer_interval_initial                42
     timer_5m_initial                      42
     ?<Jumptable for function_service>_0   20

 
 5 300 bytes in segment CODE
    20 bytes in segment SWITCH
 
 5 320 bytes of CODE memory

Errors: none
Warnings: none
